<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
<link href="coqdoc.css" rel="stylesheet" type="text/css" />
<title>OperApprox</title>
</head>

<body>

<div id="page">

<div id="header">
</div>

<div id="main">

<h1 class="libtitle">Library OperApprox</h1>

<div class="code">
<span class="id" title="keyword">Add</span> <span class="id" title="var">Rec</span> <span class="id" title="var">LoadPath</span> "." <span class="id" title="keyword">as</span> <span class="id" title="var">Top</span>.<br/>
<span class="id" title="keyword">Add</span> <span class="id" title="var">LoadPath</span> "../denot/domain-theory".<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">Utils</span>.<br/>

<br/>
<span class="id" title="keyword">Set</span> <span class="id" title="var">Automatic</span> <span class="id" title="var">Coercions</span> <span class="id" title="keyword">Import</span>.<br/>
<span class="id" title="keyword">Set Implicit Arguments</span>.<br/>

<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">Utf8</span>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">Setoid</span>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">Coq.Classes.Morphisms</span>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">Ensembles</span>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">Biorthogonality</span>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">Machine</span>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="keyword">Syntax</span>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">Semantics</span>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">Compiler</span>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">Coq.Program.Equality</span>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">Sets</span>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">Equalities</span>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">ZArith</span>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">BOp</span>.<br/>

<br/>
<span class="id" title="keyword">Add</span> <span class="id" title="var">LoadPath</span> "../denot".<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">ObsSI</span>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">StepIndexing</span>.<br/>

<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">domoprs</span>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">DomainStuff</span>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">PredomAll</span>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">uniirec</span>.<br/>

<br/>
<span class="id" title="keyword">Include</span> <span class="id" title="var">RD</span>.<br/>

<br/>
<span class="id" title="var">From</span> <span class="id" title="var">mathcomp</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">ssreflect</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab15"></a><h1 class="section">Realizers, Tests and Main Theorem</h1>

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Module</span> <span class="id" title="var">OperApprox</span> (<span class="id" title="var">PointerType</span> : <span class="id" title="var">UsualDecidableType</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">Import</span> <span class="id" title="var">Ob</span> : <span class="id" title="var">ObservationsSI</span> <span class="id" title="var">PointerType</span>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">RType</span> : <span class="id" title="keyword">Type</span> := <span class="id" title="var">Heap</span> * <span class="id" title="var">MClos</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">TType</span> : <span class="id" title="keyword">Type</span> := <span class="id" title="var">Heap</span> * <span class="id" title="var">stack</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">EType</span> : <span class="id" title="keyword">Type</span> := <span class="id" title="var">Heap</span> * <span class="id" title="var">MEnv</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">iRType</span> : <span class="id" title="keyword">Type</span> := <span class="id" title="var">Indexed</span> <span class="id" title="var">RType</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">iTType</span> : <span class="id" title="keyword">Type</span> := <span class="id" title="var">Indexed</span> <span class="id" title="var">TType</span>.<br/>

<br/>
</div>

<div class="doc">
Well-formed realizers 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">r_wf</span> (<span class="id" title="var">r</span> : <span class="id" title="var">RType</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;:= <span class="id" title="keyword">match</span> <span class="id" title="var">r</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">Γ</span>, (<span class="id" title="var">_</span>, <span class="id" title="var">η</span>)) =&gt; <span class="id" title="var">heap_wf</span> <span class="id" title="var">Γ</span> /\  <span class="id" title="var">Included</span> <span class="id" title="var">_</span> (<span class="id" title="var">env_ptr</span> <span class="id" title="var">η</span>) (<span class="id" title="var">key_set</span> <span class="id" title="var">Γ</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
Well-formed tests 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">t_wf</span> (<span class="id" title="var">t</span> : <span class="id" title="var">TType</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;:= <span class="id" title="keyword">match</span> <span class="id" title="var">t</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">Γ</span>, <span class="id" title="var">s</span>) =&gt; <span class="id" title="var">heap_wf</span> <span class="id" title="var">Γ</span> /\ <span class="id" title="var">Included</span> <span class="id" title="var">_</span> (<span class="id" title="var">stack_ptr</span> <span class="id" title="var">s</span>) (<span class="id" title="var">key_set</span> <span class="id" title="var">Γ</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
Concrete definition of the satisfability relation 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">isatif</span> (<span class="id" title="var">n</span> : <span class="id" title="var">nat</span>) (<span class="id" title="var">r</span> : <span class="id" title="var">RType</span>) (<span class="id" title="var">t</span> : <span class="id" title="var">TType</span>) : <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">r</span>, <span class="id" title="var">t</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">Γ</span>, <span class="id" title="var">α</span>), (<span class="id" title="var">Δ</span>, <span class="id" title="var">s</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">r_wf</span> (<span class="id" title="var">Γ</span>, <span class="id" title="var">α</span>) -&gt; <span class="id" title="var">t_wf</span> (<span class="id" title="var">Δ</span>, <span class="id" title="var">s</span>) -&gt;  <span class="id" title="var">Γ</span> ⋈ <span class="id" title="var">Δ</span> -&gt; <span class="id" title="var">SetIn</span> (<span class="id" title="var">Ω</span> <span class="id" title="var">n</span>) (<span class="id" title="var">Γ</span> ∪ <span class="id" title="var">Δ</span>, <span class="id" title="var">α</span>, <span class="id" title="var">s</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">satif</span> : <span class="id" title="var">iRType</span> -&gt; <span class="id" title="var">iTType</span> -&gt; <span class="id" title="keyword">Prop</span> := <span class="id" title="var">mrel</span> <span class="id" title="var">isatif</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Module</span> <span class="id" title="var">TestRealizer</span> &lt;: <span class="id" title="var">TstElt</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">Elt</span> := <span class="id" title="var">iRType</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">Tst</span> := <span class="id" title="var">iTType</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">satif</span> := <span class="id" title="var">satif</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">End</span> <span class="id" title="var">TestRealizer</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Module</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">OO</span> := <span class="id" title="var">Biorthogonality.Biorthogonality</span> <span class="id" title="var">TestRealizer</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Notation</span> <span class="id" title="var">flipIn</span> <span class="id" title="var">A</span> <span class="id" title="var">x</span> <span class="id" title="var">S</span> := (<span class="id" title="var">Ensembles.In</span> <span class="id" title="var">A</span> <span class="id" title="var">S</span> <span class="id" title="var">x</span>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Reserved Notation</span> &quot;t_Rp( θ , d )" (<span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 70, <span class="id" title="keyword">no</span> <span class="id" title="keyword">associativity</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Infix</span> &quot;∈" := (<span class="id" title="var">flipIn</span> <span class="id" title="var">_</span>) (<span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 80, <span class="id" title="keyword">no</span> <span class="id" title="keyword">associativity</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Infix</span> &quot;⊆" := (<span class="id" title="var">Ensembles.Included</span> <span class="id" title="var">_</span>) (<span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 80, <span class="id" title="keyword">no</span> <span class="id" title="keyword">associativity</span>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">LiftRel</span> (<span class="id" title="var">θ</span> : <span class="id" title="keyword">type</span>) (<span class="id" title="var">d</span> : <span class="id" title="var">ty_denot</span> <span class="id" title="var">θ</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">PRel</span> : <span class="id" title="var">nat</span> -&gt; <span class="id" title="var">t_ty_denot</span> <span class="id" title="var">θ</span> -&gt; <span class="id" title="var">Ensemble</span> <span class="id" title="var">RType</span>) :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Sets.Power_set</span> (<span class="id" title="var">Indexed</span> <span class="id" title="var">RType</span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">fun</span> (<span class="id" title="var">iv</span> : <span class="id" title="var">nat</span> * <span class="id" title="var">RType</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> (<span class="id" title="var">i</span>,<span class="id" title="var">r</span>) := <span class="id" title="var">iv</span> <span class="id" title="tactic">in</span> <span class="id" title="tactic">exists</span> (<span class="id" title="var">d'</span> : <span class="id" title="var">t_ty_denot</span> <span class="id" title="var">θ</span>), <span class="id" title="var">d</span> =-= <span class="id" title="var">eta</span> <span class="id" title="var">d'</span> /\ <span class="id" title="var">PRel</span> <span class="id" title="var">i</span> <span class="id" title="var">d'</span> <span class="id" title="var">r</span><br/>
&nbsp;&nbsp;.<br/>

<br/>
</div>

<div class="doc">
Primitive realizers 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">Primitives</span> (<span class="id" title="var">θ</span> : <span class="id" title="keyword">type</span>) (<span class="id" title="var">n</span> : <span class="id" title="var">nat</span>) : <span class="id" title="var">t_ty_denot</span> <span class="id" title="var">θ</span> -&gt; <span class="id" title="var">Ensemble</span> <span class="id" title="var">RType</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">R</span> <span class="id" title="var">θ</span> <span class="id" title="var">n</span> <span class="id" title="var">d</span> := <span class="id" title="keyword">fun</span> <span class="id" title="var">r</span> =&gt; (<span class="id" title="var">n</span>, <span class="id" title="var">r</span>) ∈ (@<span class="id" title="var">LiftRel</span> <span class="id" title="var">θ</span> <span class="id" title="var">d</span> (<span class="id" title="var">Primitives</span> <span class="id" title="var">θ</span>)) ⊥ ⊤ <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">θ</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">tunit</span> =&gt; <span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">on_iunit</span> <span class="id" title="var">f</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">fun</span> <span class="id" title="var">r</span> =&gt; <span class="id" title="keyword">match</span> <span class="id" title="var">r</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| (<span class="id" title="var">Γ</span>, (<span class="id" title="var">ival</span> <span class="id" title="var">iunit</span>, <span class="id" title="var">η</span>)) =&gt; <span class="id" title="var">f</span> <span class="id" title="var">Γ</span> <span class="id" title="var">η</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">_</span> =&gt; <span class="id" title="var">False</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">on_iunit</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">Γ</span> <span class="id" title="var">η</span> =&gt; <span class="id" title="var">env_ptr</span> <span class="id" title="var">η</span> ⊆ <span class="id" title="var">key_set</span> <span class="id" title="var">Γ</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">tint</span> =&gt; <span class="id" title="keyword">fun</span>(<span class="id" title="var">m</span> : <span class="id" title="var">int_cpoType</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">on_iint</span> <span class="id" title="var">f</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">fun</span> <span class="id" title="var">r</span> =&gt; <span class="id" title="keyword">match</span> <span class="id" title="var">r</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| (<span class="id" title="var">Γ</span>, (<span class="id" title="var">ival</span> (<span class="id" title="var">iint</span> <span class="id" title="var">z</span>), <span class="id" title="var">η</span>)) =&gt; <span class="id" title="var">f</span> <span class="id" title="var">Γ</span> <span class="id" title="var">η</span> <span class="id" title="var">m</span> <span class="id" title="var">z</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">_</span> =&gt; <span class="id" title="var">False</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">on_iint</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">Γ</span> <span class="id" title="var">η</span> <span class="id" title="var">m</span> <span class="id" title="var">z</span> =&gt; <span class="id" title="var">env_ptr</span> <span class="id" title="var">η</span> ⊆ <span class="id" title="var">key_set</span> <span class="id" title="var">Γ</span> /\ <span class="id" title="var">m</span> =-= <span class="id" title="var">z</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">θ1</span> ⇾ <span class="id" title="var">θ2</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">fun</span> (<span class="id" title="var">f</span> : <span class="id" title="var">ty_denot</span> <span class="id" title="var">θ1</span> -=&gt; <span class="id" title="var">ty_denot</span> <span class="id" title="var">θ2</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">on_igrab</span> <span class="id" title="var">f</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">fun</span> <span class="id" title="var">r</span> =&gt; <span class="id" title="keyword">match</span> <span class="id" title="var">r</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| (<span class="id" title="var">Γ</span>, (<span class="id" title="var">ival</span> (<span class="id" title="var">igrab</span> <span class="id" title="var">i</span>), <span class="id" title="var">η</span>)) =&gt; <span class="id" title="var">f</span> <span class="id" title="var">Γ</span> <span class="id" title="var">i</span> <span class="id" title="var">η</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">_</span> =&gt; <span class="id" title="var">False</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">condition</span> <span class="id" title="var">Γ</span> <span class="id" title="var">i</span> <span class="id" title="var">η</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">m</span> <span class="id" title="var">d</span> <span class="id" title="var">Γ'</span> <span class="id" title="var">α</span> <span class="id" title="var">β</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">m</span> &lt; <span class="id" title="var">n</span>)%<span class="id" title="var">coq_nat</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">Γ'</span>, <span class="id" title="var">α</span>) ∈ <span class="id" title="var">R</span> <span class="id" title="var">θ1</span> <span class="id" title="var">m</span> <span class="id" title="var">d</span>  -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">r_wf</span> (<span class="id" title="var">Γ'</span>, <span class="id" title="var">α</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Γ</span> ⋈ <span class="id" title="var">Γ'</span>  -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">MClos_to_HClos</span> <span class="id" title="var">α</span> = <span class="id" title="var">β</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">p</span>, (<span class="id" title="var">Γ</span> ∪ <span class="id" title="var">Γ'</span>) ⋈ ⎨ <span class="id" title="var">p</span> ⤇ <span class="id" title="var">β</span> ⎬ -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">add</span> <span class="id" title="var">p</span> <span class="id" title="var">β</span> (<span class="id" title="var">Γ</span> ∪ <span class="id" title="var">Γ'</span>), (<span class="id" title="var">i</span>, <span class="id" title="var">p</span> :: <span class="id" title="var">η</span>)) ∈ <span class="id" title="var">R</span> <span class="id" title="var">θ2</span> <span class="id" title="var">m</span> (<span class="id" title="var">f</span> <span class="id" title="var">d</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">on_igrab</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">Γ</span> <span class="id" title="var">i</span> <span class="id" title="var">η</span> =&gt; <span class="id" title="var">env_ptr</span> <span class="id" title="var">η</span> ⊆ (<span class="id" title="var">key_set</span> <span class="id" title="var">Γ</span>) /\ <span class="id" title="var">condition</span> <span class="id" title="var">Γ</span> <span class="id" title="var">i</span> <span class="id" title="var">η</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">θ1</span> ⨱ <span class="id" title="var">θ2</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">fun</span> (<span class="id" title="var">ab</span> : <span class="id" title="var">ty_denot</span> <span class="id" title="var">θ1</span> * <span class="id" title="var">ty_denot</span> <span class="id" title="var">θ2</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">on_ipair</span> <span class="id" title="var">f</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">fun</span> <span class="id" title="var">r</span> =&gt; <span class="id" title="keyword">match</span> <span class="id" title="var">r</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| (<span class="id" title="var">Γ</span>, (<span class="id" title="var">ival</span> (<span class="id" title="var">ipair</span> <span class="id" title="var">i</span> <span class="id" title="var">i'</span>), <span class="id" title="var">η</span>)) =&gt; <span class="id" title="var">f</span> <span class="id" title="var">Γ</span> <span class="id" title="var">i</span> <span class="id" title="var">i'</span> <span class="id" title="var">η</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">_</span> =&gt; <span class="id" title="var">False</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">condition</span> <span class="id" title="var">Γ</span> <span class="id" title="var">i</span> <span class="id" title="var">i'</span> <span class="id" title="var">η</span> := <span class="id" title="keyword">forall</span> <span class="id" title="var">m</span>, (<span class="id" title="var">m</span> &lt; <span class="id" title="var">n</span>)%<span class="id" title="var">coq_nat</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">Γ</span>, (<span class="id" title="var">i</span>, <span class="id" title="var">η</span>)) ∈ <span class="id" title="var">R</span> <span class="id" title="var">θ1</span> <span class="id" title="var">m</span> (<span class="id" title="var">fst</span> <span class="id" title="var">ab</span>) ∧ (<span class="id" title="var">Γ</span>, (<span class="id" title="var">i'</span>, <span class="id" title="var">η</span>)) ∈ <span class="id" title="var">R</span> <span class="id" title="var">θ2</span> <span class="id" title="var">m</span> (<span class="id" title="var">snd</span> <span class="id" title="var">ab</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">on_ipair</span>(<span class="id" title="keyword">fun</span> <span class="id" title="var">Γ</span> <span class="id" title="var">i</span> <span class="id" title="var">i'</span> <span class="id" title="var">η</span> =&gt; <span class="id" title="var">env_ptr</span> <span class="id" title="var">η</span> ⊆ (<span class="id" title="var">key_set</span> <span class="id" title="var">Γ</span>) /\ <span class="id" title="var">condition</span> <span class="id" title="var">Γ</span> <span class="id" title="var">i</span> <span class="id" title="var">i'</span> <span class="id" title="var">η</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
General realizers: the orthogonal closure of the primitive realizers 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">Realizers</span> (<span class="id" title="var">θ</span> : <span class="id" title="keyword">type</span>) (<span class="id" title="var">n</span> : <span class="id" title="var">nat</span>) (<span class="id" title="var">d</span> : <span class="id" title="var">ty_denot</span> <span class="id" title="var">θ</span>) : <span class="id" title="var">Ensemble</span> <span class="id" title="var">RType</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;:= <span class="id" title="keyword">fun</span> <span class="id" title="var">r</span> =&gt; (<span class="id" title="var">n</span>, <span class="id" title="var">r</span>) ∈ ((@<span class="id" title="var">LiftRel</span> <span class="id" title="var">θ</span> <span class="id" title="var">d</span> (<span class="id" title="var">Primitives</span> <span class="id" title="var">θ</span>)) ⊥ ⊤).<br/>
&nbsp;&nbsp;<span class="id" title="var">Arguments</span> <span class="id" title="var">Realizers</span> : <span class="id" title="tactic">clear</span> <span class="id" title="var">implicits</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Notation</span> &quot;Rp( θ , n , d )" := (<span class="id" title="var">Primitives</span> <span class="id" title="var">θ</span> <span class="id" title="var">n</span> <span class="id" title="var">d</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 70, <span class="id" title="keyword">no</span> <span class="id" title="keyword">associativity</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Notation</span> &quot;R( θ ,  n , d )" := (<span class="id" title="var">Realizers</span> <span class="id" title="var">θ</span> <span class="id" title="var">n</span> <span class="id" title="var">d</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 70, <span class="id" title="keyword">no</span> <span class="id" title="keyword">associativity</span>).<br/>

<br/>
</div>

<div class="doc">
Tests 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">Tests</span> (<span class="id" title="var">θ</span> : <span class="id" title="keyword">type</span>) (<span class="id" title="var">d</span> : <span class="id" title="var">ty_denot</span> <span class="id" title="var">θ</span>) : <span class="id" title="var">Ensemble</span> <span class="id" title="var">iTType</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;:= (@<span class="id" title="var">LiftRel</span> <span class="id" title="var">θ</span> <span class="id" title="var">d</span> (<span class="id" title="var">Primitives</span> <span class="id" title="var">θ</span>)) ⊥.<br/>
&nbsp;&nbsp;<span class="id" title="var">Arguments</span> <span class="id" title="var">Tests</span> : <span class="id" title="tactic">clear</span> <span class="id" title="var">implicits</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Add</span> <span class="id" title="var">Parametric</span> <span class="id" title="var">Morphism</span> <span class="id" title="var">n</span> <span class="id" title="var">α</span> <span class="id" title="var">s</span> : (<span class="id" title="keyword">fun</span> <span class="id" title="var">Γ</span> =&gt; <span class="id" title="var">SetIn</span> (<span class="id" title="var">Ω</span> <span class="id" title="var">n</span>) (<span class="id" title="var">Γ</span>, <span class="id" title="var">α</span>, <span class="id" title="var">s</span>)) <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">signature</span> <span class="id" title="var">Equal</span> ==&gt; <span class="id" title="var">iff</span> <span class="id" title="keyword">as</span> <span class="id" title="var">inΩ_heap_mor</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">Γ</span> <span class="id" title="var">Γ'</span> <span class="id" title="var">EQ</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">eq_closed</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">split</span> ; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">eq_closed</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">split</span> ; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">symmetry</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">tests_realizers</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">θ</span> (<span class="id" title="var">d</span> : <span class="id" title="var">ty_denot</span> <span class="id" title="var">θ</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Same_set</span> <span class="id" title="var">_</span> (<span class="id" title="var">Tests</span> <span class="id" title="var">θ</span> <span class="id" title="var">d</span>) ((@<span class="id" title="var">LiftRel</span> <span class="id" title="var">θ</span> <span class="id" title="var">d</span> (<span class="id" title="var">Primitives</span> <span class="id" title="var">θ</span>)) ⊥ ⊤ ⊥).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">θ</span> <span class="id" title="var">d</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">change</span> (<span class="id" title="var">Same_set</span> <span class="id" title="var">_</span> (<span class="id" title="var">Tests</span> <span class="id" title="var">θ</span> <span class="id" title="var">d</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;((<span class="id" title="var">bbot</span> ∘ <span class="id" title="var">btop</span> ∘ <span class="id" title="var">bbot</span>) (@<span class="id" title="var">LiftRel</span> <span class="id" title="var">θ</span> <span class="id" title="var">d</span> (<span class="id" title="var">Primitives</span> <span class="id" title="var">θ</span>)))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">GF.comp_equality</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">f</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">Tests</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">realizer_in_Ω</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">n</span> <span class="id" title="var">Γ</span> <span class="id" title="var">Δ</span> <span class="id" title="var">α</span> <span class="id" title="var">s</span> <span class="id" title="var">a</span> (<span class="id" title="var">d</span> : <span class="id" title="var">ty_denot</span> <span class="id" title="var">a</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">r_wf</span> (<span class="id" title="var">Γ</span>, <span class="id" title="var">α</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt; <span class="id" title="var">t_wf</span> (<span class="id" title="var">Δ</span>, <span class="id" title="var">s</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt; <span class="id" title="var">Γ</span> ⋈ <span class="id" title="var">Δ</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt; (<span class="id" title="var">Γ</span>, <span class="id" title="var">α</span>) ∈ <span class="id" title="var">R</span>(<span class="id" title="var">a</span>, <span class="id" title="var">n</span>, <span class="id" title="var">d</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt; <span class="id" title="var">SetIn</span> (<span class="id" title="var">Tests</span> <span class="id" title="var">_</span> <span class="id" title="var">d</span>) (<span class="id" title="var">n</span>, (<span class="id" title="var">Δ</span>, <span class="id" title="var">s</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt; <span class="id" title="var">SetIn</span> (<span class="id" title="var">Ω</span> <span class="id" title="var">n</span>) (<span class="id" title="var">Γ</span> ∪ <span class="id" title="var">Δ</span>, <span class="id" title="var">α</span>, <span class="id" title="var">s</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">n</span> <span class="id" title="var">Γ</span> <span class="id" title="var">Δ</span> <span class="id" title="var">α</span> <span class="id" title="var">s</span> <span class="id" title="var">a</span> <span class="id" title="var">d</span> <span class="id" title="var">wf1</span> <span class="id" title="var">wf2</span> <span class="id" title="var">J0</span> <span class="id" title="var">R0</span> <span class="id" title="var">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">R0</span> (<span class="id" title="var">n</span>, (<span class="id" title="var">Δ</span>,<span class="id" title="var">s</span>)) <span class="id" title="var">H0</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">R0</span>. <span class="id" title="tactic">rewrite</span> -&gt; <span class="id" title="var">Nat.min_id</span> <span class="id" title="tactic">in</span> <span class="id" title="var">R0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">R0</span> ; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">Tests_Equal'</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">a</span> <span class="id" title="var">d</span> <span class="id" title="var">d'</span>, <span class="id" title="var">d</span> =-= <span class="id" title="var">d'</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Same_set</span> <span class="id" title="var">_</span> (<span class="id" title="var">LiftRel</span> <span class="id" title="var">d</span> (<span class="id" title="var">Primitives</span> <span class="id" title="var">a</span>) ⊥)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">LiftRel</span> <span class="id" title="var">d'</span>(<span class="id" title="var">Primitives</span> <span class="id" title="var">a</span>) ⊥).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">a</span> <span class="id" title="var">d</span> <span class="id" title="var">d'</span> <span class="id" title="var">d_eq_d'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">split</span>. <span class="id" title="tactic">intros</span> (<span class="id" title="var">n</span>,<span class="id" title="var">t</span>) <span class="id" title="var">Ht</span> (<span class="id" title="var">m</span>, <span class="id" title="var">r</span>) <span class="id" title="var">Hr</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">LiftRel</span>, "∈" <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">Ht</span>. <span class="id" title="tactic">unfold</span> "∈" <span class="id" title="tactic">in</span> *. <span class="id" title="tactic">destruct</span> <span class="id" title="var">Hr</span>. <span class="id" title="tactic">exists</span> <span class="id" title="var">x</span>. <span class="id" title="tactic">rewrite</span> -&gt; <span class="id" title="var">d_eq_d'</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> (<span class="id" title="var">n</span>,<span class="id" title="var">t</span>) <span class="id" title="var">Ht</span> (<span class="id" title="var">m</span>, <span class="id" title="var">r</span>) <span class="id" title="var">Hr</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">LiftRel</span>, "∈" <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">Ht</span>. <span class="id" title="tactic">unfold</span> "∈" <span class="id" title="tactic">in</span> *. <span class="id" title="tactic">destruct</span> <span class="id" title="var">Hr</span>. <span class="id" title="tactic">exists</span> <span class="id" title="var">x</span>. <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">d_eq_d'</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">primitive_Equal</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">n</span> <span class="id" title="var">Γ</span> <span class="id" title="var">α</span> <span class="id" title="var">a</span> <span class="id" title="var">d</span> <span class="id" title="var">d'</span>, <span class="id" title="var">d</span> =-= <span class="id" title="var">d'</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">SetIn</span> (<span class="id" title="var">Rp</span>(<span class="id" title="var">a</span>,<span class="id" title="var">n</span>,<span class="id" title="var">d</span>)) (<span class="id" title="var">Γ</span>, <span class="id" title="var">α</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">SetIn</span> (<span class="id" title="var">Rp</span>(<span class="id" title="var">a</span>,<span class="id" title="var">n</span>,<span class="id" title="var">d'</span>)) (<span class="id" title="var">Γ</span>, <span class="id" title="var">α</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">n</span> <span class="id" title="var">Γ</span> <span class="id" title="var">α</span> <span class="id" title="var">a</span> <span class="id" title="var">d</span> <span class="id" title="var">d'</span> <span class="id" title="var">d_eq_d'</span> <span class="id" title="var">pr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> *. <span class="id" title="tactic">unfold</span> <span class="id" title="var">SetIn</span>, "∈" <span class="id" title="tactic">in</span> *. <span class="id" title="tactic">destruct</span> <span class="id" title="var">α</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">c</span> <span class="id" title="var">η</span>]. <span class="id" title="tactic">destruct</span> <span class="id" title="var">a</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">c</span> ; <span class="id" title="tactic">try</span> <span class="id" title="var">contradiction</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">v</span> ; <span class="id" title="tactic">try</span> <span class="id" title="var">contradiction</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">pr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">c</span> ; <span class="id" title="tactic">try</span> <span class="id" title="var">contradiction</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">v</span> ; <span class="id" title="tactic">try</span> <span class="id" title="var">contradiction</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">d_eq_d'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">pr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">c</span> ; <span class="id" title="tactic">try</span> <span class="id" title="var">contradiction</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">v</span> ; <span class="id" title="tactic">try</span> <span class="id" title="var">contradiction</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">split</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">pr</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">m</span> <span class="id" title="var">d0</span> <span class="id" title="var">Γ'</span> <span class="id" title="var">α</span> <span class="id" title="var">β</span> <span class="id" title="var">m_le_n</span> <span class="id" title="var">H</span> <span class="id" title="var">H0</span> <span class="id" title="var">H1</span> <span class="id" title="var">H2</span> <span class="id" title="var">p</span> <span class="id" title="var">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> "∈". <span class="id" title="tactic">intros</span> <span class="id" title="var">d'0</span> <span class="id" title="var">H4</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">have</span> <span class="id" title="var">bla</span> := <span class="id" title="var">fcont_eq_compat</span> <span class="id" title="var">d_eq_d'</span> (<span class="id" title="var">tset_refl</span> <span class="id" title="var">d0</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">have</span> <span class="id" title="var">ble</span> := <span class="id" title="var">Tests_Equal'</span> <span class="id" title="var">bla</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">ble</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H4</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">pr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">H6</span> <span class="id" title="var">m</span> <span class="id" title="var">d0</span> <span class="id" title="var">Γ'</span> <span class="id" title="var">α</span> <span class="id" title="var">β</span> <span class="id" title="var">m_le_n</span> <span class="id" title="var">H</span> <span class="id" title="var">H0</span> <span class="id" title="var">H1</span> <span class="id" title="var">H2</span> <span class="id" title="var">p</span> <span class="id" title="var">H3</span> <span class="id" title="var">d'0</span> <span class="id" title="var">H4</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">c</span> ; <span class="id" title="tactic">try</span> <span class="id" title="var">contradiction</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">v</span> ; <span class="id" title="tactic">try</span> <span class="id" title="var">contradiction</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">split</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">pr</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">m</span> <span class="id" title="var">m_le_n</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">split</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">d'0</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">apply</span> (<span class="id" title="var">snd</span> <span class="id" title="var">pr</span>). <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">have</span> <span class="id" title="var">bla</span> := <span class="id" title="var">fcont_eq_compat</span> (<span class="id" title="var">tset_refl</span> (<span class="id" title="var">FST</span> (<span class="id" title="var">ty_denot</span> <span class="id" title="var">a1</span>) (<span class="id" title="var">ty_denot</span> <span class="id" title="var">a2</span>)))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">d_eq_d'</span>. <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">bla</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">have</span> <span class="id" title="var">ble</span> := <span class="id" title="var">Tests_Equal'</span> <span class="id" title="var">bla</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">ble</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">d'0</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">apply</span> (<span class="id" title="var">snd</span> <span class="id" title="var">pr</span>). <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">have</span> <span class="id" title="var">bla</span> := <span class="id" title="var">fcont_eq_compat</span> (<span class="id" title="var">tset_refl</span> (<span class="id" title="var">SND</span> (<span class="id" title="var">ty_denot</span> <span class="id" title="var">a1</span>) (<span class="id" title="var">ty_denot</span> <span class="id" title="var">a2</span>)))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">d_eq_d'</span>. <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">bla</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">have</span> <span class="id" title="var">ble</span> := <span class="id" title="var">Tests_Equal'</span> <span class="id" title="var">bla</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">ble</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">primitive_realizer</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">n</span> <span class="id" title="var">Γ</span> <span class="id" title="var">α</span> <span class="id" title="var">a</span> (<span class="id" title="var">d</span> : <span class="id" title="var">t_ty_denot</span> <span class="id" title="var">a</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">SetIn</span> (<span class="id" title="var">Primitives</span> <span class="id" title="var">a</span> <span class="id" title="var">n</span> <span class="id" title="var">d</span>) (<span class="id" title="var">Γ</span>, <span class="id" title="var">α</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">SetIn</span> (<span class="id" title="var">Realizers</span> <span class="id" title="var">a</span> <span class="id" title="var">n</span> (<span class="id" title="var">eta</span> <span class="id" title="var">d</span>)) (<span class="id" title="var">Γ</span>, <span class="id" title="var">α</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">n</span> <span class="id" title="var">Γ</span> <span class="id" title="var">α</span> <span class="id" title="var">a</span> <span class="id" title="var">d</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">r_in</span> (<span class="id" title="var">m</span>,<span class="id" title="var">d'</span>) <span class="id" title="var">d'test</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">d'test</span> (<span class="id" title="var">n</span>, (<span class="id" title="var">Γ</span>, <span class="id" title="var">α</span>))). <span class="id" title="tactic">apply</span> <span class="id" title="var">d'test</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">LiftRel</span>, "∈". <span class="id" title="tactic">exists</span> <span class="id" title="var">d</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">Tests_Equal</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">n</span> <span class="id" title="var">Γ</span> <span class="id" title="var">Δ</span> <span class="id" title="var">s</span> <span class="id" title="var">a</span> <span class="id" title="var">d</span>, <span class="id" title="var">Γ</span> ≃ <span class="id" title="var">Δ</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">SetIn</span> (<span class="id" title="var">Tests</span> <span class="id" title="var">a</span> <span class="id" title="var">d</span>) (<span class="id" title="var">n</span>, (<span class="id" title="var">Γ</span>, <span class="id" title="var">s</span>)) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">SetIn</span> (<span class="id" title="var">Tests</span> <span class="id" title="var">a</span> <span class="id" title="var">d</span>) (<span class="id" title="var">n</span>, (<span class="id" title="var">Δ</span>, <span class="id" title="var">s</span>)).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">n</span> <span class="id" title="var">Γ</span> <span class="id" title="var">Δ</span> <span class="id" title="var">s</span> <span class="id" title="var">a</span> <span class="id" title="var">d</span> <span class="id" title="var">EQ</span> <span class="id" title="var">I</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> (<span class="id" title="var">m</span>, (<span class="id" title="var">Γ'</span>,(<span class="id" title="var">c</span>,<span class="id" title="var">η</span>))) <span class="id" title="var">r_in</span>. <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">H</span> <span class="id" title="var">H0</span> <span class="id" title="var">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">Γ'</span> ∪ <span class="id" title="var">Δ</span> ≃ <span class="id" title="var">Γ'</span> ∪ <span class="id" title="var">Γ</span>) <span class="id" title="keyword">as</span> <span class="id" title="var">EQ'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">Equal_join_mor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">symmetry</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">pattern</span> (<span class="id" title="var">Γ'</span> ∪ <span class="id" title="var">Δ</span>). <span class="id" title="tactic">rewrite</span> -&gt; <span class="id" title="var">EQ'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">I</span> (<span class="id" title="var">m</span>, (<span class="id" title="var">Γ'</span>, (<span class="id" title="var">c</span>, <span class="id" title="var">η</span>))) <span class="id" title="var">r_in</span>). <span class="id" title="tactic">apply</span> <span class="id" title="var">I</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">EQ</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">EQ</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">EQ</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Add</span> <span class="id" title="var">Parametric</span> <span class="id" title="var">Morphism</span> <span class="id" title="var">n</span> <span class="id" title="var">a</span> (<span class="id" title="var">d</span> : <span class="id" title="var">ty_denot</span> <span class="id" title="var">a</span>) <span class="id" title="var">α</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <span class="id" title="var">Γ</span> =&gt; <span class="id" title="var">SetIn</span> (<span class="id" title="var">Tests</span> <span class="id" title="var">a</span> <span class="id" title="var">d</span>) (<span class="id" title="var">n</span>, (<span class="id" title="var">Γ</span>, <span class="id" title="var">α</span>))) <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">signature</span> <span class="id" title="var">Equal</span> ==&gt; <span class="id" title="var">iff</span> <span class="id" title="keyword">as</span> <span class="id" title="var">tests_heap_mor</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">Γ</span> <span class="id" title="var">Δ</span> <span class="id" title="var">EQ</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">split</span> ;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">Tests_Equal</span> ;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">symmetry</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">primitive_StepI</span> : <span class="id" title="keyword">forall</span> (<span class="id" title="var">θ</span> : <span class="id" title="keyword">type</span>) (<span class="id" title="var">Γ</span> : <span class="id" title="var">Heap</span>) (<span class="id" title="var">α</span> : <span class="id" title="var">MClos</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">d</span> : <span class="id" title="var">t_ty_denot</span> <span class="id" title="var">θ</span>) (<span class="id" title="var">i</span> : <span class="id" title="var">nat</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">Γ</span>,<span class="id" title="var">α</span>) ∈ <span class="id" title="var">Rp</span>(<span class="id" title="var">θ</span>, <span class="id" title="var">i</span>.+1, <span class="id" title="var">d</span>) -&gt; (<span class="id" title="var">Γ</span>,<span class="id" title="var">α</span>) ∈ <span class="id" title="var">Rp</span>(<span class="id" title="var">θ</span>, <span class="id" title="var">i</span>, <span class="id" title="var">d</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">θ</span> <span class="id" title="var">Γ</span> (<span class="id" title="var">c</span>,<span class="id" title="var">η</span>) <span class="id" title="var">d</span> <span class="id" title="var">i</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">θ</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">Case</span> "θ = tunit". <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">Case</span> "θ = tint". <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">Case</span> "θ = θ1 ⇾ θ2".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> "∈" <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">c</span> ; <span class="id" title="tactic">try</span> <span class="id" title="var">contradiction</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">v</span> ; <span class="id" title="tactic">try</span> <span class="id" title="var">contradiction</span>. <span class="id" title="tactic">split</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">m</span> <span class="id" title="var">d0</span> <span class="id" title="var">Γ'</span> <span class="id" title="var">α</span> <span class="id" title="var">β</span> <span class="id" title="var">H0</span> <span class="id" title="var">H1</span> <span class="id" title="var">H2</span> <span class="id" title="var">H3</span> <span class="id" title="var">H4</span> <span class="id" title="var">p</span> <span class="id" title="var">H5</span>. <span class="id" title="tactic">eapply</span> (<span class="id" title="var">snd</span> <span class="id" title="var">H</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">Lt.lt_S</span>. <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H1</span>. <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">Case</span> "θ = θ1 ⨱ θ2".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> "∈" <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">c</span> ; <span class="id" title="tactic">try</span> <span class="id" title="var">contradiction</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">v</span> ; <span class="id" title="tactic">try</span> <span class="id" title="var">contradiction</span>. <span class="id" title="tactic">split</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">m</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">apply</span> (<span class="id" title="var">snd</span> <span class="id" title="var">H</span>). <span class="id" title="tactic">apply</span> <span class="id" title="var">Lt.lt_S</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">test_StepI</span> : <span class="id" title="keyword">forall</span> (<span class="id" title="var">θ</span> : <span class="id" title="keyword">type</span>) (<span class="id" title="var">Δ</span> : <span class="id" title="var">Heap</span>) (<span class="id" title="var">s</span> : <span class="id" title="var">stack</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">d</span> : <span class="id" title="var">ty_denot</span> <span class="id" title="var">θ</span>) (<span class="id" title="var">i</span> : <span class="id" title="var">nat</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">SetIn</span> (<span class="id" title="var">Tests</span> <span class="id" title="var">θ</span> <span class="id" title="var">d</span>) (<span class="id" title="var">i</span>.+1, (<span class="id" title="var">Δ</span>, <span class="id" title="var">s</span>)) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">SetIn</span> (<span class="id" title="var">Tests</span> <span class="id" title="var">θ</span> <span class="id" title="var">d</span>) (<span class="id" title="var">i</span>, (<span class="id" title="var">Δ</span>, <span class="id" title="var">s</span>)).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">θ</span> <span class="id" title="var">Δ</span> <span class="id" title="var">s</span> <span class="id" title="var">d</span> <span class="id" title="var">i</span> <span class="id" title="var">Δs_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> (<span class="id" title="var">j</span>, (<span class="id" title="var">Γ</span>, (<span class="id" title="var">c</span>, <span class="id" title="var">η</span>))) <span class="id" title="var">r_in</span>. <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">Δs_in</span> (<span class="id" title="var">j</span>,(<span class="id" title="var">Γ</span>, (<span class="id" title="var">c</span>, <span class="id" title="var">η</span>))) <span class="id" title="var">r_in</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">have</span> <span class="id" title="var">H0</span> := <span class="id" title="var">Min.min_spec</span> <span class="id" title="var">i</span> <span class="id" title="var">j</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">H0</span> <span class="id" title="keyword">as</span> [[? ?] | [? ?]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">rwf</span> <span class="id" title="var">twf</span> <span class="id" title="var">Γ_Δ</span>. <span class="id" title="tactic">specialize</span> (<span class="id" title="var">Δs_in</span> <span class="id" title="var">rwf</span> <span class="id" title="var">twf</span> <span class="id" title="var">Γ_Δ</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">Nat.min_comm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> -&gt; <span class="id" title="var">H0</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">Lt.lt_le_S</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">Min.min_l</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Nat.min_comm</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">rewrite</span> -&gt; <span class="id" title="var">H</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Δs_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> (<span class="id" title="var">decreasing</span> <span class="id" title="var">stepI</span> <span class="id" title="var">i</span>). <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">rwf</span> <span class="id" title="var">twf</span> <span class="id" title="var">Γ_Δ</span>. <span class="id" title="tactic">specialize</span> (<span class="id" title="var">Δs_in</span> <span class="id" title="var">rwf</span> <span class="id" title="var">twf</span> <span class="id" title="var">Γ_Δ</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">Nat.min_comm</span>. <span class="id" title="tactic">rewrite</span> -&gt; <span class="id" title="var">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">have</span> <span class="id" title="var">j_leq_Si</span> := <span class="id" title="var">Nat.le_trans</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">H</span> (<span class="id" title="var">Le.le_n_Sn</span> <span class="id" title="var">i</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">have</span> <span class="id" title="var">j_min_Si</span> := <span class="id" title="var">Min.min_r</span> (<span class="id" title="var">i</span>.+1) <span class="id" title="var">j</span> <span class="id" title="var">j_leq_Si</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">Nat.min_comm</span> <span class="id" title="tactic">in</span> <span class="id" title="var">j_min_Si</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> -&gt; <span class="id" title="var">j_min_Si</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Δs_in</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">test_gen_StepI</span> : <span class="id" title="keyword">forall</span> (<span class="id" title="var">θ</span> : <span class="id" title="keyword">type</span>) (<span class="id" title="var">Δ</span> : <span class="id" title="var">Heap</span>) (<span class="id" title="var">s</span> : <span class="id" title="var">stack</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">d</span> : <span class="id" title="var">ty_denot</span> <span class="id" title="var">θ</span>) (<span class="id" title="var">i</span> <span class="id" title="var">j</span> : <span class="id" title="var">nat</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">j</span> &lt;= <span class="id" title="var">i</span>)%<span class="id" title="var">coq_nat</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">SetIn</span> (<span class="id" title="var">Tests</span> <span class="id" title="var">θ</span> <span class="id" title="var">d</span>) (<span class="id" title="var">i</span>, (<span class="id" title="var">Δ</span>, <span class="id" title="var">s</span>)) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">SetIn</span> (<span class="id" title="var">Tests</span> <span class="id" title="var">θ</span> <span class="id" title="var">d</span>) (<span class="id" title="var">j</span>, (<span class="id" title="var">Δ</span>, <span class="id" title="var">s</span>)).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">θ</span> <span class="id" title="var">Γ</span> <span class="id" title="var">α</span> <span class="id" title="var">d</span> <span class="id" title="var">i</span> <span class="id" title="var">j</span> <span class="id" title="var">j_leq_i</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">i</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">Case</span> "i = 0".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">j_leq_i</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">Case</span> "i = i.+1".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">Nat.le_succ_r</span> <span class="id" title="tactic">in</span> <span class="id" title="var">j_leq_i</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">j_leq_i</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">j_leq_i</span> | <span class="id" title="var">j_eq_i</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">IHi</span>. <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">test_StepI</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">j_eq_i</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">realizer_StepI</span> :  <span class="id" title="keyword">forall</span> (<span class="id" title="var">θ</span> : <span class="id" title="keyword">type</span>) (<span class="id" title="var">Γ</span> : <span class="id" title="var">Heap</span>) (<span class="id" title="var">α</span> : <span class="id" title="var">MClos</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">d</span> : <span class="id" title="var">ty_denot</span> <span class="id" title="var">θ</span>) (<span class="id" title="var">i</span> : <span class="id" title="var">nat</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">Γ</span>,<span class="id" title="var">α</span>) ∈ <span class="id" title="var">R</span>(<span class="id" title="var">θ</span>, <span class="id" title="var">i</span>.+1, <span class="id" title="var">d</span>) -&gt; (<span class="id" title="var">Γ</span>,<span class="id" title="var">α</span>) ∈ <span class="id" title="var">R</span>(<span class="id" title="var">θ</span>, <span class="id" title="var">i</span>, <span class="id" title="var">d</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">θ</span> <span class="id" title="var">Γ</span> (<span class="id" title="var">c</span>,<span class="id" title="var">η</span>) <span class="id" title="var">d</span> <span class="id" title="var">i</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> (<span class="id" title="var">j</span>,(<span class="id" title="var">Δ</span>,<span class="id" title="var">s</span>)) <span class="id" title="var">jΔs_in</span> <span class="id" title="var">rwf</span> <span class="id" title="var">twf</span> <span class="id" title="var">Γ_Δ</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">H</span> (<span class="id" title="var">j</span>,(<span class="id" title="var">Δ</span>,<span class="id" title="var">s</span>)) <span class="id" title="var">jΔs_in</span> <span class="id" title="var">rwf</span> <span class="id" title="var">twf</span> <span class="id" title="var">Γ_Δ</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">have</span> <span class="id" title="var">H0</span> := <span class="id" title="var">Min.min_spec</span> <span class="id" title="var">i</span> <span class="id" title="var">j</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">H0</span> <span class="id" title="keyword">as</span> [[? ?] | [? ?]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> -&gt; <span class="id" title="var">H1</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">Lt.lt_le_S</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">Min.min_l</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">rewrite</span> -&gt; <span class="id" title="var">H0</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> (<span class="id" title="var">decreasing</span> <span class="id" title="var">stepI</span> <span class="id" title="var">i</span>). <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> -&gt; <span class="id" title="var">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">have</span> <span class="id" title="var">j_leq_Si</span> := <span class="id" title="var">Nat.le_trans</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">H0</span> (<span class="id" title="var">Le.le_n_Sn</span> <span class="id" title="var">i</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">have</span> <span class="id" title="var">j_min_Si</span> := <span class="id" title="var">Min.min_r</span> (<span class="id" title="var">i</span>.+1) <span class="id" title="var">j</span> <span class="id" title="var">j_leq_Si</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> -&gt; <span class="id" title="var">j_min_Si</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">primitive_gen_StepI</span> : <span class="id" title="keyword">forall</span> (<span class="id" title="var">θ</span> : <span class="id" title="keyword">type</span>) (<span class="id" title="var">Γ</span> : <span class="id" title="var">Heap</span>) (<span class="id" title="var">α</span> : <span class="id" title="var">MClos</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">d</span> : <span class="id" title="var">t_ty_denot</span> <span class="id" title="var">θ</span>) (<span class="id" title="var">i</span> <span class="id" title="var">j</span> : <span class="id" title="var">nat</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">j</span> &lt;= <span class="id" title="var">i</span>)%<span class="id" title="var">coq_nat</span> -&gt; (<span class="id" title="var">Γ</span>,<span class="id" title="var">α</span>) ∈ <span class="id" title="var">Rp</span>(<span class="id" title="var">θ</span>, <span class="id" title="var">i</span>, <span class="id" title="var">d</span>) -&gt; (<span class="id" title="var">Γ</span>,<span class="id" title="var">α</span>) ∈ <span class="id" title="var">Rp</span>(<span class="id" title="var">θ</span>, <span class="id" title="var">j</span>, <span class="id" title="var">d</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">θ</span> <span class="id" title="var">Γ</span> <span class="id" title="var">α</span> <span class="id" title="var">d</span> <span class="id" title="var">i</span> <span class="id" title="var">j</span> <span class="id" title="var">j_leq_i</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">i</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">Case</span> "i = 0".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">j_leq_i</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">Case</span> "i = i.+1".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">Nat.le_succ_r</span> <span class="id" title="tactic">in</span> <span class="id" title="var">j_leq_i</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">j_leq_i</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">j_leq_i</span> | <span class="id" title="var">j_eq_i</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">IHi</span>. <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">primitive_StepI</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">j_eq_i</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>

<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">realizer_gen_StepI</span> : <span class="id" title="keyword">forall</span> (<span class="id" title="var">θ</span> : <span class="id" title="keyword">type</span>) (<span class="id" title="var">Γ</span> : <span class="id" title="var">Heap</span>) (<span class="id" title="var">α</span> : <span class="id" title="var">MClos</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">d</span> : <span class="id" title="var">ty_denot</span> <span class="id" title="var">θ</span>) (<span class="id" title="var">i</span> <span class="id" title="var">j</span> : <span class="id" title="var">nat</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">j</span> &lt;= <span class="id" title="var">i</span>)%<span class="id" title="var">coq_nat</span> -&gt; (<span class="id" title="var">Γ</span>,<span class="id" title="var">α</span>) ∈ <span class="id" title="var">R</span>(<span class="id" title="var">θ</span>,<span class="id" title="var">i</span>,<span class="id" title="var">d</span>) -&gt; (<span class="id" title="var">Γ</span>,<span class="id" title="var">α</span>) ∈ <span class="id" title="var">R</span>(<span class="id" title="var">θ</span>,<span class="id" title="var">j</span>,<span class="id" title="var">d</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">θ</span> <span class="id" title="var">Γ</span> <span class="id" title="var">α</span> <span class="id" title="var">d</span> <span class="id" title="var">i</span> <span class="id" title="var">j</span> <span class="id" title="var">j_leq_i</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">i</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">Case</span> "i = 0".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">j_leq_i</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">Case</span> "i = i.+1".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">Nat.le_succ_r</span> <span class="id" title="tactic">in</span> <span class="id" title="var">j_leq_i</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">j_leq_i</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">j_leq_i</span> | <span class="id" title="var">j_eq_i</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">IHi</span>. <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">realizer_StepI</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">j_eq_i</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">EnvRealizers</span> (<span class="id" title="var">n</span> : <span class="id" title="var">nat</span>) (<span class="id" title="var">ctx</span> : <span class="id" title="var">ctx</span>) : <span class="id" title="var">ctx_denot</span> <span class="id" title="var">ctx</span> -&gt; <span class="id" title="var">Ensemble</span> <span class="id" title="var">EType</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">ctx</span> <span class="id" title="keyword">return</span> <span class="id" title="var">ctx_denot</span> <span class="id" title="var">ctx</span> -&gt; <span class="id" title="var">Ensemble</span> <span class="id" title="var">EType</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">nil</span> =&gt; <span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="keyword">fun</span> <span class="id" title="var">er</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">er</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">Γ</span>, <span class="id" title="var">nil</span>) =&gt; <span class="id" title="var">True</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">_</span> =&gt; <span class="id" title="var">False</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">a</span> :: <span class="id" title="var">ctx</span> =&gt; <span class="id" title="keyword">fun</span> ρ =&gt; <span class="id" title="keyword">fun</span> <span class="id" title="var">er</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> (<span class="id" title="var">d</span>, ρ') := ρ <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">er</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">Γ</span>, <span class="id" title="var">p</span> :: <span class="id" title="var">η</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">SetIn</span> (<span class="id" title="var">EnvRealizers</span> <span class="id" title="var">n</span> <span class="id" title="var">ctx</span> ρ') (<span class="id" title="var">Γ</span>, <span class="id" title="var">η</span>) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exists</span> <span class="id" title="var">α</span> <span class="id" title="var">β</span>, <span class="id" title="var">find</span> <span class="id" title="var">p</span> <span class="id" title="var">Γ</span> = <span class="id" title="var">Some</span> <span class="id" title="var">β</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">HClos_to_MClos</span> <span class="id" title="var">β</span> = <span class="id" title="var">Some</span> <span class="id" title="var">α</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">SetIn</span> (<span class="id" title="var">Realizers</span> <span class="id" title="var">a</span> <span class="id" title="var">n</span> <span class="id" title="var">d</span>) (<span class="id" title="var">Γ</span>, <span class="id" title="var">α</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">_</span> =&gt; <span class="id" title="var">False</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Notation</span> &quot;g ⊴ n | p" := (<span class="id" title="var">SetIn</span> (<span class="id" title="var">EnvRealizers</span> <span class="id" title="var">n</span> <span class="id" title="var">_</span> <span class="id" title="var">p</span>) <span class="id" title="var">g</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 80, <span class="id" title="keyword">no</span> <span class="id" title="keyword">associativity</span>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">GRealizers</span> (<span class="id" title="var">c</span> : <span class="id" title="var">ctx</span>) (<span class="id" title="var">a</span> : <span class="id" title="keyword">type</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">d</span> : <span class="id" title="var">ctx_denot</span> <span class="id" title="var">c</span> =-&gt; <span class="id" title="var">ty_denot</span> <span class="id" title="var">a</span>) : <span class="id" title="var">Ensemble</span> <span class="id" title="var">Code</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;:= <span class="id" title="keyword">fun</span> <span class="id" title="var">i</span> =&gt; <span class="id" title="keyword">forall</span> (<span class="id" title="var">n</span> : <span class="id" title="var">nat</span>) (<span class="id" title="var">Γ</span> : <span class="id" title="var">Heap</span>) (<span class="id" title="var">η</span> : <span class="id" title="var">MEnv</span>) (ρ : <span class="id" title="var">ctx_denot</span> <span class="id" title="var">c</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">heap_wf</span> <span class="id" title="var">Γ</span> -&gt; (<span class="id" title="var">Γ</span>, <span class="id" title="var">η</span>) ⊴ <span class="id" title="var">n</span> | ρ -&gt; (<span class="id" title="var">Γ</span>,(<span class="id" title="var">i</span>, <span class="id" title="var">η</span>)) ∈ <span class="id" title="var">R</span>(<span class="id" title="var">a</span>,<span class="id" title="var">n</span>,<span class="id" title="var">d</span> ρ)<br/>
&nbsp;&nbsp;.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Notation</span> &quot;π '⊢' i '◀|' d" := (@<span class="id" title="var">GRealizers</span> π <span class="id" title="var">_</span> <span class="id" title="var">d</span> <span class="id" title="var">i</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 201, <span class="id" title="keyword">no</span> <span class="id" title="keyword">associativity</span>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Definition</span> <span class="id" title="var">exists_fresh_pointer</span> := <span class="id" title="keyword">forall</span> <span class="id" title="var">Γ</span> <span class="id" title="var">η</span> <span class="id" title="var">s</span>, <span class="id" title="tactic">exists</span> <span class="id" title="var">p</span>, <span class="id" title="var">fresh_for</span> <span class="id" title="var">p</span> <span class="id" title="var">Γ</span> <span class="id" title="var">η</span> <span class="id" title="var">s</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">isatif_down_closed</span> : <span class="id" title="keyword">forall</span> (<span class="id" title="var">r</span> : <span class="id" title="var">RType</span>) (<span class="id" title="var">t</span> : <span class="id" title="var">TType</span>) (<span class="id" title="var">i</span> <span class="id" title="var">j</span> : <span class="id" title="var">nat</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">j</span> &lt;= <span class="id" title="var">i</span>)%<span class="id" title="var">coq_nat</span> -&gt; <span class="id" title="var">isatif</span> <span class="id" title="var">i</span> <span class="id" title="var">r</span> <span class="id" title="var">t</span> -&gt; <span class="id" title="var">isatif</span> <span class="id" title="var">j</span> <span class="id" title="var">r</span> <span class="id" title="var">t</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> (<span class="id" title="var">Γ</span>,<span class="id" title="var">α</span>) (<span class="id" title="var">Δ</span>,<span class="id" title="var">s</span>) <span class="id" title="var">i</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">i</span>; <span class="id" title="tactic">intros</span> <span class="id" title="var">j</span> <span class="id" title="var">j_leq_i</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">Case</span> "i = 0".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">j_leq_i</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">Case</span> "i =&gt; i+1".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">Lt.le_lt_or_eq</span> <span class="id" title="tactic">in</span> <span class="id" title="var">j_leq_i</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">j_leq_i</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">j_le_Si</span> | <span class="id" title="var">j_eq_Si</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">Lt.lt_le_S</span> <span class="id" title="tactic">in</span> <span class="id" title="var">j_le_Si</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">Le.le_S_n</span> <span class="id" title="tactic">in</span> <span class="id" title="var">j_le_Si</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">IHi</span>. <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">rwf</span> <span class="id" title="var">twf</span> <span class="id" title="var">Γ_Δ</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> (<span class="id" title="var">decreasing</span> <span class="id" title="var">stepI</span> <span class="id" title="var">i</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> -&gt; <span class="id" title="var">j_eq_Si</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">bbot_down_closed</span> : <span class="id" title="keyword">forall</span> (<span class="id" title="var">θ</span> : <span class="id" title="keyword">type</span>) (<span class="id" title="var">d</span> : <span class="id" title="var">ty_denot</span> <span class="id" title="var">θ</span>) (<span class="id" title="var">t</span> : <span class="id" title="var">TType</span>) (<span class="id" title="var">i</span> <span class="id" title="var">j</span> : <span class="id" title="var">nat</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">j</span> &lt;= <span class="id" title="var">i</span>)%<span class="id" title="var">coq_nat</span> -&gt; (<span class="id" title="var">i</span>, <span class="id" title="var">t</span>) ∈ <span class="id" title="var">Tests</span> <span class="id" title="var">θ</span> <span class="id" title="var">d</span> -&gt; (<span class="id" title="var">j</span>, <span class="id" title="var">t</span>) ∈ <span class="id" title="var">Tests</span> <span class="id" title="var">θ</span> <span class="id" title="var">d</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">θ</span> <span class="id" title="var">d</span> (<span class="id" title="var">Δ</span>,<span class="id" title="var">s</span>) <span class="id" title="var">i</span> <span class="id" title="var">j</span> <span class="id" title="var">j_leq_i</span> <span class="id" title="var">t_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> (<span class="id" title="var">i'</span>,<span class="id" title="var">r</span>) <span class="id" title="var">ir_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">t_in</span> (<span class="id" title="var">i'</span>,<span class="id" title="var">r</span>) <span class="id" title="var">ir_in</span>) <span class="id" title="keyword">as</span> <span class="id" title="var">satif</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">Nat.min_le_compat_l</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">p</span>:=<span class="id" title="var">i'</span>) <span class="id" title="tactic">in</span> <span class="id" title="var">j_leq_i</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">isatif_down_closed</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">j_leq_i</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">tests_bot</span> : <span class="id" title="keyword">forall</span> (<span class="id" title="var">n</span> : <span class="id" title="var">nat</span>) (<span class="id" title="var">θ</span> : <span class="id" title="keyword">type</span>) (<span class="id" title="var">Γ</span> : <span class="id" title="var">Heap</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">SetIn</span> (<span class="id" title="var">Tests</span> <span class="id" title="var">θ</span> <span class="id" title="var">PBot</span>) (<span class="id" title="var">n</span>, (<span class="id" title="var">Γ</span>, <span class="id" title="var">nil</span>)).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">n</span> <span class="id" title="var">θ</span> <span class="id" title="var">Γ</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> (<span class="id" title="var">m</span>, <span class="id" title="var">r</span>) <span class="id" title="var">LiftRp</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">LiftRp</span> <span class="id" title="keyword">as</span> [? [? <span class="id" title="var">_</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">symmetry</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">PBot_incon_eq</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">contradiction</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">var_to_nat_lookup</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">ctx</span> <span class="id" title="var">a</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">v</span> : <span class="id" title="var">var</span> <span class="id" title="var">ctx</span> <span class="id" title="var">a</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> ρ : <span class="id" title="var">ctx_denot</span> <span class="id" title="var">ctx</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">Q</span> : <span class="id" title="var">nth_error</span> <span class="id" title="var">ctx</span> (<span class="id" title="var">var_to_nat</span> <span class="id" title="var">v</span>) = <span class="id" title="var">Some</span> <span class="id" title="var">a</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">lookup</span> <span class="id" title="var">v</span> ρ = <span class="id" title="var">lookup_nat</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">Q</span> ρ.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">v</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> ρ <span class="id" title="var">Q</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">dependent</span> <span class="id" title="tactic">destruction</span> <span class="id" title="var">Q</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> ρ <span class="id" title="var">Q</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> ρ <span class="id" title="keyword">as</span> [<span class="id" title="var">d</span> ρ'].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Q</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">compose</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">env_realizer_lookup</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">n</span> <span class="id" title="var">Γ</span> <span class="id" title="var">η</span> <span class="id" title="var">ctx</span> (ρ : <span class="id" title="var">ctx_denot</span> <span class="id" title="var">ctx</span>) <span class="id" title="var">a</span> (<span class="id" title="var">i</span> : <span class="id" title="var">nat</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">Q</span> : <span class="id" title="var">nth_error</span> <span class="id" title="var">ctx</span> <span class="id" title="var">n</span> = <span class="id" title="var">Some</span> <span class="id" title="var">a</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">Γ</span>, <span class="id" title="var">η</span>) ⊴ <span class="id" title="var">i</span> | ρ -&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exists</span> <span class="id" title="var">p</span>, <span class="id" title="var">nth_error</span> <span class="id" title="var">η</span> <span class="id" title="var">n</span> = <span class="id" title="var">Some</span> <span class="id" title="var">p</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exists</span> <span class="id" title="var">α</span> <span class="id" title="var">β</span>, <span class="id" title="var">find</span> <span class="id" title="var">p</span> <span class="id" title="var">Γ</span> = <span class="id" title="var">Some</span> <span class="id" title="var">β</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/\ <span class="id" title="var">HClos_to_MClos</span> <span class="id" title="var">β</span> = <span class="id" title="var">Some</span> <span class="id" title="var">α</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/\ (<span class="id" title="var">Γ</span>, <span class="id" title="var">α</span>) ∈ <span class="id" title="var">R</span>(<span class="id" title="var">a</span>,<span class="id" title="var">i</span>, <span class="id" title="var">lookup_nat</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">Q</span> ρ).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">n</span> ;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">Γ</span> <span class="id" title="var">η</span> <span class="id" title="var">ctx</span> ρ <span class="id" title="var">a</span> <span class="id" title="var">i</span> <span class="id" title="var">Q</span> <span class="id" title="var">Hr0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Q</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">ctx</span> <span class="id" title="keyword">as</span> [ | <span class="id" title="var">a'</span> <span class="id" title="var">ctx'</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">injection</span> <span class="id" title="var">Q</span>. <span class="id" title="tactic">intro</span>. <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> ρ <span class="id" title="keyword">as</span> [<span class="id" title="var">d</span> ρ'].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">η</span> <span class="id" title="keyword">as</span> [ | <span class="id" title="var">p</span>  <span class="id" title="var">η'</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">contradiction</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">Hr0</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">Her1</span> [<span class="id" title="var">α</span> [<span class="id" title="var">β</span> [<span class="id" title="var">F0</span> [? <span class="id" title="var">Hr2</span>]]]]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exists</span> <span class="id" title="var">p</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">split</span>. <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exists</span> <span class="id" title="var">α</span>, <span class="id" title="var">β</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">split</span> ; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">dependent</span> <span class="id" title="tactic">destruction</span> <span class="id" title="var">Q</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Q</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">ctx</span> <span class="id" title="keyword">as</span> [ | <span class="id" title="var">a'</span> <span class="id" title="var">ctx'</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> ρ <span class="id" title="keyword">as</span> [<span class="id" title="var">d</span> ρ'].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">η</span> <span class="id" title="keyword">as</span> [ | <span class="id" title="var">p</span>  <span class="id" title="var">η'</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">contradiction</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">IHn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">Hr0</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">isatif_eq_Fullset</span> : <span class="id" title="keyword">forall</span> (<span class="id" title="var">r</span> : <span class="id" title="var">RType</span>) (<span class="id" title="var">t</span> : <span class="id" title="var">TType</span>), <span class="id" title="var">isatif</span> 0 <span class="id" title="var">r</span> <span class="id" title="var">t</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> (<span class="id" title="var">Γ</span>,<span class="id" title="var">α</span>) (<span class="id" title="var">Δ</span>,<span class="id" title="var">s</span>) <span class="id" title="var">Γwf</span> <span class="id" title="var">Δwf</span> <span class="id" title="var">Γ_Δ</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> (<span class="id" title="var">zero</span> <span class="id" title="var">stepI</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">Full_intro</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">r_wf_find</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">Γ</span> <span class="id" title="var">p</span> <span class="id" title="var">α</span> <span class="id" title="var">β</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">heap_wf</span> <span class="id" title="var">Γ</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Map.find</span> <span class="id" title="var">p</span> <span class="id" title="var">Γ</span> = <span class="id" title="var">Some</span> <span class="id" title="var">β</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">HClos_to_MClos</span> <span class="id" title="var">β</span> = <span class="id" title="var">Some</span> <span class="id" title="var">α</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">r_wf</span> (<span class="id" title="var">Γ</span>, <span class="id" title="var">α</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">Γ</span> <span class="id" title="var">p</span> <span class="id" title="var">β</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">Hwf</span> <span class="id" title="var">Hf</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">β</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">he</span> <span class="id" title="var">η</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">split</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">transitivity</span> (<span class="id" title="var">heap_range_ptr</span> <span class="id" title="var">Γ</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">find_heap_range</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">Hwf</span>; <span class="id" title="tactic">destruct</span> <span class="id" title="var">e</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">rewrite</span> -&gt; <span class="id" title="var">H</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">transitivity</span> (<span class="id" title="var">heap_ptr</span> <span class="id" title="var">Γ</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">heap_ptr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">auto</span> <span class="id" title="keyword">with</span> <span class="id" title="var">sets</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">heap_ptr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">Hf</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">r_wf_heap</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">Γ</span> <span class="id" title="var">α</span>, <span class="id" title="var">r_wf</span> (<span class="id" title="var">Γ</span>, <span class="id" title="var">α</span>) -&gt; <span class="id" title="var">heap_wf</span> <span class="id" title="var">Γ</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">Γ</span> <span class="id" title="var">α</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">α</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">r_wf_heap'</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">Γ</span> <span class="id" title="var">he</span> <span class="id" title="var">η</span>, <span class="id" title="var">r_wf</span> (<span class="id" title="var">Γ</span>, (<span class="id" title="var">he</span>, <span class="id" title="var">η</span>)) -&gt; <span class="id" title="var">heap_wf</span> <span class="id" title="var">Γ</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">Γ</span> <span class="id" title="var">he</span> <span class="id" title="var">η</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">r_wf_joinable</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">Γ</span> <span class="id" title="var">p</span> <span class="id" title="var">α</span> <span class="id" title="var">β</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">MClos_to_HClos</span> <span class="id" title="var">α</span> = <span class="id" title="var">β</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Γ</span> ⋈ ⎨ <span class="id" title="var">p</span> ⤇ <span class="id" title="var">β</span> ⎬ -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">r_wf</span> (<span class="id" title="var">Γ</span>, <span class="id" title="var">α</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">heap_wf</span> (<span class="id" title="var">Γ</span> ∪ ⎨ <span class="id" title="var">p</span> ⤇ <span class="id" title="var">β</span> ⎬).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">Γ</span> <span class="id" title="var">p</span> <span class="id" title="var">α</span> <span class="id" title="var">β</span> <span class="id" title="var">αHclos</span> <span class="id" title="var">Hjble</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">heap_wf</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">Join_heap_ptr</span> ; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">Join_key_set</span> ; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">heap_ptr</span> <span class="id" title="tactic">at</span> 2.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">α</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">i</span> <span class="id" title="var">η</span>]. <span class="id" title="tactic">cbv</span> <span class="id" title="tactic">in</span> <span class="id" title="var">αHclos</span>. <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">αHclos</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">key_set_singleton</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">heap_range_singleton</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">Union_assoc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">set</span> (<span class="id" title="var">H'</span> := <span class="id" title="var">r_wf_heap</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">H</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">heap_wf</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">Union_comm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">Union_subset</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">transitivity</span> (<span class="id" title="var">key_set</span> <span class="id" title="var">Γ</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">Included_Union_1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">auto</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">t_wf_heap</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">Γ</span> <span class="id" title="var">s</span>, <span class="id" title="var">t_wf</span> (<span class="id" title="var">Γ</span>, <span class="id" title="var">s</span>) -&gt; <span class="id" title="var">heap_wf</span> <span class="id" title="var">Γ</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">Γ</span> <span class="id" title="var">s</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Hint Resolve</span> <span class="id" title="var">r_wf_heap</span> <span class="id" title="var">r_wf_heap'</span> <span class="id" title="var">t_wf_heap</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Ltac</span> <span class="id" title="var">pattern_heap_conf</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[ |- <span class="id" title="var">SetIn</span> <span class="id" title="var">_</span> (?<span class="id" title="var">Γ</span>, <span class="id" title="var">_</span>, <span class="id" title="var">_</span>) ] =&gt; <span class="id" title="tactic">pattern</span> <span class="id" title="var">Γ</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Ltac</span> <span class="id" title="var">pattern_heap_realizer</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[ |- <span class="id" title="var">SetIn</span> <span class="id" title="var">_</span> (?<span class="id" title="var">Γ</span>, <span class="id" title="var">_</span>) ] =&gt; <span class="id" title="tactic">pattern</span> <span class="id" title="var">Γ</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Ltac</span> <span class="id" title="var">pattern_heap_test</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[ |- <span class="id" title="var">SetIn</span> <span class="id" title="var">_</span> (<span class="id" title="var">_</span>, (?<span class="id" title="var">Γ</span>, <span class="id" title="var">_</span>)) ] =&gt; <span class="id" title="tactic">pattern</span> <span class="id" title="var">Γ</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Ltac</span> <span class="id" title="var">pattern_satif</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[ |- (<span class="id" title="var">_</span>, (?<span class="id" title="var">Γ</span>, <span class="id" title="var">_</span>)) ⊧ <span class="id" title="var">_</span> ] =&gt; <span class="id" title="tactic">pattern</span> <span class="id" title="var">Γ</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Ltac</span> <span class="id" title="var">heap_rewrite_conf</span> <span class="id" title="var">H</span> := <span class="id" title="var">pattern_heap_conf</span> ; <span class="id" title="tactic">rewrite</span> -&gt; <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Ltac</span> <span class="id" title="var">heap_rewrite_realizer</span> <span class="id" title="var">H</span> := <span class="id" title="var">pattern_heap_realizer</span> ; <span class="id" title="tactic">rewrite</span> -&gt; <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Ltac</span> <span class="id" title="var">heap_rewrite_test</span> <span class="id" title="var">H</span> := <span class="id" title="var">pattern_heap_test</span> ; <span class="id" title="tactic">rewrite</span> -&gt; <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Ltac</span> <span class="id" title="var">rewrite_satif</span> <span class="id" title="var">H</span> := <span class="id" title="var">pattern_satif</span> ; <span class="id" title="tactic">rewrite</span> -&gt; <span class="id" title="var">H</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">satif_Equal1</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;∀ (<span class="id" title="var">n</span> : <span class="id" title="var">nat</span>) (<span class="id" title="var">Γ</span> <span class="id" title="var">Δ</span> : <span class="id" title="var">t</span> <span class="id" title="var">elt_pair</span>) (<span class="id" title="var">c</span> : <span class="id" title="var">Code</span>) (<span class="id" title="var">η</span> : <span class="id" title="var">MEnv</span>) <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">m</span> : <span class="id" title="var">nat</span>) (<span class="id" title="var">Δ'</span> : <span class="id" title="var">Heap</span>) (<span class="id" title="var">s'</span> : <span class="id" title="var">stack</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Γ</span> ≃ <span class="id" title="var">Δ</span> -&gt; (<span class="id" title="var">n</span>, (<span class="id" title="var">Γ</span>, (<span class="id" title="var">c</span>, <span class="id" title="var">η</span>))) ⊧ (<span class="id" title="var">m</span>, (<span class="id" title="var">Δ'</span>, <span class="id" title="var">s'</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;→ (<span class="id" title="var">n</span>, (<span class="id" title="var">Δ</span>, (<span class="id" title="var">c</span>, <span class="id" title="var">η</span>))) ⊧ (<span class="id" title="var">m</span>, (<span class="id" title="var">Δ'</span>, <span class="id" title="var">s'</span>)).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">n</span> <span class="id" title="var">Γ</span> <span class="id" title="var">Δ</span> <span class="id" title="var">c</span> <span class="id" title="var">η</span> <span class="id" title="var">m</span> <span class="id" title="var">Δ'</span> <span class="id" title="var">s'</span> <span class="id" title="var">Γ_eq_Δ</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">rwf</span> <span class="id" title="var">twf</span> <span class="id" title="var">Δ_Δ'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">eq_closed</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">w</span>:=(<span class="id" title="var">Γ</span> ∪ <span class="id" title="var">Δ'</span>, (<span class="id" title="var">c</span>, <span class="id" title="var">η</span>), <span class="id" title="var">s'</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">split</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">Equal_join_mor</span>. <span class="id" title="tactic">rewrite</span> -&gt; <span class="id" title="var">Γ_eq_Δ</span>. <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">F.Equal_refl</span>. <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">split</span>; <span class="id" title="tactic">rewrite</span> -&gt; <span class="id" title="var">Γ_eq_Δ</span>; <span class="id" title="tactic">apply</span> <span class="id" title="var">rwf</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">auto</span>. <span class="id" title="tactic">rewrite</span> -&gt; <span class="id" title="var">Γ_eq_Δ</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Add</span> <span class="id" title="var">Parametric</span> <span class="id" title="var">Morphism</span> <span class="id" title="var">n</span> <span class="id" title="var">α</span> <span class="id" title="var">ts</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <span class="id" title="var">Γ</span> =&gt; (<span class="id" title="var">n</span>, (<span class="id" title="var">Γ</span>, <span class="id" title="var">α</span>)) ⊧ <span class="id" title="var">ts</span>) <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">signature</span> <span class="id" title="var">Equal</span> ==&gt; <span class="id" title="var">iff</span> <span class="id" title="keyword">as</span> <span class="id" title="var">satif_equal1</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">Γ</span> <span class="id" title="var">Δ</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">split</span>; <span class="id" title="tactic">intros</span> <span class="id" title="var">H0</span>; <span class="id" title="tactic">destruct</span> <span class="id" title="var">ts</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">m</span> [<span class="id" title="var">Δ'</span> <span class="id" title="var">s</span>]]; <span class="id" title="tactic">destruct</span> <span class="id" title="var">α</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">c</span> <span class="id" title="var">η</span>];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">satif_Equal1</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">auto</span>. <span class="id" title="tactic">symmetry</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">realizers_Equal</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">n</span> <span class="id" title="var">Γ</span> <span class="id" title="var">Δ</span> <span class="id" title="var">α</span> <span class="id" title="var">a</span> <span class="id" title="var">d</span>, <span class="id" title="var">Γ</span> ≃ <span class="id" title="var">Δ</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">SetIn</span> (<span class="id" title="var">Realizers</span> <span class="id" title="var">a</span> <span class="id" title="var">n</span> <span class="id" title="var">d</span>) (<span class="id" title="var">Γ</span>, <span class="id" title="var">α</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">SetIn</span> (<span class="id" title="var">Realizers</span> <span class="id" title="var">a</span> <span class="id" title="var">n</span> <span class="id" title="var">d</span>) (<span class="id" title="var">Δ</span>, <span class="id" title="var">α</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">n</span> <span class="id" title="var">Γ</span> <span class="id" title="var">Δ</span> (<span class="id" title="var">c</span>, <span class="id" title="var">η</span>) <span class="id" title="var">a</span> <span class="id" title="var">d</span> <span class="id" title="var">Γ_eq_Δ</span> <span class="id" title="var">H</span> (<span class="id" title="var">m</span>, (<span class="id" title="var">Δ'</span>, <span class="id" title="var">s'</span>)) <span class="id" title="var">its_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">H</span> (<span class="id" title="var">m</span>, (<span class="id" title="var">Δ'</span>, <span class="id" title="var">s'</span>)) <span class="id" title="var">its_in</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">symmetry</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Γ_eq_Δ</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rewrite_satif</span> <span class="id" title="var">Γ_eq_Δ</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">realizers_Equal'</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">i</span> <span class="id" title="var">Γ</span> <span class="id" title="var">α</span> <span class="id" title="var">a</span> <span class="id" title="var">d</span> <span class="id" title="var">d'</span>, <span class="id" title="var">d</span> =-= <span class="id" title="var">d'</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">SetIn</span> (<span class="id" title="var">Realizers</span> <span class="id" title="var">a</span> <span class="id" title="var">i</span> <span class="id" title="var">d</span>) (<span class="id" title="var">Γ</span>, <span class="id" title="var">α</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">SetIn</span> (<span class="id" title="var">Realizers</span> <span class="id" title="var">a</span> <span class="id" title="var">i</span> <span class="id" title="var">d'</span>) (<span class="id" title="var">Γ</span>, <span class="id" title="var">α</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">i</span> <span class="id" title="var">Γ</span> (<span class="id" title="var">c</span>, <span class="id" title="var">η</span>) <span class="id" title="var">a</span> <span class="id" title="var">d</span> <span class="id" title="var">d'</span> <span class="id" title="var">d_eq_d'</span> <span class="id" title="var">H</span> (<span class="id" title="var">j</span>, (<span class="id" title="var">Δ</span>, <span class="id" title="var">s</span>)) <span class="id" title="var">its_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">Tests_Equal'</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">d'</span>:=<span class="id" title="var">d'</span>). <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Add</span> <span class="id" title="var">Parametric</span> <span class="id" title="var">Morphism</span> <span class="id" title="var">n</span> <span class="id" title="var">a</span> (<span class="id" title="var">d</span> : <span class="id" title="var">ty_denot</span> <span class="id" title="var">a</span>) <span class="id" title="var">α</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <span class="id" title="var">Γ</span> =&gt; <span class="id" title="var">SetIn</span> (<span class="id" title="var">Realizers</span> <span class="id" title="var">a</span> <span class="id" title="var">n</span> <span class="id" title="var">d</span>) (<span class="id" title="var">Γ</span>, <span class="id" title="var">α</span>)) <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">signature</span> <span class="id" title="var">Equal</span> ==&gt; <span class="id" title="var">iff</span> <span class="id" title="keyword">as</span> <span class="id" title="var">realizer_heap_mor</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">Γ</span> <span class="id" title="var">Δ</span> <span class="id" title="var">EQ</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">split</span> ;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">realizers_Equal</span> ;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">symmetry</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">env_realizers_Equal</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">c</span> <span class="id" title="var">n</span> <span class="id" title="var">η</span> ρ <span class="id" title="var">Γ</span> <span class="id" title="var">Δ</span> , <span class="id" title="var">Γ</span> ≃ <span class="id" title="var">Δ</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">SetIn</span> (<span class="id" title="var">EnvRealizers</span> <span class="id" title="var">n</span> <span class="id" title="var">c</span> ρ) (<span class="id" title="var">Γ</span>, <span class="id" title="var">η</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">SetIn</span> (<span class="id" title="var">EnvRealizers</span> <span class="id" title="var">n</span> <span class="id" title="var">c</span> ρ) (<span class="id" title="var">Δ</span>, <span class="id" title="var">η</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">c</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">n</span> <span class="id" title="var">η</span> ρ <span class="id" title="var">Γ</span> <span class="id" title="var">Δ</span> <span class="id" title="var">EQ</span> <span class="id" title="var">Her0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> ρ.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">η</span> ; <span class="id" title="tactic">try</span> <span class="id" title="var">contradiction</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">n</span> <span class="id" title="var">η</span> ρ <span class="id" title="var">Γ</span> <span class="id" title="var">Δ</span> <span class="id" title="var">EQ</span> <span class="id" title="var">Her1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> ρ <span class="id" title="keyword">as</span> [<span class="id" title="var">d</span> ρ'].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">η</span> <span class="id" title="keyword">as</span> [ | <span class="id" title="var">q</span> <span class="id" title="var">η'</span>] ; <span class="id" title="tactic">try</span> <span class="id" title="var">contradiction</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">Her1</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">H0</span> [<span class="id" title="var">α</span> [<span class="id" title="var">β</span> [<span class="id" title="var">F</span> [<span class="id" title="var">β_to_α</span> <span class="id" title="var">G</span>]]]]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">IHc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exists</span> <span class="id" title="var">α</span>, <span class="id" title="var">β</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">find_Equal</span> ; <span class="id" title="tactic">eauto</span>. <span class="id" title="tactic">split</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">pattern</span> <span class="id" title="var">Δ</span>. <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">EQ</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Add</span> <span class="id" title="var">Parametric</span> <span class="id" title="var">Morphism</span> <span class="id" title="var">n</span> <span class="id" title="var">c</span> (ρ : <span class="id" title="var">ctx_denot</span> <span class="id" title="var">c</span>) <span class="id" title="var">η</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <span class="id" title="var">Γ</span> =&gt; <span class="id" title="var">SetIn</span> (<span class="id" title="var">EnvRealizers</span> <span class="id" title="var">n</span> <span class="id" title="var">c</span> ρ) (<span class="id" title="var">Γ</span>, <span class="id" title="var">η</span>)) <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">signature</span> <span class="id" title="var">Equal</span> ==&gt; <span class="id" title="var">iff</span> <span class="id" title="keyword">as</span> <span class="id" title="var">env_realizer_heap_mor</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">Γ</span> <span class="id" title="var">Γ'</span> <span class="id" title="var">EQ</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">split</span> ;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">env_realizers_Equal</span> ;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">symmetry</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">realizer_extend_heap</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">n</span> <span class="id" title="var">Γ</span> <span class="id" title="var">Δ</span> <span class="id" title="var">α</span> <span class="id" title="var">a</span> (<span class="id" title="var">d</span> : <span class="id" title="var">ty_denot</span> <span class="id" title="var">a</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">r_wf</span> (<span class="id" title="var">Γ</span>, <span class="id" title="var">α</span>) -&gt; <span class="id" title="var">Γ</span> ⋈ <span class="id" title="var">Δ</span> -&gt; (<span class="id" title="var">Γ</span>, <span class="id" title="var">α</span>) ∈ <span class="id" title="var">R</span>(<span class="id" title="var">a</span>, <span class="id" title="var">n</span>, <span class="id" title="var">d</span>) -&gt; (<span class="id" title="var">Γ</span> ∪ <span class="id" title="var">Δ</span>, <span class="id" title="var">α</span>) ∈ <span class="id" title="var">R</span>(<span class="id" title="var">a</span>, <span class="id" title="var">n</span>, <span class="id" title="var">d</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">n</span> <span class="id" title="var">Γ</span> <span class="id" title="var">Δ</span> <span class="id" title="var">α</span> <span class="id" title="var">a</span> <span class="id" title="var">d</span> <span class="id" title="var">Hwf</span> <span class="id" title="var">Hjble</span> <span class="id" title="var">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">btop_weakened</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">Case</span> "Down Closed".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">fs</span> <span class="id" title="var">m</span> <span class="id" title="var">m'</span> <span class="id" title="var">H</span> <span class="id" title="var">m_le_m'</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">bbot_down_closed</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">m_le_m'</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">Case</span> "Proof".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> (<span class="id" title="var">m</span>, (<span class="id" title="var">Δ'</span>, <span class="id" title="var">s</span>)) <span class="id" title="var">ts_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">m_le_n</span> <span class="id" title="var">Hwf1</span> <span class="id" title="var">Hwf2</span> <span class="id" title="var">Hjble2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">Γ</span> ∪ <span class="id" title="var">Δ</span> ∪ <span class="id" title="var">Δ'</span> ≃ <span class="id" title="var">Γ</span> ∪ <span class="id" title="var">Δ'</span> ∪ <span class="id" title="var">Δ</span>) <span class="id" title="keyword">as</span> <span class="id" title="var">Eq1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">destruct_join_joinable</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Join_assoc_1</span> ; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">Equal_join_mor</span> ; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">heap_rewrite_conf</span> <span class="id" title="var">Eq1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">destruct_join_joinable</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">extend_heap</span> ; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">conf_wf</span> (<span class="id" title="var">Γ</span> ∪ <span class="id" title="var">Δ'</span>, <span class="id" title="var">α</span>, <span class="id" title="var">s</span>)) <span class="id" title="keyword">as</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">α</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">i</span> <span class="id" title="var">η</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">wf_union</span> ; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">Join_key_set</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">transitivity</span> (<span class="id" title="var">key_set</span> <span class="id" title="var">Γ</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">Hwf</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">auto</span> <span class="id" title="keyword">with</span> <span class="id" title="var">sets</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">Join_key_set</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">transitivity</span> (<span class="id" title="var">key_set</span> <span class="id" title="var">Δ'</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">Hwf2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">auto</span> <span class="id" title="keyword">with</span> <span class="id" title="var">sets</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">realizer_in_Ω</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">d</span>:=<span class="id" title="var">d</span>) ; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">realizer_gen_StepI</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">i</span>:=<span class="id" title="var">n</span>). <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">env_realizer_nil</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">n</span> <span class="id" title="var">Γ</span> <span class="id" title="var">η</span> (ρ : <span class="id" title="var">ctx_denot</span> <span class="id" title="var">nil</span>), (<span class="id" title="var">Γ</span>, <span class="id" title="var">η</span>) ⊴<span class="id" title="var">n</span>| ρ -&gt; <span class="id" title="var">η</span> = <span class="id" title="var">nil</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">n</span> <span class="id" title="var">Γ</span> <span class="id" title="var">η</span> ρ <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">η</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">contradict</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">env_realizer_def</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> (<span class="id" title="var">n</span> : <span class="id" title="var">nat</span>) (<span class="id" title="var">c</span> : <span class="id" title="var">ctx</span>) <span class="id" title="var">Γ</span> <span class="id" title="var">η</span> (ρ : <span class="id" title="var">ctx_denot</span> <span class="id" title="var">c</span>) <span class="id" title="var">α</span> <span class="id" title="var">β</span> <span class="id" title="var">a</span> (<span class="id" title="var">d</span> : <span class="id" title="var">ty_denot</span> <span class="id" title="var">a</span>) <span class="id" title="var">q</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">find</span> <span class="id" title="var">q</span> <span class="id" title="var">Γ</span> = <span class="id" title="var">Some</span> <span class="id" title="var">β</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">HClos_to_MClos</span> <span class="id" title="var">β</span> = <span class="id" title="var">Some</span> <span class="id" title="var">α</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">Γ</span>, <span class="id" title="var">α</span>) ∈ <span class="id" title="var">R</span>(<span class="id" title="var">a</span> , <span class="id" title="var">n</span> , <span class="id" title="var">d</span>) -&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">Γ</span>, <span class="id" title="var">η</span>) ⊴<span class="id" title="var">n</span>| ρ  -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">Γ</span>, <span class="id" title="var">q</span> :: <span class="id" title="var">η</span>) ⊴<span class="id" title="var">n</span>| ((<span class="id" title="var">d</span>, ρ) : <span class="id" title="var">ctx_denot</span> (<span class="id" title="var">a</span> :: <span class="id" title="var">c</span>)).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">n</span> <span class="id" title="var">c</span> <span class="id" title="var">Γ</span> <span class="id" title="var">η</span> ρ <span class="id" title="var">α</span> <span class="id" title="var">β</span> <span class="id" title="var">a</span> <span class="id" title="var">d</span> <span class="id" title="var">q</span> <span class="id" title="var">F</span> <span class="id" title="var">H</span> <span class="id" title="var">Hr</span> <span class="id" title="var">Henv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">split</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exists</span> <span class="id" title="var">α</span>, <span class="id" title="var">β</span>. <span class="id" title="tactic">split</span> ; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">env_realizer_StepI</span> :  <span class="id" title="keyword">forall</span> (<span class="id" title="var">c</span> : <span class="id" title="var">ctx</span>) (<span class="id" title="var">Γ</span> : <span class="id" title="var">Heap</span>) (<span class="id" title="var">η</span> : <span class="id" title="var">MEnv</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(ρ : <span class="id" title="var">ctx_denot</span> <span class="id" title="var">c</span>) (<span class="id" title="var">i</span> : <span class="id" title="var">nat</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">Γ</span>, <span class="id" title="var">η</span>) ⊴ <span class="id" title="var">i</span>.+1 | ρ -&gt; (<span class="id" title="var">Γ</span>, <span class="id" title="var">η</span>) ⊴ <span class="id" title="var">i</span> | ρ.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">dependent</span> <span class="id" title="tactic">induction</span> <span class="id" title="var">c</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">Γ</span> <span class="id" title="var">η</span> ρ <span class="id" title="var">i</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">destruct</span> ρ; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> ρ; <span class="id" title="tactic">destruct</span> <span class="id" title="var">η</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H</span> <span class="id" title="keyword">as</span> [? [<span class="id" title="var">α</span> [<span class="id" title="var">β</span> [? [? ?]]]]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">env_realizer_def</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">α</span>:=<span class="id" title="var">α</span>) (<span class="id" title="var">β</span>:=<span class="id" title="var">β</span>). <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">realizer_StepI</span>. <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">IHc</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">env_realizer_gen_StepI</span> :  <span class="id" title="keyword">forall</span> (<span class="id" title="var">c</span> : <span class="id" title="var">ctx</span>) (<span class="id" title="var">Γ</span> : <span class="id" title="var">Heap</span>) (<span class="id" title="var">η</span> : <span class="id" title="var">MEnv</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(ρ : <span class="id" title="var">ctx_denot</span> <span class="id" title="var">c</span>) (<span class="id" title="var">i</span> <span class="id" title="var">j</span> : <span class="id" title="var">nat</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">j</span> &lt;= <span class="id" title="var">i</span>)%<span class="id" title="var">coq_nat</span> -&gt; (<span class="id" title="var">Γ</span>, <span class="id" title="var">η</span>) ⊴ <span class="id" title="var">i</span> | ρ -&gt; (<span class="id" title="var">Γ</span>, <span class="id" title="var">η</span>) ⊴ <span class="id" title="var">j</span> | ρ.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">c</span> <span class="id" title="var">Γ</span> <span class="id" title="var">α</span> ρ <span class="id" title="var">i</span> <span class="id" title="var">j</span> <span class="id" title="var">j_leq_i</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">i</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">Case</span> "i = 0".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">j_leq_i</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">Case</span> "i = i.+1".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">Nat.le_succ_r</span> <span class="id" title="tactic">in</span> <span class="id" title="var">j_leq_i</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">j_leq_i</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">j_leq_i</span> | <span class="id" title="var">j_eq_i</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">IHi</span>. <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">env_realizer_StepI</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">j_eq_i</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">ble</span> : <span class="id" title="keyword">forall</span> (<span class="id" title="var">n</span> : <span class="id" title="var">nat</span>) (<span class="id" title="var">Γ</span> : <span class="id" title="var">Heap</span>) (<span class="id" title="var">η</span> : <span class="id" title="var">MEnv</span>) (<span class="id" title="var">c</span> : <span class="id" title="var">ctx</span>) (<span class="id" title="var">z</span> : <span class="id" title="var">Z</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">Γ</span>,((<span class="id" title="var">ival</span> (<span class="id" title="var">iint</span> <span class="id" title="var">z</span>)), <span class="id" title="var">η</span>)) ∈ <span class="id" title="var">R</span>(<span class="id" title="var">tint</span>,<span class="id" title="var">n</span>,<span class="id" title="var">eta</span> <span class="id" title="var">z</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">n</span> <span class="id" title="var">Γ</span> <span class="id" title="var">η</span> <span class="id" title="var">c</span> <span class="id" title="var">z</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">btop_weakened</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">Case</span> "Down Closed".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">fs</span> <span class="id" title="var">m</span> <span class="id" title="var">m'</span> <span class="id" title="var">H</span> <span class="id" title="var">m_le_m'</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">bbot_down_closed</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">m_le_m'</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">Case</span> "Proof".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> (<span class="id" title="var">m</span>,(<span class="id" title="var">Δ</span>,<span class="id" title="var">s</span>)) <span class="id" title="var">mt_test</span>. <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">H</span> [<span class="id" title="var">H0</span> <span class="id" title="var">H0'</span>] <span class="id" title="var">H1</span> <span class="id" title="var">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">bbot</span>, <span class="id" title="var">LiftRel</span>, "∈" <span class="id" title="tactic">in</span> <span class="id" title="var">mt_test</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">mt_test</span> (<span class="id" title="var">m</span>,(<span class="id" title="var">Γ</span>, (<span class="id" title="var">ival</span> (<span class="id" title="var">iint</span> <span class="id" title="var">z</span>), <span class="id" title="var">η</span>)))). <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">mt_test</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> -&gt; <span class="id" title="var">Nat.min_id</span> <span class="id" title="tactic">in</span> <span class="id" title="var">mt_test</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">mt_test</span>. <span class="id" title="tactic">exists</span> <span class="id" title="var">z</span>; <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">env_realizer_extend_heap</span>: <span class="id" title="keyword">forall</span> (<span class="id" title="var">c</span> : <span class="id" title="var">ctx</span>) (<span class="id" title="var">n</span> : <span class="id" title="var">nat</span>) <span class="id" title="var">Γ</span> <span class="id" title="var">Δ</span> <span class="id" title="var">η</span> (ρ : <span class="id" title="var">ctx_denot</span> <span class="id" title="var">c</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">heap_wf</span> <span class="id" title="var">Γ</span> -&gt; <span class="id" title="var">Γ</span> ⋈ <span class="id" title="var">Δ</span> -&gt; (<span class="id" title="var">Γ</span>, <span class="id" title="var">η</span>) ⊴<span class="id" title="var">n</span>| ρ -&gt; (<span class="id" title="var">Γ</span> ∪ <span class="id" title="var">Δ</span>, <span class="id" title="var">η</span>) ⊴<span class="id" title="var">n</span>| ρ.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">c</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> <span class="id" title="var">n</span> <span class="id" title="var">Γ</span> <span class="id" title="var">Δ</span> <span class="id" title="var">η</span> ρ <span class="id" title="keyword">wf</span> <span class="id" title="var">H1</span> <span class="id" title="var">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> ρ.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">set</span> (<span class="id" title="var">Q</span> := <span class="id" title="var">env_realizer_nil</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">H2</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">clearbody</span> <span class="id" title="var">Q</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">Q</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">Q</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> <span class="id" title="var">n</span> <span class="id" title="var">Γ</span> <span class="id" title="var">Δ</span> <span class="id" title="var">η</span> ρ <span class="id" title="keyword">wf</span> <span class="id" title="var">H1</span> <span class="id" title="var">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> ρ <span class="id" title="keyword">as</span> [<span class="id" title="var">d</span> ρ'].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">η</span> <span class="id" title="keyword">as</span> [ | <span class="id" title="var">q</span> <span class="id" title="var">η'</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">contradict</span> <span class="id" title="var">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H2</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">Q1</span> <span class="id" title="var">Q2</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">Q2</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">α</span> [<span class="id" title="var">β</span> [<span class="id" title="var">Eq</span> [<span class="id" title="var">Q4</span> <span class="id" title="var">Q5</span>]]] <span class="id" title="var">Q6</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">env_realizer_def</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">find</span> <span class="id" title="var">q</span> (<span class="id" title="var">Γ</span> ∪ <span class="id" title="var">Δ</span>) = <span class="id" title="var">Some</span> <span class="id" title="var">β</span>) <span class="id" title="keyword">as</span> <span class="id" title="var">F0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">find_submap</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">join_sub1</span> ; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exact</span> <span class="id" title="var">F0</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">Q4</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">realizer_extend_heap</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">r_wf_find</span> ; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">auto</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">env_realizer_realizer_cons</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> (<span class="id" title="var">n</span> : <span class="id" title="var">nat</span>) (<span class="id" title="var">Γ</span> <span class="id" title="var">Γ'</span> : <span class="id" title="var">Heap</span>) (<span class="id" title="var">α</span> : <span class="id" title="var">MClos</span>) (<span class="id" title="var">β</span> : <span class="id" title="var">HClos</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">a</span> : <span class="id" title="keyword">type</span>) (<span class="id" title="var">d</span> : <span class="id" title="var">ty_denot</span> <span class="id" title="var">a</span>) (<span class="id" title="var">c</span> : <span class="id" title="var">ctx</span>) (ρ : <span class="id" title="var">ctx_denot</span> <span class="id" title="var">c</span>) (<span class="id" title="var">η</span> : <span class="id" title="var">MEnv</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">q</span> : <span class="id" title="var">key</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">heap_wf</span> <span class="id" title="var">Γ</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">HClos_to_MClos</span> <span class="id" title="var">β</span> = <span class="id" title="var">Some</span> <span class="id" title="var">α</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">r_wf</span> (<span class="id" title="var">Γ'</span>, <span class="id" title="var">α</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Γ</span> ⋈ <span class="id" title="var">Γ'</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">Γ</span> ∪ <span class="id" title="var">Γ'</span>) ⋈ ⎨ <span class="id" title="var">q</span> ⤇ <span class="id" title="var">β</span> ⎬ -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">Γ</span>, <span class="id" title="var">η</span>) ⊴<span class="id" title="var">n</span>| ρ -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">Γ'</span>,<span class="id" title="var">α</span>) ∈ <span class="id" title="var">R</span>(<span class="id" title="var">a</span>,<span class="id" title="var">n</span>,<span class="id" title="var">d</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">Γ</span> ∪ <span class="id" title="var">Γ'</span> ∪ ⎨ <span class="id" title="var">q</span> ⤇ <span class="id" title="var">β</span> ⎬, <span class="id" title="var">q</span> :: <span class="id" title="var">η</span>) ⊴ <span class="id" title="var">n</span> | ((<span class="id" title="var">d</span>, ρ) : <span class="id" title="var">ctx_denot</span> (<span class="id" title="var">a</span> :: <span class="id" title="var">c</span>)).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">n</span> <span class="id" title="var">Γ</span> <span class="id" title="var">Γ'</span> <span class="id" title="var">α</span> <span class="id" title="var">β</span> <span class="id" title="var">a</span> <span class="id" title="var">d</span> <span class="id" title="var">c</span> ρ <span class="id" title="var">η</span> <span class="id" title="var">q</span> <span class="id" title="var">Hwf0</span> <span class="id" title="var">β_to_α</span> <span class="id" title="var">Hwf1</span> <span class="id" title="var">Hjble0</span> <span class="id" title="var">Hjble1</span> <span class="id" title="var">Her0</span> <span class="id" title="var">Hr0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">heap_rewrite_realizer</span> (<span class="id" title="var">Join_assoc_1</span>) ;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">destruct_join_joinable</span> ;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">env_realizer_extend_heap</span> ; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">exists</span> <span class="id" title="var">α</span>, <span class="id" title="var">β</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id" title="tactic">eapply</span> <span class="id" title="var">find_Joinable_singleton_1</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id" title="tactic">assert</span> (<span class="id" title="var">Γ</span> ∪ <span class="id" title="var">Γ'</span> ∪ (⎨ <span class="id" title="var">q</span> ⤇ <span class="id" title="var">β</span> ⎬) ≃ <span class="id" title="var">Γ'</span> ∪ (<span class="id" title="var">Γ</span> ∪ ⎨ <span class="id" title="var">q</span> ⤇ <span class="id" title="var">β</span> ⎬)) <span class="id" title="keyword">as</span> <span class="id" title="var">E</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">destruct_join_joinable</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">Join_assoc_1</span> ; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">Equal_join_mor</span> ; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">split</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">heap_rewrite_realizer</span> <span class="id" title="var">E</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">destruct_join_joinable</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">realizer_extend_heap</span> ;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">compiler_correctness_unit</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> (<span class="id" title="var">c</span> : <span class="id" title="var">ctx</span>) (<span class="id" title="var">d</span> : <span class="id" title="var">ctx_denot</span> <span class="id" title="var">c</span> =-&gt; <span class="id" title="var">t_ty_denot</span> <span class="id" title="var">tunit</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">c</span> ⊢ (<span class="id" title="var">ival</span> <span class="id" title="var">iunit</span>) ◀| (<span class="id" title="var">eta</span> &lt;&lt; <span class="id" title="var">d</span>)).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">c</span> <span class="id" title="var">d</span> <span class="id" title="var">n</span> <span class="id" title="var">Γ</span> <span class="id" title="var">η</span> ρ <span class="id" title="var">Γwf</span> ρ<span class="id" title="var">_approx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">btop_weakened</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">Case</span> "Down Closed".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">fs</span> <span class="id" title="var">m</span> <span class="id" title="var">m'</span> <span class="id" title="var">H</span> <span class="id" title="var">m_le_m'</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">bbot_down_closed</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">m_le_m'</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">Case</span> "Proof".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> (<span class="id" title="var">m</span>,(<span class="id" title="var">Δ</span>,<span class="id" title="var">s</span>)) <span class="id" title="var">mt_test</span>. <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">H</span> [<span class="id" title="var">H0</span> <span class="id" title="var">H0'</span>] <span class="id" title="var">H1</span> <span class="id" title="var">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">mt_test</span> (<span class="id" title="var">m</span>,(<span class="id" title="var">Γ</span>,(<span class="id" title="var">ival</span> <span class="id" title="var">iunit</span>,<span class="id" title="var">η</span>)))). <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">mt_test</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> -&gt; <span class="id" title="var">Nat.min_id</span> <span class="id" title="tactic">in</span> <span class="id" title="var">mt_test</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">mt_test</span>. <span class="id" title="tactic">exists</span> (<span class="id" title="var">d</span> ρ). <span class="id" title="tactic">split</span>; <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">compiler_correctness_int</span> : <span class="id" title="keyword">forall</span> (<span class="id" title="var">c</span> : <span class="id" title="var">ctx</span>) (<span class="id" title="var">z</span> : <span class="id" title="var">Z</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@<span class="id" title="var">GRealizers</span> <span class="id" title="var">c</span> <span class="id" title="var">tint</span> (<span class="id" title="var">eta</span> &lt;&lt; <span class="id" title="var">const</span> <span class="id" title="var">_</span> <span class="id" title="var">z</span>) (<span class="id" title="var">ival</span> (<span class="id" title="var">iint</span> <span class="id" title="var">z</span>)).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">c</span> <span class="id" title="var">z</span> <span class="id" title="var">n</span> <span class="id" title="var">Γ</span> <span class="id" title="var">η</span> ρ <span class="id" title="var">Γwf</span> ρ<span class="id" title="var">_approx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">btop_weakened</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">Case</span> "Down Closed".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">fs</span> <span class="id" title="var">m</span> <span class="id" title="var">m'</span> <span class="id" title="var">H</span> <span class="id" title="var">m_le_m'</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">bbot_down_closed</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">m_le_m'</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">Case</span> "Proof".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> (<span class="id" title="var">m</span>,(<span class="id" title="var">Δ</span>,<span class="id" title="var">s</span>)) <span class="id" title="var">mt_test</span>. <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">H</span> [<span class="id" title="var">H0</span> <span class="id" title="var">H0'</span>] <span class="id" title="var">H1</span> <span class="id" title="var">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">mt_test</span> (<span class="id" title="var">m</span>,(<span class="id" title="var">Γ</span>,(<span class="id" title="var">ival</span> (<span class="id" title="var">iint</span> <span class="id" title="var">z</span>),<span class="id" title="var">η</span>)))). <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">mt_test</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> -&gt; <span class="id" title="var">Nat.min_id</span> <span class="id" title="tactic">in</span> <span class="id" title="var">mt_test</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">mt_test</span>. <span class="id" title="tactic">exists</span> <span class="id" title="var">z</span>. <span class="id" title="tactic">split</span>. <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">realizer_access</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">Γ</span> <span class="id" title="var">η</span> <span class="id" title="var">ctx</span> <span class="id" title="var">a</span> (ρ : <span class="id" title="var">ctx_denot</span> <span class="id" title="var">ctx</span>) <span class="id" title="var">n</span> (<span class="id" title="var">i</span> : <span class="id" title="var">nat</span>) (<span class="id" title="var">Q</span> : <span class="id" title="var">nth_error</span> <span class="id" title="var">ctx</span> <span class="id" title="var">n</span> = <span class="id" title="var">Some</span> <span class="id" title="var">a</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">heap_wf</span> <span class="id" title="var">Γ</span> -&gt; (<span class="id" title="var">Γ</span>, <span class="id" title="var">η</span>) ⊴ <span class="id" title="var">i</span> | ρ -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">Γ</span>, (<span class="id" title="var">iaccess</span> <span class="id" title="var">n</span>, <span class="id" title="var">η</span>)) ∈ <span class="id" title="var">R</span>(<span class="id" title="var">a</span>,<span class="id" title="var">i</span>, <span class="id" title="var">lookup_nat</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">Q</span> ρ).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">Γ</span> <span class="id" title="var">η</span> <span class="id" title="var">ctx</span> <span class="id" title="var">a</span> ρ <span class="id" title="var">n</span> <span class="id" title="var">i</span> <span class="id" title="var">Q</span> <span class="id" title="var">Γwf</span> ρ<span class="id" title="var">_approx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">set</span> (<span class="id" title="var">d</span> := <span class="id" title="var">lookup_nat</span> <span class="id" title="var">n</span> <span class="id" title="var">ctx</span> <span class="id" title="var">Q</span> ρ).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">btop_weakened</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">Case</span> "Down Closed".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">fs</span> <span class="id" title="var">m</span> <span class="id" title="var">m'</span> <span class="id" title="var">H</span> <span class="id" title="var">m_le_m'</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">bbot_down_closed</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">m_le_m'</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">Case</span> "Proof".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> (<span class="id" title="var">j</span>, (<span class="id" title="var">Δ</span>, <span class="id" title="var">s</span>)) <span class="id" title="var">t_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">j_leq_i</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">j</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">isatif_eq_Fullset</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">Hwf1</span> <span class="id" title="var">Hwf2</span> <span class="id" title="var">Γ_Δ</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">set</span> (<span class="id" title="var">H</span> := <span class="id" title="var">env_realizer_lookup</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">i</span> <span class="id" title="var">Q</span> ρ<span class="id" title="var">_approx</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">clearbody</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H</span>  <span class="id" title="keyword">as</span> [<span class="id" title="var">p</span> [<span class="id" title="var">EQ</span> <span class="id" title="var">EX</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">EX</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">α</span> [<span class="id" title="var">β</span> [<span class="id" title="var">F1</span> [? <span class="id" title="var">Hr2</span>]]]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">antiex</span>. <span class="id" title="tactic">econstructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exact</span> <span class="id" title="var">EQ</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">find</span> <span class="id" title="var">p</span> (<span class="id" title="var">Γ</span> ∪ <span class="id" title="var">Δ</span>) = <span class="id" title="var">Some</span> <span class="id" title="var">β</span>) <span class="id" title="keyword">as</span> <span class="id" title="var">E</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">find_submap</span> ; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">join_sub1</span> ; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">E</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">add_marker</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">find</span> <span class="id" title="var">p</span> (<span class="id" title="var">Γ</span> ∪ <span class="id" title="var">Δ</span>) = <span class="id" title="var">Some</span> <span class="id" title="var">β</span>) <span class="id" title="keyword">as</span> <span class="id" title="var">E</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">find_submap</span> ; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">join_sub1</span> ; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">E</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">realizer_in_Ω</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">r_wf_find</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">auto</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">realizer_gen_StepI</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">i</span>:=<span class="id" title="var">i</span>). <span class="id" title="tactic">apply</span> <span class="id" title="var">le_Sn_le</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">Hr2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">test_StepI</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">compiler_correctness_var</span> :<span class="id" title="keyword">forall</span> (<span class="id" title="var">θ</span> : <span class="id" title="keyword">type</span>) (<span class="id" title="var">c</span> : <span class="id" title="var">ctx</span>) (<span class="id" title="var">v</span> : <span class="id" title="var">var</span> <span class="id" title="var">c</span> <span class="id" title="var">θ</span>), <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@<span class="id" title="var">GRealizers</span> <span class="id" title="var">c</span> <span class="id" title="var">θ</span> (<span class="id" title="var">lookup</span> <span class="id" title="var">v</span>) (<span class="id" title="var">iaccess</span> (<span class="id" title="var">var_to_nat</span> <span class="id" title="var">v</span>)).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">θ</span> <span class="id" title="var">c</span> <span class="id" title="var">v</span> <span class="id" title="var">n</span> <span class="id" title="var">Γ</span> <span class="id" title="var">η</span> ρ <span class="id" title="var">Γwf</span> ρ<span class="id" title="var">_approx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">set</span> (<span class="id" title="var">Q</span> := <span class="id" title="var">nth_var_to_nat</span> <span class="id" title="var">v</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">clearbody</span> <span class="id" title="var">Q</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> (<span class="id" title="var">var_to_nat_lookup</span> <span class="id" title="var">v</span> ρ <span class="id" title="var">Q</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">realizer_access</span> ; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">env_realizer_ptr</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">n</span> <span class="id" title="var">ctx</span> (ρ : <span class="id" title="var">ctx_denot</span> <span class="id" title="var">ctx</span>) <span class="id" title="var">η</span> <span class="id" title="var">Γ</span>, <span class="id" title="var">heap_wf</span> <span class="id" title="var">Γ</span> -&gt; (<span class="id" title="var">Γ</span>, <span class="id" title="var">η</span>) ⊴ <span class="id" title="var">n</span> | ρ -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Included</span> <span class="id" title="var">_</span> (<span class="id" title="var">env_ptr</span> <span class="id" title="var">η</span>) (<span class="id" title="var">key_set</span> <span class="id" title="var">Γ</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">ctx</span> ;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> ρ <span class="id" title="var">η</span> <span class="id" title="var">Γ</span> <span class="id" title="var">Hwf0</span> <span class="id" title="var">Her0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> ρ.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">η</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">firstorder</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">contradiction</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> ρ <span class="id" title="keyword">as</span> [<span class="id" title="var">d</span> ρ'].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">η</span> ; <span class="id" title="tactic">try</span> <span class="id" title="var">contradiction</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">env_ptr_cons_included</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">IHctx</span> ; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">Her0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">Her0</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">Her1</span> [<span class="id" title="var">α</span> [<span class="id" title="var">β</span> [<span class="id" title="var">F0</span> [<span class="id" title="var">β_to_α</span> <span class="id" title="var">Hr1</span>]]]]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">key_set_find_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">F0</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">compiler_correctness_abs</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;∀ (<span class="id" title="var">θ1</span> <span class="id" title="var">θ2</span> : <span class="id" title="keyword">type</span>) (<span class="id" title="var">c</span> : <span class="id" title="var">ctx</span>) (<span class="id" title="var">d</span> : <span class="id" title="var">ctx_denot</span> (<span class="id" title="var">θ1</span> :: <span class="id" title="var">c</span>) =-&gt; <span class="id" title="var">ty_denot</span> <span class="id" title="var">θ2</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">i</span> : <span class="id" title="var">Code</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@<span class="id" title="var">GRealizers</span> (<span class="id" title="var">θ1</span> :: <span class="id" title="var">c</span>) <span class="id" title="var">θ2</span> <span class="id" title="var">d</span> <span class="id" title="var">i</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@<span class="id" title="var">GRealizers</span> <span class="id" title="var">c</span> (<span class="id" title="var">θ1</span> ⇾ <span class="id" title="var">θ2</span>) (<span class="id" title="var">AbsTy</span> <span class="id" title="var">d</span>) (<span class="id" title="var">ival</span> (<span class="id" title="var">igrab</span> <span class="id" title="var">i</span>)).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">θ1</span> <span class="id" title="var">θ2</span> <span class="id" title="var">c</span> <span class="id" title="var">d</span> <span class="id" title="var">i</span> <span class="id" title="var">IH</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">n</span> <span class="id" title="var">Γ</span> <span class="id" title="var">η</span> ρ <span class="id" title="var">Γwf</span> ρ<span class="id" title="var">_approx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">primitive_realizer</span>. <span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">env_realizer_ptr</span> ; <span class="id" title="tactic">eauto</span>. <span class="id" title="tactic">fold</span> <span class="id" title="var">ctx_denot</span>; <span class="id" title="tactic">simpl</span>; <span class="id" title="tactic">unfold</span> <span class="id" title="var">id</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">m</span> <span class="id" title="var">d'</span> <span class="id" title="var">Γ'</span> <span class="id" title="var">α</span> <span class="id" title="var">β</span> <span class="id" title="var">m_le_n</span> <span class="id" title="var">Hp0</span> <span class="id" title="var">Hwf1</span> <span class="id" title="var">Hjble</span> <span class="id" title="var">β_to_α</span> <span class="id" title="var">p</span> <span class="id" title="var">Hjble1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">set</span> (<span class="id" title="var">Γ''</span> := <span class="id" title="var">Γ</span> ∪ <span class="id" title="var">Γ'</span> ∪ ⎨ <span class="id" title="var">p</span> ⤇ <span class="id" title="var">β</span> ⎬).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> ((<span class="id" title="var">Γ''</span>, <span class="id" title="var">p</span> :: <span class="id" title="var">η</span>) ⊴ <span class="id" title="var">m</span> | ((<span class="id" title="var">d'</span>, ρ) : <span class="id" title="var">ctx_denot</span> (<span class="id" title="var">θ1</span> :: <span class="id" title="var">c</span>))) <span class="id" title="keyword">as</span> <span class="id" title="var">He1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">Case</span> "Assert".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">env_realizer_realizer_cons</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">HClos_prop'</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">β_to_α</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">auto</span>. <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">env_realizer_gen_StepI</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">i</span>:=<span class="id" title="var">n</span>). <span class="id" title="tactic">apply</span> <span class="id" title="var">Nat.lt_le_incl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">auto</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">Hp0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">IH</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">Γ</span> ⋈ ⎨ <span class="id" title="var">p</span> ⤇ <span class="id" title="var">β</span> ⎬) <span class="id" title="keyword">as</span> <span class="id" title="var">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">destruct_join_joinable</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">Γ'</span> ⋈ ⎨ <span class="id" title="var">p</span> ⤇ <span class="id" title="var">β</span> ⎬) <span class="id" title="keyword">as</span> <span class="id" title="var">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">destruct_join_joinable</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">Join_add</span> ; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">Join_assoc_1</span> ; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">wf_union</span> ; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">r_wf_joinable</span> ; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">add</span> <span class="id" title="var">p</span> <span class="id" title="var">β</span> (<span class="id" title="var">Γ</span> ∪ <span class="id" title="var">Γ'</span>) ≃ <span class="id" title="var">Γ''</span>) <span class="id" title="keyword">as</span> <span class="id" title="var">E</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">Γ''</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">symmetry</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">Join_add</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">heap_rewrite_realizer</span> <span class="id" title="var">E</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">realizer_rec</span> : <span class="id" title="keyword">forall</span> (<span class="id" title="var">θ</span> : <span class="id" title="keyword">type</span>) (π : <span class="id" title="var">ctx</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">d</span> : <span class="id" title="var">ctx_denot</span> (<span class="id" title="var">θ</span> :: π) =-&gt; <span class="id" title="var">ty_denot</span> <span class="id" title="var">θ</span>) (<span class="id" title="var">i</span> : <span class="id" title="var">Code</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">exists_fresh_pointer</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">θ</span> :: π ⊢ <span class="id" title="var">i</span> ◀| <span class="id" title="var">d</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(π ⊢ (<span class="id" title="var">irec</span> <span class="id" title="var">i</span>) ◀| (<span class="id" title="var">FixF</span> <span class="id" title="var">d</span>)).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">θ</span> π <span class="id" title="var">d</span> <span class="id" title="var">i</span> <span class="id" title="var">EFP</span> <span class="id" title="var">IH</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intro</span> <span class="id" title="var">n</span>. <span class="id" title="tactic">induction</span> <span class="id" title="var">n</span>; <span class="id" title="tactic">intros</span> <span class="id" title="var">Γ</span> <span class="id" title="var">η</span> ρ <span class="id" title="var">Γwf</span> ρ<span class="id" title="var">_approx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">Case</span> "i = 0".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> (<span class="id" title="var">m</span>,<span class="id" title="var">ts</span>) <span class="id" title="var">ts_in</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">isatif_eq_Fullset</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">Case</span> "i =&gt; i+1".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">btop_weakened</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id" title="var">SCase</span> "Down Closed".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">fs</span> <span class="id" title="var">m</span> <span class="id" title="var">m'</span> <span class="id" title="var">H</span> <span class="id" title="var">m_le_m'</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">bbot_down_closed</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">m_le_m'</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id" title="var">SCase</span> "Proof".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> (<span class="id" title="var">m</span>,(<span class="id" title="var">Δ</span>,<span class="id" title="var">s</span>)) <span class="id" title="var">ts_in</span> <span class="id" title="var">m_leq_Sn</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">m</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">isatif_eq_Fullset</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">Γαwf</span> <span class="id" title="var">Δwf</span> <span class="id" title="var">Γ_Δ</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">EFP</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">Γ</span>:=<span class="id" title="var">Γ</span> ∪ <span class="id" title="var">Δ</span>) (<span class="id" title="var">η</span>:=<span class="id" title="var">η</span>) (<span class="id" title="var">s</span>:=<span class="id" title="var">s</span>) <span class="id" title="keyword">as</span> [<span class="id" title="var">p</span> <span class="id" title="var">p_fresh</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">antiex</span>. <span class="id" title="tactic">constructor</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">p_fresh</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">Map.add</span> <span class="id" title="var">p</span> (<span class="id" title="var">C</span> (<span class="id" title="var">irec</span> <span class="id" title="var">i</span>), <span class="id" title="var">η</span>) (<span class="id" title="var">Γ</span> ∪ <span class="id" title="var">Δ</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;≃<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Map.add</span> <span class="id" title="var">p</span> (<span class="id" title="var">C</span> (<span class="id" title="var">irec</span> <span class="id" title="var">i</span>), <span class="id" title="var">η</span>) <span class="id" title="var">Γ</span> ∪ <span class="id" title="var">Δ</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">symmetry</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">heap_add_prop''</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">p_fresh</span>. <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">heap_rewrite_conf</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">clear</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">p_fresh</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">fresh_for_heap_join</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">extended_</span>ρ : <span class="id" title="var">SetIn</span> (<span class="id" title="var">EnvRealizers</span> <span class="id" title="var">m</span> (<span class="id" title="var">θ</span> :: π) ((<span class="id" title="var">FixF</span> <span class="id" title="var">d</span>) ρ, ρ))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">Map.add</span> <span class="id" title="var">p</span> (<span class="id" title="var">C</span> (<span class="id" title="var">irec</span> <span class="id" title="var">i</span>), <span class="id" title="var">η</span>) <span class="id" title="var">Γ</span>, <span class="id" title="var">p</span> :: <span class="id" title="var">η</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--- <span class="id" title="var">SSCase</span> "Assert extended env realizer".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">Γ</span> ∪ (⎨ <span class="id" title="var">p</span> ⤇ (<span class="id" title="var">C</span> (<span class="id" title="var">irec</span> <span class="id" title="var">i</span>), <span class="id" title="var">η</span>) ⎬) ≃<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Map.add</span> <span class="id" title="var">p</span> (<span class="id" title="var">C</span> (<span class="id" title="var">irec</span> <span class="id" title="var">i</span>), <span class="id" title="var">η</span>) <span class="id" title="var">Γ</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;---- <span class="id" title="var">SSSCase</span> "assert".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- (<span class="id" title="var">Join_add</span> (<span class="id" title="var">Joinable_fresh</span> (<span class="id" title="var">fst</span> <span class="id" title="var">H</span>))). <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">env_realizer_def</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">F.add_eq_o</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">HClos_to_MClos</span>. <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">realizers_Equal</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">realizer_extend_heap</span>. <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">Joinable_fresh</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> (<span class="id" title="var">fst</span> <span class="id" title="var">H</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">realizer_gen_StepI</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">i</span>:=<span class="id" title="var">n</span>). <span class="id" title="tactic">apply</span> <span class="id" title="var">le_S_n</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">IHn</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">env_realizer_StepI</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">env_realizers_Equal</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">env_realizer_extend_heap</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">Joinable_fresh</span>. <span class="id" title="tactic">apply</span> (<span class="id" title="var">fst</span> <span class="id" title="var">H</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">env_realizer_gen_StepI</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">i</span>:=<span class="id" title="var">n</span>.+1).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">le_Sn_le</span>. <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">extended_Γwf</span> : <span class="id" title="var">heap_wf</span> (<span class="id" title="var">Map.add</span> <span class="id" title="var">p</span> (<span class="id" title="var">C</span> (<span class="id" title="var">irec</span> <span class="id" title="var">i</span>), <span class="id" title="var">η</span>) <span class="id" title="var">Γ</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--- <span class="id" title="var">SSCase</span> "Assert extended heap well-formed".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">wf_add</span>. <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">Γαwf</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">IH</span> <span class="id" title="var">m</span> (<span class="id" title="var">Map.add</span> <span class="id" title="var">p</span> (<span class="id" title="var">C</span> (<span class="id" title="var">irec</span> <span class="id" title="var">i</span>), <span class="id" title="var">η</span>) <span class="id" title="var">Γ</span>) (<span class="id" title="var">p</span>::<span class="id" title="var">η</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;((<span class="id" title="var">FixF</span> <span class="id" title="var">d</span>) ρ, ρ) <span class="id" title="var">extended_Γwf</span> <span class="id" title="var">extended_</span>ρ (<span class="id" title="var">m</span>,(<span class="id" title="var">Δ</span>,<span class="id" title="var">s</span>))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> "_ ⊧ _", <span class="id" title="var">satif</span>, <span class="id" title="var">mrel</span>, <span class="id" title="var">isatif</span> <span class="id" title="tactic">in</span> <span class="id" title="var">IH</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> -&gt; <span class="id" title="var">Nat.min_id</span> <span class="id" title="tactic">in</span> <span class="id" title="var">IH</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">IH</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> ((<span class="id" title="var">FixF</span> <span class="id" title="var">d</span>) ρ =-= <span class="id" title="var">d</span> ((<span class="id" title="var">FixF</span> <span class="id" title="var">d</span>) ρ, ρ)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">fold</span> <span class="id" title="var">ctx_denot</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">tset_trans</span>. <span class="id" title="tactic">rewrite</span> -&gt; <span class="id" title="var">fixp_eq</span>. <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">id</span>. <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">Tests_Equal'</span>. <span class="id" title="tactic">symmetry</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">test_StepI</span>. <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">split</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">env_realizer_ptr</span>. <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">extended_</span>ρ. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">Join_add_prop'</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">compiler_correctness_let</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">exists_fresh_pointer</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;∀ (π : <span class="id" title="var">ctx</span>) (<span class="id" title="var">θ1</span> <span class="id" title="var">θ2</span> : <span class="id" title="keyword">type</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">d</span> : <span class="id" title="var">ctx_denot</span> (<span class="id" title="var">θ1</span> :: π) =-&gt; <span class="id" title="var">ty_denot</span> <span class="id" title="var">θ1</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">d'</span> : <span class="id" title="var">ctx_denot</span> (<span class="id" title="var">θ1</span> :: π) =-&gt; <span class="id" title="var">ty_denot</span> <span class="id" title="var">θ2</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">i</span> <span class="id" title="var">i'</span> : <span class="id" title="var">Code</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">θ1</span> :: π ⊢ <span class="id" title="var">i</span> ◀| <span class="id" title="var">d</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">θ1</span> :: π ⊢ <span class="id" title="var">i'</span> ◀| <span class="id" title="var">d'</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(π ⊢ (<span class="id" title="var">ilet</span> (<span class="id" title="var">irec</span> <span class="id" title="var">i</span>) <span class="id" title="var">i'</span>) ◀| <span class="id" title="var">LetTy</span> <span class="id" title="var">d'</span> (<span class="id" title="var">FixF</span> <span class="id" title="var">d</span>)).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">EFP</span> <span class="id" title="var">c</span> <span class="id" title="var">θ1</span> <span class="id" title="var">θ2</span> <span class="id" title="var">d</span> <span class="id" title="var">d'</span> <span class="id" title="var">i</span> <span class="id" title="var">i'</span> <span class="id" title="var">IHt_1</span> <span class="id" title="var">IHt_2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">n</span> <span class="id" title="var">Γ</span> <span class="id" title="var">η</span> ρ <span class="id" title="var">Γwf</span> ρ<span class="id" title="var">_approx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">btop_weakened</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">Case</span> "Down Closed".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">fs</span> <span class="id" title="var">m</span> <span class="id" title="var">m'</span> <span class="id" title="var">H</span> <span class="id" title="var">m_le_m'</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">bbot_down_closed</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">m_le_m'</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">Case</span> "Proof".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> (<span class="id" title="var">m</span>, (<span class="id" title="var">Δ</span>, <span class="id" title="var">s</span>)) <span class="id" title="var">t_in</span> <span class="id" title="var">m_leq_n</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">EFP</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">Γ</span>:=<span class="id" title="var">Γ</span> ∪ <span class="id" title="var">Δ</span>) (<span class="id" title="var">η</span>:=<span class="id" title="var">η</span>) (<span class="id" title="var">s</span>:=<span class="id" title="var">s</span>) <span class="id" title="keyword">as</span> [<span class="id" title="var">p</span> <span class="id" title="var">p_fresh</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">m</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">isatif_eq_Fullset</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">Γwf'</span> <span class="id" title="var">Δwf</span> <span class="id" title="var">Γ_Δ</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">antiex</span>. <span class="id" title="tactic">constructor</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">p_fresh</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">realizer_rec</span> <span class="id" title="tactic">in</span> <span class="id" title="var">IHt_1</span>. 2:{ <span class="id" title="tactic">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">p_fresh</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">fresh_for_heap_join</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id" title="tactic">assert</span> (<span class="id" title="var">Γ</span> ∪ (⎨ <span class="id" title="var">p</span> ⤇ (<span class="id" title="var">C</span> (<span class="id" title="var">irec</span> <span class="id" title="var">i</span>), <span class="id" title="var">η</span>) ⎬)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;≃<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Map.add</span> <span class="id" title="var">p</span> (<span class="id" title="var">C</span> (<span class="id" title="var">irec</span> <span class="id" title="var">i</span>), <span class="id" title="var">η</span>) <span class="id" title="var">Γ</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- (<span class="id" title="var">Join_add</span> (<span class="id" title="var">Joinable_fresh</span> (<span class="id" title="var">fst</span> <span class="id" title="var">H</span>))). <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id" title="tactic">assert</span> (<span class="id" title="var">extended_</span>ρ : <span class="id" title="var">SetIn</span> (<span class="id" title="var">EnvRealizers</span> <span class="id" title="var">m</span> (<span class="id" title="var">θ1</span> :: <span class="id" title="var">c</span>) ((<span class="id" title="var">FixF</span> <span class="id" title="var">d</span>) ρ, ρ))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">add</span> <span class="id" title="var">p</span> (<span class="id" title="var">C</span> (<span class="id" title="var">irec</span> <span class="id" title="var">i</span>), <span class="id" title="var">η</span>) <span class="id" title="var">Γ</span>, <span class="id" title="var">p</span> :: <span class="id" title="var">η</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">env_realizer_def</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">F.add_eq_o</span>. <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">snd</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">realizers_Equal</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">realizer_extend_heap</span>. <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">Joinable_fresh</span>. <span class="id" title="tactic">apply</span> (<span class="id" title="var">fst</span> <span class="id" title="var">H</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">IHt_1</span>. <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">env_realizer_gen_StepI</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">i</span>:=<span class="id" title="var">n</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">le_Sn_le</span>. <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">env_realizers_Equal</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">env_realizer_extend_heap</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">Joinable_fresh</span>. <span class="id" title="tactic">apply</span> (<span class="id" title="var">fst</span> <span class="id" title="var">H</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">env_realizer_gen_StepI</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">i</span>:=<span class="id" title="var">n</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">le_Sn_le</span>. <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id" title="tactic">assert</span> (<span class="id" title="var">Map.add</span> <span class="id" title="var">p</span> (<span class="id" title="var">C</span> (<span class="id" title="var">irec</span> <span class="id" title="var">i</span>), <span class="id" title="var">η</span>) (<span class="id" title="var">Γ</span> ∪ <span class="id" title="var">Δ</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;≃<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Map.add</span> <span class="id" title="var">p</span> (<span class="id" title="var">C</span> (<span class="id" title="var">irec</span> <span class="id" title="var">i</span>), <span class="id" title="var">η</span>) <span class="id" title="var">Γ</span> ∪ <span class="id" title="var">Δ</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">symmetry</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">heap_add_prop''</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">fresh_for_heap_join_1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">auto</span>. <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">heap_rewrite_conf</span> <span class="id" title="var">H2</span>. <span class="id" title="tactic">clear</span> <span class="id" title="var">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id" title="tactic">assert</span> (<span class="id" title="var">extended_Γwf</span> : <span class="id" title="var">heap_wf</span> (<span class="id" title="var">Map.add</span> <span class="id" title="var">p</span> (<span class="id" title="var">C</span> (<span class="id" title="var">irec</span> <span class="id" title="var">i</span>), <span class="id" title="var">η</span>) <span class="id" title="var">Γ</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">wf_add</span>. <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">Γwf'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">IHt_2</span> <span class="id" title="var">m</span> (<span class="id" title="var">Map.add</span> <span class="id" title="var">p</span> (<span class="id" title="var">C</span> (<span class="id" title="var">irec</span> <span class="id" title="var">i</span>), <span class="id" title="var">η</span>) <span class="id" title="var">Γ</span>) (<span class="id" title="var">p</span> :: <span class="id" title="var">η</span>) ((<span class="id" title="var">FixF</span> <span class="id" title="var">d</span>) ρ, ρ)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">extended_Γwf</span> <span class="id" title="var">extended_</span>ρ (<span class="id" title="var">m</span>,(<span class="id" title="var">Δ</span>,<span class="id" title="var">s</span>))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> "_ ⊧ _", <span class="id" title="var">satif</span>, <span class="id" title="var">mrel</span>, <span class="id" title="var">isatif</span> <span class="id" title="tactic">in</span> <span class="id" title="var">IHt_2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> -&gt; <span class="id" title="var">Nat.min_id</span> <span class="id" title="tactic">in</span> <span class="id" title="var">IHt_2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">IHt_2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">test_StepI</span>. <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">split</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">env_realizer_ptr</span>. <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">extended_</span>ρ. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">Join_add_prop'</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">tests_functional</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">n</span> <span class="id" title="var">Γ</span> <span class="id" title="var">Δ</span> <span class="id" title="var">α</span> <span class="id" title="var">β</span> <span class="id" title="var">s</span> <span class="id" title="var">a</span> <span class="id" title="var">b</span> (<span class="id" title="var">d</span> : <span class="id" title="var">ty_denot</span> <span class="id" title="var">a</span>) (<span class="id" title="var">f</span> : <span class="id" title="var">ty_denot</span> (<span class="id" title="var">a</span> ⇾ <span class="id" title="var">b</span>)) <span class="id" title="var">p</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">HClos_to_MClos</span> <span class="id" title="var">β</span> = <span class="id" title="var">Some</span> <span class="id" title="var">α</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">r_wf</span> (<span class="id" title="var">Γ</span>, <span class="id" title="var">α</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">t_wf</span> (<span class="id" title="var">Δ</span>, <span class="id" title="var">s</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Γ</span> ⋈ <span class="id" title="var">Δ</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">Γ</span> ∪ <span class="id" title="var">Δ</span>) ⋈ ⎨ <span class="id" title="var">p</span> ⤇ <span class="id" title="var">β</span> ⎬ -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">Γ</span>, <span class="id" title="var">α</span>) ∈ <span class="id" title="var">R</span>(<span class="id" title="var">a</span>, <span class="id" title="var">n</span>, <span class="id" title="var">d</span>) -&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">SetIn</span> (<span class="id" title="var">Tests</span> <span class="id" title="var">b</span> (<span class="id" title="var">AppTy_</span>ρ <span class="id" title="var">f</span> <span class="id" title="var">d</span>)) (<span class="id" title="var">n</span>, (<span class="id" title="var">Δ</span>, <span class="id" title="var">s</span>)) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">SetIn</span> (<span class="id" title="var">Tests</span> (<span class="id" title="var">a</span> ⇾ <span class="id" title="var">b</span>) <span class="id" title="var">f</span>) (<span class="id" title="var">n</span> ,(<span class="id" title="var">Γ</span> ∪ <span class="id" title="var">Δ</span> ∪ ⎨ <span class="id" title="var">p</span> ⤇ <span class="id" title="var">β</span> ⎬, ⌑ <span class="id" title="var">p</span> :: <span class="id" title="var">s</span>)).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">n</span> <span class="id" title="var">Γ</span> <span class="id" title="var">Δ</span> <span class="id" title="var">α</span> <span class="id" title="var">β</span> <span class="id" title="var">s</span> <span class="id" title="var">a</span> <span class="id" title="var">b</span> <span class="id" title="var">d</span> <span class="id" title="var">f</span> <span class="id" title="var">p</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">β_to_α</span> <span class="id" title="var">Hwf0</span> <span class="id" title="var">Hwf1</span> <span class="id" title="var">Hjble0</span> <span class="id" title="var">Hjble1</span> <span class="id" title="var">Hr0</span> <span class="id" title="var">Ht0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">bbot_weakened</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">Case</span> "Down Closed".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> (<span class="id" title="var">Γ'</span>,<span class="id" title="var">α'</span>) <span class="id" title="var">m'</span> <span class="id" title="var">m''</span> <span class="id" title="var">H</span> <span class="id" title="var">m'_le_m''</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">H</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">f'</span> [? ?]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exists</span> <span class="id" title="var">f'</span>. <span class="id" title="tactic">split</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">change</span> ((<span class="id" title="var">Rp</span>( <span class="id" title="var">a</span> ⇾ <span class="id" title="var">b</span>, <span class="id" title="var">m''</span>, <span class="id" title="var">f'</span>)) (<span class="id" title="var">Γ'</span>, <span class="id" title="var">α'</span>)) <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;((<span class="id" title="var">Γ'</span>, <span class="id" title="var">α'</span>) ∈ (<span class="id" title="var">Rp</span>( <span class="id" title="var">a</span> ⇾ <span class="id" title="var">b</span>, <span class="id" title="var">m''</span>, <span class="id" title="var">f'</span>))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">primitive_gen_StepI</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">i</span>:=<span class="id" title="var">m'</span>). <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">Case</span> "Proof".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> (<span class="id" title="var">m'</span>, (<span class="id" title="var">Γ''</span>, <span class="id" title="var">α'</span>)) <span class="id" title="var">r_in</span> <span class="id" title="var">m'_leq_m</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">set</span> (<span class="id" title="var">Γ'</span> := <span class="id" title="var">Γ</span> ∪ <span class="id" title="var">Δ</span> ∪ (⎨ <span class="id" title="var">p</span> ⤇ <span class="id" title="var">β</span> ⎬)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">m'</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">isatif_eq_Fullset</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">rwf</span> <span class="id" title="var">twf</span> <span class="id" title="var">Γ''compat</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">r_in</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">f'</span> [? ?]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">α'</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">c</span> <span class="id" title="var">η</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">c</span> ; <span class="id" title="tactic">try</span> <span class="id" title="var">contradiction</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">v</span> ; <span class="id" title="tactic">try</span> <span class="id" title="var">contradiction</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">antiex</span>. <span class="id" title="tactic">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H0</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">Hinc0</span> <span class="id" title="var">Hgrab</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">Γ''</span> ⋈ <span class="id" title="var">Γ</span>) <span class="id" title="keyword">as</span> <span class="id" title="var">Hjble3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">destruct_join_joinable</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">joinable_comm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">Joinable_submap</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">joinable_comm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">Γ'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">Join_assoc_1</span> ; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">join_sub1</span> ; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">Γ''</span> ∪ <span class="id" title="var">Γ</span> ⋈ ⎨ <span class="id" title="var">p</span> ⤇ <span class="id" title="var">β</span> ⎬) <span class="id" title="keyword">as</span> <span class="id" title="var">Hjble4</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">destruct_join_joinable</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">joinable_comm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">Joinable_join_intro_r</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">Joinable_submap</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">joinable_comm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">Γ''compat</span> ; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">Γ'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">join_sub2</span> ; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">joinable_comm</span> ; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">HClos_prop</span> <span class="id" title="tactic">in</span> <span class="id" title="var">β_to_α</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">have</span> <span class="id" title="var">m'_leq_n</span> := <span class="id" title="var">Nat.le_trans</span> <span class="id" title="var">m'</span> (<span class="id" title="var">m'</span>.+1) <span class="id" title="var">n</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">Nat.lt_le_incl</span> <span class="id" title="var">m'</span> (<span class="id" title="var">m'</span>.+1)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">Nat.lt_succ_diag_r</span> <span class="id" title="var">m'</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">m'_leq_m</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">have</span> <span class="id" title="var">Hr0m'</span> := <span class="id" title="var">realizer_gen_StepI</span> <span class="id" title="var">m'_leq_n</span> <span class="id" title="var">Hr0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">Hgrab</span> <span class="id" title="var">m'</span> <span class="id" title="var">d</span> <span class="id" title="var">Γ</span> <span class="id" title="var">α</span> <span class="id" title="var">β</span> (<span class="id" title="var">Nat.lt_succ_diag_r</span> <span class="id" title="var">m'</span>) <span class="id" title="var">Hr0m'</span> <span class="id" title="var">Hwf0</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Hjble3</span> <span class="id" title="var">β_to_α</span> <span class="id" title="var">p</span> <span class="id" title="var">Hjble4</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">set</span> (<span class="id" title="var">Δ'</span> := <span class="id" title="var">Γ''</span> ∪ <span class="id" title="var">Γ</span> ∪ (⎨ <span class="id" title="var">p</span> ⤇ <span class="id" title="var">β</span> ⎬)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">Γ''</span> ⋈ <span class="id" title="var">Δ</span>) <span class="id" title="keyword">as</span> <span class="id" title="var">E0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">Γ'</span> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="var">destruct_join_joinable</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> -&gt; <span class="id" title="var">Join_comm_1</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Γ''compat</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">Join_assoc_1</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Γ''compat</span> ; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> -&gt; <span class="id" title="var">joinable_comm</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Γ''compat</span> ; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">joinable_comm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">Joinable_join_elim_2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (⎨ <span class="id" title="var">p</span> ⤇ <span class="id" title="var">β</span> ⎬ ∪ <span class="id" title="var">Γ</span> ⋈ <span class="id" title="var">Δ</span>) <span class="id" title="keyword">as</span> <span class="id" title="var">E'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">joinable_comm</span> ; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exact</span> <span class="id" title="var">E'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">joinable_comm</span> ; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">Γ''</span> ∪ <span class="id" title="var">Γ'</span> ≃  <span class="id" title="var">Δ'</span> ∪ <span class="id" title="var">Δ</span>) <span class="id" title="keyword">as</span> <span class="id" title="var">E</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">Γ'</span> <span class="id" title="tactic">in</span> *. <span class="id" title="tactic">unfold</span> <span class="id" title="var">Δ'</span> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="var">destruct_join_joinable</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">symmetry</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Join_assoc_1</span>  ; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">Equal_join_mor</span> ; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Join_assoc_1</span> ; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">Equal_join_mor</span> ; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">heap_rewrite_conf</span> <span class="id" title="var">E</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">realizer_in_Ω</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">d</span> := ((<span class="id" title="var">AppTy_</span>ρ <span class="id" title="var">f</span>) <span class="id" title="var">d</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">destruct_join_joinable</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">Γ''</span> ⋈ ⎨ <span class="id" title="var">p</span> ⤇ <span class="id" title="var">β</span> ⎬) <span class="id" title="keyword">as</span> <span class="id" title="var">Hjble5</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">Γ</span> ⋈ ⎨ <span class="id" title="var">p</span> ⤇ <span class="id" title="var">β</span> ⎬) <span class="id" title="keyword">as</span> <span class="id" title="var">Hjble6</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">Same_set</span> <span class="id" title="var">_</span> (<span class="id" title="var">key_set</span> (⎨ <span class="id" title="var">p</span> ⤇ <span class="id" title="var">β</span> ⎬)) (<span class="id" title="var">Singleton</span> <span class="id" title="var">_</span> <span class="id" title="var">p</span>)) <span class="id" title="keyword">as</span> <span class="id" title="var">R</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">β</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">key_set_singleton</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">Δ'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">Join_assoc_1</span> ; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">wf_union</span> ; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">r_wf_joinable</span> ; <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">β_to_α</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Join_key_set</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">env_ptr_cons_included</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">Union_assoc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">transitivity</span> (<span class="id" title="var">key_set</span> <span class="id" title="var">Γ''</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">Included_Union_1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">Included_Singleton</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">Union_comm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">transitivity</span> (<span class="id" title="var">key_set</span> (⎨ <span class="id" title="var">p</span> ⤇ <span class="id" title="var">β</span> ⎬)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">R</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">Included_Union_1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">auto</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">Δ'</span> ⋈ <span class="id" title="var">Δ</span>) <span class="id" title="keyword">as</span> <span class="id" title="var">E1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">Δ'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">Joinable_join_intro_l</span> ; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">joinable_comm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">Joinable_join_elim_2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">Hjble0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">Δ'</span> ≃ <span class="id" title="var">add</span> <span class="id" title="var">p</span> <span class="id" title="var">β</span> (<span class="id" title="var">Γ''</span> ∪ <span class="id" title="var">Γ</span>)) <span class="id" title="keyword">as</span> <span class="id" title="var">E'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">Δ'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">Join_add</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">change</span> ((<span class="id" title="var">Δ'</span>, (<span class="id" title="var">c</span>, <span class="id" title="var">p</span> :: <span class="id" title="var">η</span>)) ∈ <span class="id" title="var">R</span>( <span class="id" title="var">b</span>, <span class="id" title="var">m'</span>, (<span class="id" title="var">AppTy_</span>ρ <span class="id" title="var">f</span>) <span class="id" title="var">d</span>)) <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">SetIn</span> (<span class="id" title="var">R</span>( <span class="id" title="var">b</span>, <span class="id" title="var">m'</span>, (<span class="id" title="var">AppTy_</span>ρ <span class="id" title="var">f</span>) <span class="id" title="var">d</span>)) (<span class="id" title="var">Δ'</span>, (<span class="id" title="var">c</span>, <span class="id" title="var">p</span> :: <span class="id" title="var">η</span>))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">heap_rewrite_realizer</span> <span class="id" title="var">E'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">realizers_Equal'</span>. <span class="id" title="tactic">rewrite</span> -&gt; <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">fold</span> <span class="id" title="var">t_ty_denot</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">id</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">setoid_rewrite</span> -&gt; <span class="id" title="var">Smash_ValVal</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> -&gt; <span class="id" title="var">kleisliVal</span>. <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">Hgrab</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">test_gen_StepI</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">i</span>:=<span class="id" title="var">n</span>). <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">realizer_push</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">exists_fresh_pointer</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> (<span class="id" title="var">m</span> : <span class="id" title="var">nat</span>) <span class="id" title="var">Γ</span> <span class="id" title="var">i</span> <span class="id" title="var">η</span> <span class="id" title="var">ctx</span> <span class="id" title="var">a</span> <span class="id" title="var">b</span> (ρ : <span class="id" title="var">ctx_denot</span> <span class="id" title="var">ctx</span>) <span class="id" title="var">n</span> (<span class="id" title="var">f</span> : <span class="id" title="var">ty_denot</span> (<span class="id" title="var">a</span> ⇾ <span class="id" title="var">b</span>)),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">heap_wf</span> <span class="id" title="var">Γ</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">Q</span> : <span class="id" title="var">nth_error</span> <span class="id" title="var">ctx</span> <span class="id" title="var">n</span> = <span class="id" title="var">Some</span> <span class="id" title="var">a</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">Γ</span>, <span class="id" title="var">η</span>) ⊴ <span class="id" title="var">m</span> | ρ -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">Γ</span>, (<span class="id" title="var">i</span>, <span class="id" title="var">η</span>)) ∈ <span class="id" title="var">R</span>(<span class="id" title="var">a</span> ⇾ <span class="id" title="var">b</span>, <span class="id" title="var">m</span>, <span class="id" title="var">f</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">Γ</span>, (<span class="id" title="var">ipush</span> <span class="id" title="var">n</span> <span class="id" title="var">i</span>, <span class="id" title="var">η</span>)) ∈ <span class="id" title="var">R</span>(<span class="id" title="var">b</span>, <span class="id" title="var">m</span>, <span class="id" title="var">AppTy_</span>ρ <span class="id" title="var">f</span> (<span class="id" title="var">lookup_nat</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">Q</span> ρ)) .<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">EFP</span> <span class="id" title="var">m</span> <span class="id" title="var">Γ</span> <span class="id" title="var">i</span> <span class="id" title="var">η</span> <span class="id" title="var">ctx</span> <span class="id" title="var">a</span> <span class="id" title="var">b</span> ρ <span class="id" title="var">n</span> <span class="id" title="var">f</span> <span class="id" title="var">Γwf</span> <span class="id" title="var">Q</span> ρ<span class="id" title="var">_approx</span> <span class="id" title="var">IH</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">btop_weakened</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">Case</span> "Down Closed".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">fs</span> <span class="id" title="var">m'</span> <span class="id" title="var">m''</span> <span class="id" title="var">H</span> <span class="id" title="var">m'_le_m''</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">bbot_down_closed</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">m'_le_m''</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">Case</span> "Proof".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> (<span class="id" title="var">m'</span>, (<span class="id" title="var">Δ</span>, <span class="id" title="var">s</span>)) <span class="id" title="var">t_in</span> <span class="id" title="var">m'_leq_m</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">set</span> (<span class="id" title="var">d</span> := <span class="id" title="var">lookup_nat</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">Q</span> ρ).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">EFP</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">Γ</span>:=<span class="id" title="var">Γ</span> ∪ <span class="id" title="var">Δ</span>) (<span class="id" title="var">η</span>:=<span class="id" title="var">η</span>) (<span class="id" title="var">s</span>:=<span class="id" title="var">s</span>) <span class="id" title="keyword">as</span> [<span class="id" title="var">p</span> <span class="id" title="var">p_fresh</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">m'</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">isatif_eq_Fullset</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">rwf</span> <span class="id" title="var">twf</span> <span class="id" title="var">Γ_Δ</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">set</span> (<span class="id" title="var">H</span> := <span class="id" title="var">env_realizer_lookup</span> <span class="id" title="var">n</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">Q</span> ρ<span class="id" title="var">_approx</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">clearbody</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H</span>  <span class="id" title="keyword">as</span> [<span class="id" title="var">q</span> [<span class="id" title="var">EQ</span> <span class="id" title="var">EX</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">EX</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">α</span> [<span class="id" title="var">β</span> [<span class="id" title="var">F1</span> [? <span class="id" title="var">Hr2</span>]]]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">antiex</span>. <span class="id" title="tactic">constructor</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">EQ</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">Γ</span> ∪ <span class="id" title="var">Δ</span> ≃ <span class="id" title="var">Γ</span> ∪ (<span class="id" title="var">Γ</span> ∪ <span class="id" title="var">Δ</span>)) <span class="id" title="keyword">as</span> <span class="id" title="var">E</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">Join_assoc_1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">symmetry</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">Equal_join_mor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">Join_idem</span> ; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">Join_idem</span> ; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">Joinable_refl</span> ; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">auto</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">heap_rewrite_conf</span> <span class="id" title="var">E</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">realizer_in_Ω</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">a</span>:=<span class="id" title="var">a</span> ⇾ <span class="id" title="var">b</span>) (<span class="id" title="var">d</span>:=<span class="id" title="var">f</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">rwf</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">wf_union</span> ; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">Join_key_set</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">stack_ptr_cons_included</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">transitivity</span> (<span class="id" title="var">key_set</span> <span class="id" title="var">Δ</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">twf</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">auto</span> <span class="id" title="keyword">with</span> <span class="id" title="var">sets</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">Included_Singleton</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">transitivity</span> (<span class="id" title="var">key_set</span> <span class="id" title="var">Γ</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">Included_Singleton</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">key_set_find_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">auto</span> <span class="id" title="keyword">with</span> <span class="id" title="var">sets</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">Joinable_join_intro_r</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">Joinable_refl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">auto</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">realizer_gen_StepI</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">i</span>:=<span class="id" title="var">m</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">le_Sn_le</span>. <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">IH</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">Γ</span> ∪ <span class="id" title="var">Δ</span> ≃ <span class="id" title="var">Γ</span> ∪ <span class="id" title="var">Δ</span> ∪ (⎨ <span class="id" title="var">q</span> ⤇ <span class="id" title="var">β</span> ⎬)) <span class="id" title="keyword">as</span> <span class="id" title="var">E2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">find_singleton_Join</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">find_submap</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">join_sub1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">auto</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">heap_rewrite_test</span> <span class="id" title="var">E2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">tests_functional</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">α</span>:=<span class="id" title="var">α</span>) (<span class="id" title="var">d</span>:=<span class="id" title="var">lookup_nat</span> <span class="id" title="var">n</span> <span class="id" title="var">ctx</span> <span class="id" title="var">Q</span> ρ). <span class="id" title="tactic">apply</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">r_wf_find</span> ; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">Joinable_join_intro_l</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">find_singleton_Joinable</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">joinable_comm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">Joinable_submap</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">Equal_submap_mor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">find_singleton_Join</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">find_submap_singleton</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">find_singleton_Joinable</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">auto</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">realizer_gen_StepI</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">i</span>:=<span class="id" title="var">m</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">le_Sn_le</span>. <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">test_StepI</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">compiler_correctness_app</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">exists_fresh_pointer</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;∀ (<span class="id" title="var">c</span> : <span class="id" title="var">ctx</span>) (<span class="id" title="var">θ1</span> <span class="id" title="var">θ2</span> : <span class="id" title="keyword">type</span>) (<span class="id" title="var">t0</span> : <span class="id" title="var">term</span> <span class="id" title="var">c</span> (<span class="id" title="var">θ1</span> ⇾ <span class="id" title="var">θ2</span>)) (<span class="id" title="var">v</span> : <span class="id" title="var">var</span> <span class="id" title="var">c</span> <span class="id" title="var">θ1</span>) (<span class="id" title="var">i</span> : <span class="id" title="var">Code</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">d</span> : <span class="id" title="var">ctx_denot</span> <span class="id" title="var">c</span> =-&gt; <span class="id" title="var">ty_denot</span> (<span class="id" title="var">θ1</span> ⇾ <span class="id" title="var">θ2</span>)),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">c</span> ⊢ <span class="id" title="var">i</span> ◀| <span class="id" title="var">d</span>) →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">c</span> ⊢ (<span class="id" title="var">ipush</span> (<span class="id" title="var">var_to_nat</span> <span class="id" title="var">v</span>) <span class="id" title="var">i</span>) ◀| (<span class="id" title="var">AppTy</span> <span class="id" title="var">d</span> (<span class="id" title="var">lookup</span> <span class="id" title="var">v</span>))).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">EFP</span> <span class="id" title="var">c</span> <span class="id" title="var">θ1</span> <span class="id" title="var">θ2</span> <span class="id" title="var">t0</span> <span class="id" title="var">v</span> <span class="id" title="var">i</span> <span class="id" title="var">d</span> <span class="id" title="var">IH</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">n</span> <span class="id" title="var">Γ</span> <span class="id" title="var">η</span> ρ <span class="id" title="var">Γwf</span> ρ<span class="id" title="var">_approx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">realizers_Equal'</span>. <span class="id" title="tactic">by</span> <span class="id" title="tactic">rewrite</span> -&gt; <span class="id" title="var">sem_term_app_Eq</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">d</span>:=<span class="id" title="var">d</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">set</span> (<span class="id" title="var">Q</span> := <span class="id" title="var">nth_var_to_nat</span> <span class="id" title="var">v</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">clearbody</span> <span class="id" title="var">Q</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> (<span class="id" title="var">var_to_nat_lookup</span> <span class="id" title="var">v</span> ρ <span class="id" title="var">Q</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">realizer_push</span> ; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">tests_bop_1</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;∀ (<span class="id" title="var">m</span> : <span class="id" title="var">nat</span>) (π : <span class="id" title="var">ctx</span>) (<span class="id" title="var">bop</span> : <span class="id" title="var">BOp</span>) (<span class="id" title="var">Γ</span> <span class="id" title="var">Γ'</span>: <span class="id" title="var">Heap</span>) (<span class="id" title="var">i'</span> : <span class="id" title="var">Code</span>) (<span class="id" title="var">η</span> <span class="id" title="var">η'</span> : <span class="id" title="var">MEnv</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">z</span> : <span class="id" title="var">int_cpoType</span>) (<span class="id" title="var">Δ</span> : <span class="id" title="var">Heap</span>) (<span class="id" title="var">s</span> : <span class="id" title="var">stack</span>) (<span class="id" title="var">p</span> : <span class="id" title="var">Pointer</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">d</span> <span class="id" title="var">d'</span> : <span class="id" title="var">ctx_denot</span> π =-&gt; <span class="id" title="var">ty_denot</span> <span class="id" title="var">tint</span>) (ρ : <span class="id" title="var">ctx_denot</span> π),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">fresh_for_heap</span> <span class="id" title="var">p</span> (<span class="id" title="var">Γ</span> ∪ <span class="id" title="var">Δ</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">d</span> ρ =-= <span class="id" title="var">eta</span> <span class="id" title="var">z</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">Γ</span>, <span class="id" title="var">η</span>) ⊴ <span class="id" title="var">m</span> | ρ -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">r_wf</span> (<span class="id" title="var">Γ'</span>, (<span class="id" title="var">ival</span> (<span class="id" title="var">iint</span> <span class="id" title="var">z</span>), <span class="id" title="var">η'</span>)) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">t_wf</span> (<span class="id" title="var">Δ</span>, <span class="id" title="var">s</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Γ</span> ⋈ <span class="id" title="var">Δ</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Γ'</span> ⋈ <span class="id" title="var">Map.add</span> <span class="id" title="var">p</span> (<span class="id" title="var">K</span> (<span class="id" title="var">ZBOpL</span> <span class="id" title="var">i'</span>), <span class="id" title="var">η</span>) (<span class="id" title="var">Γ</span> ∪ <span class="id" title="var">Δ</span>) -&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">m</span>, (<span class="id" title="var">Δ</span>, <span class="id" title="var">s</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;∈<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@<span class="id" title="var">LiftRel</span> <span class="id" title="var">tint</span> ((((<span class="id" title="var">IntOpTy</span> (<span class="id" title="var">semZBOp</span> <span class="id" title="var">bop</span>)) <span class="id" title="var">d</span>) <span class="id" title="var">d'</span>) ρ) (<span class="id" title="var">Primitives</span> <span class="id" title="var">tint</span>) ⊥ -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">SetIn</span> (<span class="id" title="var">Tests</span> <span class="id" title="var">tint</span> (<span class="id" title="var">d'</span> ρ))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">m</span>, (<span class="id" title="var">Map.add</span> <span class="id" title="var">p</span> (<span class="id" title="var">K</span> (<span class="id" title="var">ZBOpR</span> (<span class="id" title="var">iint</span> <span class="id" title="var">z</span>)), <span class="id" title="var">η'</span>) (<span class="id" title="var">Γ'</span> ∪ <span class="id" title="var">Δ</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">bopapply</span> <span class="id" title="var">p</span> <span class="id" title="var">bop</span> :: <span class="id" title="var">s</span>)).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">m</span> π <span class="id" title="var">bop</span> <span class="id" title="var">Γ</span> <span class="id" title="var">Γ'</span> <span class="id" title="var">i'</span> <span class="id" title="var">η</span> <span class="id" title="var">η'</span> <span class="id" title="var">z</span> <span class="id" title="var">Δ</span> <span class="id" title="var">s</span> <span class="id" title="var">p</span> <span class="id" title="var">d</span> <span class="id" title="var">d'</span> ρ<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">p_fresh</span> <span class="id" title="var">d</span>ρ<span class="id" title="var">_eq_z</span> ρ<span class="id" title="var">_approx_m</span> <span class="id" title="var">Γ'wf</span> <span class="id" title="var">Δwf</span> <span class="id" title="var">Γ_Δ</span> <span class="id" title="var">Γ'_ΓΔp</span> <span class="id" title="var">t_Δ</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">bbot_weakened</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">Case</span> "Down Closed".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> (<span class="id" title="var">Γ''</span>,<span class="id" title="var">α'</span>) <span class="id" title="var">m'</span> <span class="id" title="var">m''</span> <span class="id" title="var">H</span> <span class="id" title="var">m'_le_m''</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">H</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">f'</span> [? ?]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exists</span> <span class="id" title="var">f'</span>. <span class="id" title="tactic">split</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">primitive_gen_StepI</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">i</span>:=<span class="id" title="var">m'</span>). <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">Case</span> "Proof".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> (<span class="id" title="var">m'</span>, (<span class="id" title="var">Γ''</span>, (<span class="id" title="var">im</span>, <span class="id" title="var">η''</span>))) <span class="id" title="var">pr_m'</span> <span class="id" title="var">m'_leq_m</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">m'</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">isatif_eq_Fullset</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rename</span> <span class="id" title="var">m'_leq_m</span> <span class="id" title="var">into</span> <span class="id" title="var">Sm'_leq_m</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">Γ''wf</span> <span class="id" title="var">ΓΔpwf</span> <span class="id" title="var">Γ''_Γ'Δp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">pr_m'</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">dm</span> [? ?]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">im</span> ; <span class="id" title="tactic">try</span> <span class="id" title="var">contradiction</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">v</span> ; <span class="id" title="tactic">try</span> <span class="id" title="var">contradiction</span>. <span class="id" title="tactic">rename</span> <span class="id" title="var">z0</span> <span class="id" title="var">into</span> <span class="id" title="var">z'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">antiex</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">tbop_apply_3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">heap_find_join_prop'</span>. <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">right</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">F.add_eq_o</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span>(<span class="id" title="var">Γ'_Δ</span> : <span class="id" title="var">Γ'</span> ⋈ <span class="id" title="var">Δ</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--  <span class="id" title="tactic">apply</span> <span class="id" title="var">Join_fresh_add_prop</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Γ'_ΓΔp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">joinable_comm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">Joinable_join_elim_2</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">Γ_Δ</span>. <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">p_fresh</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">as0</span> : <span class="id" title="var">Γ''</span> ∪ <span class="id" title="var">Map.add</span> <span class="id" title="var">p</span> (<span class="id" title="var">K</span> (<span class="id" title="var">ZBOpR</span> (<span class="id" title="var">iint</span> <span class="id" title="var">z</span>)), <span class="id" title="var">η'</span>) (<span class="id" title="var">Γ'</span> ∪ <span class="id" title="var">Δ</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;≃<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">Γ''</span> ∪ <span class="id" title="var">Map.add</span> <span class="id" title="var">p</span> (<span class="id" title="var">K</span> (<span class="id" title="var">ZBOpR</span> (<span class="id" title="var">iint</span> <span class="id" title="var">z</span>)), <span class="id" title="var">η'</span>) <span class="id" title="var">Γ'</span>) ∪ <span class="id" title="var">Δ</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">fresh_for_heap_join</span> <span class="id" title="tactic">in</span> <span class="id" title="var">p_fresh</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> -&gt; <span class="id" title="var">Equal_join_mor</span>. 2 : { <span class="id" title="tactic">auto</span>. } 2 : { <span class="id" title="tactic">reflexivity</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2 : { <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">heap_add_join_prop'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">Join_comm_1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">heap_add_join_prop</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">Join_comm_1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">joinable_comm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">Join_add_prop'</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">p_fresh</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">p_fresh</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">Join_add_prop''</span>. <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} 2 : { <span class="id" title="tactic">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">Join_comm_1</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Γ''_Γ'Δp</span>. 2 : { <span class="id" title="tactic">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">heap_add_join_prop'</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Γ''_Γ'Δp</span>. 2 : { <span class="id" title="tactic">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">Join_assoc_1</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">comp_join_elim_r</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">Δ</span>:=<span class="id" title="var">add</span> <span class="id" title="var">p</span> (<span class="id" title="var">K</span> (<span class="id" title="var">ZBOpR</span> (<span class="id" title="var">iint</span> <span class="id" title="var">z</span>)), <span class="id" title="var">η'</span>) <span class="id" title="var">Δ</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">Join_add_prop''</span>. <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2 : { <span class="id" title="tactic">apply</span> <span class="id" title="var">Join_add_prop</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">Joinable_fresh</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">p_fresh</span>. <span class="id" title="tactic">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">comp_join_elim_l</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">Σ</span>:=<span class="id" title="var">add</span> <span class="id" title="var">p</span> (<span class="id" title="var">K</span> (<span class="id" title="var">ZBOpR</span> (<span class="id" title="var">iint</span> <span class="id" title="var">z</span>)), <span class="id" title="var">η'</span>) <span class="id" title="var">Γ'</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">joinable_comm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">Join_add_prop'</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">p_fresh</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">heap_add_join_prop</span>. <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">p_fresh</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">heap_rewrite_conf</span> <span class="id" title="var">as0</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">as1</span> : (<span class="id" title="var">m'</span>,(<span class="id" title="var">Γ''</span> ∪ <span class="id" title="var">Map.add</span> <span class="id" title="var">p</span> (<span class="id" title="var">K</span> (<span class="id" title="var">ZBOpR</span> (<span class="id" title="var">iint</span> <span class="id" title="var">z</span>)), <span class="id" title="var">η'</span>) <span class="id" title="var">Γ'</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">ival</span> (<span class="id" title="var">iint</span> (<span class="id" title="var">semZBOp</span> <span class="id" title="var">bop</span> <span class="id" title="var">z</span> <span class="id" title="var">z'</span>)), <span class="id" title="var">η'</span>)))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;∈ @<span class="id" title="var">LiftRel</span> <span class="id" title="var">tint</span> ((((<span class="id" title="var">IntOpTy</span> (<span class="id" title="var">semZBOp</span> <span class="id" title="var">bop</span>)) <span class="id" title="var">d</span>) <span class="id" title="var">d'</span>) ρ)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">Primitives</span> <span class="id" title="var">tint</span>)).<br/>
&nbsp;&nbsp;- <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">as2</span> : (((<span class="id" title="var">IntOpTy</span> (<span class="id" title="var">semZBOp</span> <span class="id" title="var">bop</span>)) <span class="id" title="var">d</span>) <span class="id" title="var">d'</span>) ρ =-= <span class="id" title="var">eta</span> (<span class="id" title="var">semZBOp</span> <span class="id" title="var">bop</span> <span class="id" title="var">z</span> <span class="id" title="var">z'</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;-- <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">id</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">rewrite</span> -&gt; <span class="id" title="var">H</span>, -&gt; <span class="id" title="var">d</span>ρ<span class="id" title="var">_eq_z</span>, -&gt; <span class="id" title="var">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">setoid_rewrite</span> -&gt; <span class="id" title="var">Smash_ValVal</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> -&gt; <span class="id" title="var">kleisliVal</span>. <span class="id" title="tactic">by</span> <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exists</span> (<span class="id" title="var">semZBOp</span> <span class="id" title="var">bop</span> <span class="id" title="var">z</span> <span class="id" title="var">z'</span>). <span class="id" title="tactic">split</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">split</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Join_key_set</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">q</span> <span class="id" title="var">q_in</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">Union_intror</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">F.add_in_iff</span>. <span class="id" title="tactic">right</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">Γ'wf</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">Join_comm_1</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Γ''_Γ'Δp</span>. 2 : { <span class="id" title="tactic">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">heap_add_join_prop'</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Γ''_Γ'Δp</span>. 2 : { <span class="id" title="tactic">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">comp_join_elim_r</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">Δ</span>:=<span class="id" title="var">add</span> <span class="id" title="var">p</span> (<span class="id" title="var">K</span> (<span class="id" title="var">ZBOpR</span> (<span class="id" title="var">iint</span> <span class="id" title="var">z</span>)), <span class="id" title="var">η'</span>) <span class="id" title="var">Δ</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">Join_add_prop''</span>. <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">test_gen_StepI</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">j</span>:=<span class="id" title="var">m'</span>) <span class="id" title="tactic">in</span> <span class="id" title="var">t_Δ</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">t_Δ</span> <span class="id" title="var">_</span> <span class="id" title="var">as1</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> "⊧", <span class="id" title="var">satif</span>, <span class="id" title="var">mrel</span>, <span class="id" title="var">isatif</span> <span class="id" title="tactic">in</span> <span class="id" title="var">t_Δ</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> -&gt; <span class="id" title="var">Nat.min_id</span> <span class="id" title="tactic">in</span> <span class="id" title="var">t_Δ</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">t_Δ</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">r_wf</span>. <span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">wf_union</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">Join_comm_1</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Γ''_Γ'Δp</span>. 2 : { <span class="id" title="tactic">auto</span>. }<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">heap_add_join_prop'</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Γ''_Γ'Δp</span>. 2 : { <span class="id" title="tactic">auto</span>. }<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">comp_join_elim_r</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">Δ</span>:=<span class="id" title="var">add</span> <span class="id" title="var">p</span> (<span class="id" title="var">K</span> (<span class="id" title="var">ZBOpR</span> (<span class="id" title="var">iint</span> <span class="id" title="var">z</span>)), <span class="id" title="var">η'</span>) <span class="id" title="var">Δ</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">Join_add_prop''</span>. <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">Γ''wf</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">wf_add</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">Γ'wf</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">Γ'wf</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">q</span> <span class="id" title="var">q_in</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">join_in2</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">F.add_in_iff</span>. <span class="id" title="tactic">right</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">Γ'wf</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> (<span class="id" title="var">fresh_for_heap_join</span> <span class="id" title="var">Γ_Δ</span>) <span class="id" title="tactic">in</span> <span class="id" title="var">p_fresh</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">Joinable_join_intro_l</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">Join_comm_1</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Γ''_Γ'Δp</span>. 2 : { <span class="id" title="tactic">auto</span>. }<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">heap_add_join_prop'</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Γ''_Γ'Δp</span>. 2 : { <span class="id" title="tactic">auto</span>. }<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">comp_join_elim_l</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">Σ</span>:=<span class="id" title="var">add</span> <span class="id" title="var">p</span> (<span class="id" title="var">K</span> (<span class="id" title="var">ZBOpR</span> (<span class="id" title="var">iint</span> <span class="id" title="var">z</span>)), <span class="id" title="var">η'</span>) <span class="id" title="var">Γ'</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">joinable_comm</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">Join_add_prop'</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">p_fresh</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">auto</span>. <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">heap_add_join_prop</span>. <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">p_fresh</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">Join_add_prop'</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">p_fresh</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">Nat.le_trans</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">m</span>:=<span class="id" title="var">m'</span>.+1). <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">tests_bop_2</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;∀ (<span class="id" title="var">m</span> : <span class="id" title="var">nat</span>) (<span class="id" title="var">bop</span> : <span class="id" title="var">BOp</span>) (<span class="id" title="var">c</span> : <span class="id" title="var">ctx</span>) (<span class="id" title="var">Γ</span> : <span class="id" title="var">Heap</span>) (<span class="id" title="var">i</span> <span class="id" title="var">i'</span> : <span class="id" title="var">Code</span>) (<span class="id" title="var">η</span> : <span class="id" title="var">MEnv</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">Δ</span> : <span class="id" title="var">Heap</span>) (<span class="id" title="var">s</span> : <span class="id" title="var">stack</span>) (<span class="id" title="var">p</span> : <span class="id" title="var">Pointer</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">d</span> <span class="id" title="var">d'</span> : <span class="id" title="var">ctx_denot</span> <span class="id" title="var">c</span> =-&gt; <span class="id" title="var">ty_denot</span> <span class="id" title="var">tint</span>) (ρ : <span class="id" title="var">ctx_denot</span> <span class="id" title="var">c</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">fresh_for_heap</span> <span class="id" title="var">p</span> (<span class="id" title="var">Γ</span> ∪ <span class="id" title="var">Δ</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">Γ</span>, <span class="id" title="var">η</span>) ⊴ <span class="id" title="var">m</span> | ρ -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">c</span> ⊢ <span class="id" title="var">i'</span> ◀| <span class="id" title="var">d'</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;((<span class="id" title="var">m</span>.+1, (<span class="id" title="var">Δ</span>, <span class="id" title="var">s</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;∈ @<span class="id" title="var">LiftRel</span> <span class="id" title="var">tint</span> ((((<span class="id" title="var">IntOpTy</span> (<span class="id" title="var">semZBOp</span> <span class="id" title="var">bop</span>)) <span class="id" title="var">d</span>) <span class="id" title="var">d'</span>) ρ)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">Primitives</span> <span class="id" title="var">tint</span>) ⊥) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">r_wf</span> (<span class="id" title="var">Γ</span>, (<span class="id" title="var">ibop</span> <span class="id" title="var">bop</span> <span class="id" title="var">i</span> <span class="id" title="var">i'</span>, <span class="id" title="var">η</span>)) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">t_wf</span> (<span class="id" title="var">Δ</span>, <span class="id" title="var">s</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Γ</span> ⋈ <span class="id" title="var">Δ</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">SetIn</span> (<span class="id" title="var">Tests</span> <span class="id" title="var">tint</span> (<span class="id" title="var">d</span> ρ))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">m</span>, (<span class="id" title="var">Map.add</span> <span class="id" title="var">p</span> (<span class="id" title="var">K</span> (<span class="id" title="var">ZBOpL</span> <span class="id" title="var">i'</span>), <span class="id" title="var">η</span>) (<span class="id" title="var">Γ</span> ∪ <span class="id" title="var">Δ</span>), <span class="id" title="var">bopapply</span> <span class="id" title="var">p</span> <span class="id" title="var">bop</span> :: <span class="id" title="var">s</span>)).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">m</span> <span class="id" title="var">bop</span> <span class="id" title="var">c</span> <span class="id" title="var">Γ</span> <span class="id" title="var">i</span> <span class="id" title="var">i'</span> <span class="id" title="var">η</span> <span class="id" title="var">Δ</span> <span class="id" title="var">s</span> <span class="id" title="var">p</span> <span class="id" title="var">d</span> <span class="id" title="var">d'</span> ρ <span class="id" title="var">p_fresh</span> ρ<span class="id" title="var">_approx_m</span> <span class="id" title="var">IH'</span> <span class="id" title="var">t_Δ</span> <span class="id" title="var">Γwf</span> <span class="id" title="var">Δwf</span> <span class="id" title="var">Γ_Δ</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">bbot_weakened</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">Case</span> "Down Closed".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> (<span class="id" title="var">Γ'</span>,<span class="id" title="var">α'</span>) <span class="id" title="var">m'</span> <span class="id" title="var">m''</span> <span class="id" title="var">H</span> <span class="id" title="var">m'_le_m''</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">H</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">f'</span> [? ?]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exists</span> <span class="id" title="var">f'</span>. <span class="id" title="tactic">split</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">primitive_gen_StepI</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">i</span>:=<span class="id" title="var">m'</span>). <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">Case</span> "Proof".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> (<span class="id" title="var">m'</span>, (<span class="id" title="var">Γ'</span>, (<span class="id" title="var">im</span>, <span class="id" title="var">η'</span>))) <span class="id" title="var">r_m'</span> <span class="id" title="var">m'_leq_m</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">m'</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">isatif_eq_Fullset</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rename</span> <span class="id" title="var">m'_leq_m</span> <span class="id" title="var">into</span> <span class="id" title="var">Sm'_leq_m</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">Γ'wf</span> <span class="id" title="var">ΓΔpwf</span> <span class="id" title="var">Γ'_ΓΔp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">r_m'</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">dm</span> [? ?]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">im</span> ; <span class="id" title="tactic">try</span> <span class="id" title="var">contradiction</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">v</span> ; <span class="id" title="tactic">try</span> <span class="id" title="var">contradiction</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">antiex</span>. <span class="id" title="tactic">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">heap_find_join_prop'</span>. <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">right</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">F.add_eq_o</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">as0</span> : <span class="id" title="var">Map.add</span> <span class="id" title="var">p</span> (<span class="id" title="var">K</span> (<span class="id" title="var">ZBOpR</span> (<span class="id" title="var">iint</span> <span class="id" title="var">z</span>)), <span class="id" title="var">η'</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">Γ'</span> ∪ <span class="id" title="var">Map.add</span> <span class="id" title="var">p</span> (<span class="id" title="var">K</span> (<span class="id" title="var">ZBOpL</span> <span class="id" title="var">i'</span>), <span class="id" title="var">η</span>) (<span class="id" title="var">Γ</span> ∪ <span class="id" title="var">Δ</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;≃<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Γ</span> ∪ (<span class="id" title="var">Map.add</span> <span class="id" title="var">p</span> (<span class="id" title="var">K</span> (<span class="id" title="var">ZBOpR</span> (<span class="id" title="var">iint</span> <span class="id" title="var">z</span>)), <span class="id" title="var">η'</span>) (<span class="id" title="var">Γ'</span> ∪ <span class="id" title="var">Δ</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id" title="var">SCase</span> "as0".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span>(<span class="id" title="var">Γ'_Γ</span> : <span class="id" title="var">Γ'</span> ⋈ <span class="id" title="var">Γ</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;---  <span class="id" title="tactic">apply</span> <span class="id" title="var">Join_fresh_add_prop</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Γ'_ΓΔp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">joinable_comm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">Joinable_join_elim_2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">joinable_comm</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">Γ_Δ</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">Join_comm_1</span>. <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">p_fresh</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span>(<span class="id" title="var">Γ'_Δ</span> : <span class="id" title="var">Γ'</span> ⋈ <span class="id" title="var">Δ</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;---  <span class="id" title="tactic">apply</span> <span class="id" title="var">Join_fresh_add_prop</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Γ'_ΓΔp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">joinable_comm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">Joinable_join_elim_2</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">Γ_Δ</span>. <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">p_fresh</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">heap_add_join_prop'</span>. 2 : { <span class="id" title="tactic">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> -&gt; <span class="id" title="var">Equal_join_mor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2 : { <span class="id" title="tactic">apply</span> <span class="id" title="var">Join_add_prop''</span>. <span class="id" title="tactic">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2 : { <span class="id" title="tactic">reflexivity</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2 : { <span class="id" title="tactic">rewrite</span> <span class="id" title="var">heap_add_update_prop</span>. <span class="id" title="tactic">reflexivity</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> -&gt; <span class="id" title="var">Equal_join_mor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2 : { <span class="id" title="tactic">apply</span> <span class="id" title="var">Join_add_prop''</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">Join_fresh_add_prop</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Γ'_ΓΔp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">auto</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">p_fresh</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2 : { <span class="id" title="tactic">reflexivity</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2 : { <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">heap_add_join_prop'</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="tactic">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">Join_assoc_1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> -&gt; <span class="id" title="var">Equal_join_mor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2 : { <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Join_comm_1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> -&gt; <span class="id" title="var">heap_add_join_prop'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">Join_add_prop''</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">Joinable_join_intro_l</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">Join_add_prop''</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2 : { <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Join_comm_1</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">Join_add_prop''</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2 : { <span class="id" title="tactic">reflexivity</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2 : { <span class="id" title="tactic">apply</span> <span class="id" title="var">Join_add_prop''</span>. <span class="id" title="tactic">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2 : { <span class="id" title="tactic">apply</span> <span class="id" title="var">Join_add_prop''</span>. <span class="id" title="tactic">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2 : { <span class="id" title="tactic">apply</span> <span class="id" title="var">Join_add_prop''</span>. <span class="id" title="tactic">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> -&gt; <span class="id" title="var">Join_assoc_1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> -&gt; <span class="id" title="var">Equal_join_mor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2 : { <span class="id" title="tactic">apply</span> <span class="id" title="var">Joinable_join_intro_r</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">Join_add_prop''</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">Join_add_prop''</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2 : { <span class="id" title="tactic">reflexivity</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2 : { <span class="id" title="tactic">rewrite</span> -&gt; <span class="id" title="var">heap_add_join_prop'</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="tactic">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2 : { <span class="id" title="tactic">apply</span> <span class="id" title="var">Join_add_prop''</span>. <span class="id" title="tactic">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2 : { <span class="id" title="tactic">apply</span> <span class="id" title="var">Join_add_prop''</span>. <span class="id" title="tactic">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2 : { <span class="id" title="tactic">apply</span> <span class="id" title="var">Join_add_prop''</span>. <span class="id" title="tactic">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> -&gt; <span class="id" title="var">heap_add_join_prop</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">fresh_for_heap_join</span> <span class="id" title="tactic">in</span> <span class="id" title="var">p_fresh</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">p_fresh</span>. <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">heap_rewrite_conf</span> <span class="id" title="var">as0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">have</span> <span class="id" title="var">m'_leq_m</span> := <span class="id" title="var">Nat.le_trans</span> <span class="id" title="var">m'</span> (<span class="id" title="var">m'</span>.+1) <span class="id" title="var">m</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">Nat.lt_le_incl</span> <span class="id" title="var">m'</span> (<span class="id" title="var">m'</span>.+1)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">Nat.lt_succ_diag_r</span> <span class="id" title="var">m'</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Sm'_leq_m</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">have</span> ρ<span class="id" title="var">_approx_m'</span> := <span class="id" title="var">env_realizer_gen_StepI</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">m'_leq_m</span> ρ<span class="id" title="var">_approx_m</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">as1</span> : <span class="id" title="var">SetIn</span> (<span class="id" title="var">Tests</span> <span class="id" title="var">tint</span> (<span class="id" title="var">d'</span> ρ))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">m'</span>, (<span class="id" title="var">Map.add</span> <span class="id" title="var">p</span> (<span class="id" title="var">K</span> (<span class="id" title="var">ZBOpR</span> (<span class="id" title="var">iint</span> <span class="id" title="var">z</span>)), <span class="id" title="var">η'</span>) (<span class="id" title="var">Γ'</span> ∪ <span class="id" title="var">Δ</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">bopapply</span> <span class="id" title="var">p</span> <span class="id" title="var">bop</span> :: <span class="id" title="var">s</span>))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">tests_bop_1</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">d</span>:=<span class="id" title="var">d</span>). <span class="id" title="tactic">apply</span> <span class="id" title="var">p_fresh</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">H1</span>. <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">apply</span> ρ<span class="id" title="var">_approx_m'</span>. <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">Γ'_ΓΔp</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">test_gen_StepI</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">i</span>:=<span class="id" title="var">m</span>.+1).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">Nat.le_trans</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">m</span>:=<span class="id" title="var">m</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">Nat.le_trans</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">m</span>:=<span class="id" title="var">m'</span>.+1). <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">IH'</span> <span class="id" title="var">m'</span> <span class="id" title="var">Γ</span> <span class="id" title="var">η</span> ρ (<span class="id" title="var">fst</span> <span class="id" title="var">Γwf</span>) ρ<span class="id" title="var">_approx_m'</span> <span class="id" title="var">_</span> <span class="id" title="var">as1</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> "⊧", <span class="id" title="var">satif</span>, <span class="id" title="var">mrel</span>, <span class="id" title="var">isatif</span> <span class="id" title="tactic">in</span> <span class="id" title="var">IH'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> -&gt; <span class="id" title="var">Nat.min_id</span> <span class="id" title="tactic">in</span> <span class="id" title="var">IH'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">IH'</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">split</span>. <span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">q</span> <span class="id" title="var">q_in</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">q_in</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H1</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">k</span> [? [? [? ?]]]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">F.add_mapsto_iff</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H1</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">H1</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">F.add_in_iff</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H3</span>. <span class="id" title="tactic">right</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">join_in1</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">Γ'wf</span>. <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">H6</span> <span class="id" title="tactic">in</span> *. <span class="id" title="tactic">apply</span> <span class="id" title="var">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">F.add_in_iff</span>. <span class="id" title="tactic">right</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">join_MapsTo</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H3</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">join_in1</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">Γ'wf</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H4</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">Union_intror</span>. <span class="id" title="tactic">exists</span> <span class="id" title="var">k</span>, <span class="id" title="var">x0</span>, <span class="id" title="var">x1</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">join_in2</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">Δwf</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H4</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">Union_intror</span>. <span class="id" title="tactic">exists</span> <span class="id" title="var">k</span>, <span class="id" title="var">x0</span>, <span class="id" title="var">x1</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">q</span> <span class="id" title="var">q_in</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">Union_introl</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">q</span> <span class="id" title="var">q_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">q_in</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H1</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">F.add_in_iff</span>. <span class="id" title="tactic">right</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">join_in2</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">Δwf</span>. <span class="id" title="tactic">left</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H1</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H2</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">F.add_in_iff</span>. <span class="id" title="tactic">right</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">join_in2</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">Δwf</span>. <span class="id" title="tactic">right</span>. <span class="id" title="tactic">left</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H2</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H3</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H4</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">F.add_in_iff</span>. <span class="id" title="tactic">right</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">join_in2</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">Δwf</span>. <span class="id" title="tactic">right</span>. <span class="id" title="tactic">right</span>. <span class="id" title="tactic">left</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H4</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H3</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H4</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H5</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">F.add_in_iff</span>. <span class="id" title="tactic">right</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">join_in2</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">Δwf</span>. <span class="id" title="tactic">right</span>. <span class="id" title="tactic">right</span>. <span class="id" title="tactic">right</span>. <span class="id" title="tactic">left</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H5</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H4</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H5</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H6</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H7</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">F.add_in_iff</span>. <span class="id" title="tactic">left</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">F.add_in_iff</span>. <span class="id" title="tactic">right</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">join_in2</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">Δwf</span>. <span class="id" title="tactic">right</span>. <span class="id" title="tactic">right</span>. <span class="id" title="tactic">right</span>. <span class="id" title="tactic">right</span>. <span class="id" title="tactic">left</span>. <span class="id" title="tactic">exists</span> <span class="id" title="var">x</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H5</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H6</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">F.add_in_iff</span>. <span class="id" title="tactic">right</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">join_in2</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">Δwf</span>. <span class="id" title="tactic">right</span>. <span class="id" title="tactic">right</span>. <span class="id" title="tactic">right</span>. <span class="id" title="tactic">right</span>. <span class="id" title="tactic">right</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">joinable_comm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">Join_add_prop'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> (<span class="id" title="var">fresh_for_heap_join</span> <span class="id" title="var">Γ_Δ</span> <span class="id" title="var">p_fresh</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span>(<span class="id" title="var">Γ'_Γ</span> : <span class="id" title="var">Γ'</span> ⋈ <span class="id" title="var">Γ</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--  <span class="id" title="tactic">apply</span> <span class="id" title="var">Join_fresh_add_prop</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Γ'_ΓΔp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">joinable_comm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">Joinable_join_elim_2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">joinable_comm</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">Γ_Δ</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">Join_comm_1</span>. <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">p_fresh</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">Joinable_join_intro_l</span>. <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">compiler_correctness_bop</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;∀ (<span class="id" title="var">bop</span> : <span class="id" title="var">BOp</span>) (π : <span class="id" title="var">ctx</span>) (<span class="id" title="var">i</span> <span class="id" title="var">i'</span> : <span class="id" title="var">Code</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">d</span> <span class="id" title="var">d'</span> : <span class="id" title="var">ctx_denot</span> π =-&gt; <span class="id" title="var">ty_denot</span> <span class="id" title="var">tint</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">exists_fresh_pointer</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(π ⊢ <span class="id" title="var">i</span> ◀| <span class="id" title="var">d</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(π ⊢ <span class="id" title="var">i'</span> ◀| <span class="id" title="var">d'</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(@<span class="id" title="var">GRealizers</span> π <span class="id" title="var">tint</span> (<span class="id" title="var">IntOpTy</span> (<span class="id" title="var">semZBOp</span> <span class="id" title="var">bop</span>) <span class="id" title="var">d</span> <span class="id" title="var">d'</span>) (<span class="id" title="var">ibop</span> <span class="id" title="var">bop</span> <span class="id" title="var">i</span> <span class="id" title="var">i'</span>)).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">bop</span> <span class="id" title="var">c</span> <span class="id" title="var">i</span> <span class="id" title="var">i'</span> <span class="id" title="var">d</span> <span class="id" title="var">d'</span> <span class="id" title="var">EFP</span> <span class="id" title="var">IH</span> <span class="id" title="var">IH'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">n</span> <span class="id" title="var">Γ</span> <span class="id" title="var">η</span> ρ <span class="id" title="var">Γwf</span> ρ<span class="id" title="var">_approx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">btop_weakened</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">Case</span> "Down Closed".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">fs</span> <span class="id" title="var">m</span> <span class="id" title="var">m'</span> <span class="id" title="var">H</span> <span class="id" title="var">m_le_m'</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">bbot_down_closed</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">m_le_m'</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">Case</span> "Proof".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> (<span class="id" title="var">m</span>, (<span class="id" title="var">Δ</span>, <span class="id" title="var">s</span>)) <span class="id" title="var">t_in</span> <span class="id" title="var">m_leq_n</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">EFP</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">Γ</span>:=<span class="id" title="var">Γ</span> ∪ <span class="id" title="var">Δ</span>) (<span class="id" title="var">η</span>:=<span class="id" title="var">η</span>) (<span class="id" title="var">s</span>:=<span class="id" title="var">s</span>) <span class="id" title="keyword">as</span> [<span class="id" title="var">p</span> <span class="id" title="var">p_fresh</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">m</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">isatif_eq_Fullset</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rename</span> <span class="id" title="var">m_leq_n</span> <span class="id" title="var">into</span> <span class="id" title="var">Sm_leq_n</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">Γwf'</span> <span class="id" title="var">Δwf</span> <span class="id" title="var">Γ_Δ</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">antiex</span>. <span class="id" title="tactic">constructor</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">p_fresh</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">have</span> <span class="id" title="var">m_leq_n</span> := <span class="id" title="var">Nat.le_trans</span> <span class="id" title="var">m</span> (<span class="id" title="var">m</span>.+1) <span class="id" title="var">n</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">Nat.lt_le_incl</span> <span class="id" title="var">m</span> (<span class="id" title="var">m</span>.+1)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">Nat.lt_succ_diag_r</span> <span class="id" title="var">m</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Sm_leq_n</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">have</span> ρ<span class="id" title="var">_approx_m</span> := <span class="id" title="var">env_realizer_gen_StepI</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">m_leq_n</span> ρ<span class="id" title="var">_approx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">as0</span> : <span class="id" title="var">SetIn</span> (<span class="id" title="var">Tests</span> <span class="id" title="var">tint</span> (<span class="id" title="var">d</span> ρ))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">m</span>, (<span class="id" title="var">Map.add</span> <span class="id" title="var">p</span> (<span class="id" title="var">K</span> (<span class="id" title="var">ZBOpL</span> <span class="id" title="var">i'</span>), <span class="id" title="var">η</span>) (<span class="id" title="var">Γ</span> ∪ <span class="id" title="var">Δ</span>), <span class="id" title="var">bopapply</span> <span class="id" title="var">p</span> <span class="id" title="var">bop</span> :: <span class="id" title="var">s</span>))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">tests_bop_2</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">p_fresh</span>. <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">IH'</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">Γwf'</span>. <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">IH</span> <span class="id" title="var">m</span> <span class="id" title="var">Γ</span> <span class="id" title="var">η</span>  ρ <span class="id" title="var">Γwf</span> ρ<span class="id" title="var">_approx_m</span> <span class="id" title="var">_</span> <span class="id" title="var">as0</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">as1</span> : <span class="id" title="var">Γ</span> ∪ <span class="id" title="var">Map.add</span> <span class="id" title="var">p</span> (<span class="id" title="var">K</span> (<span class="id" title="var">ZBOpL</span> <span class="id" title="var">i'</span>), <span class="id" title="var">η</span>) (<span class="id" title="var">Γ</span> ∪ <span class="id" title="var">Δ</span>) ≃<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Map.add</span> <span class="id" title="var">p</span> (<span class="id" title="var">K</span> (<span class="id" title="var">ZBOpL</span> <span class="id" title="var">i'</span>), <span class="id" title="var">η</span>) (<span class="id" title="var">Γ</span> ∪ <span class="id" title="var">Δ</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">p_fresh</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">H'</span> := <span class="id" title="var">H</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">fresh_for_heap_join</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">Join_comm_1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">heap_add_prop_idemp'''</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">auto</span>. <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">Join_add</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">Joinable_join_intro_r</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">Joinable_join_intro_r</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">Joinable_refl</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">Joinable_fresh</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">Joinable_fresh</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">symmetry</span> <span class="id" title="tactic">in</span> <span class="id" title="var">as1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">heap_rewrite_conf</span> <span class="id" title="var">as1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> "⊧", <span class="id" title="var">satif</span>, <span class="id" title="var">mrel</span>, <span class="id" title="var">isatif</span> <span class="id" title="tactic">in</span> <span class="id" title="var">IH</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> -&gt; <span class="id" title="var">Nat.min_id</span> <span class="id" title="tactic">in</span> <span class="id" title="var">IH</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">IH</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">split</span>. <span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">q</span> <span class="id" title="var">q_in</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">q_in</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">k</span> [? [? [? ?]]]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">F.add_mapsto_iff</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">F.add_in_iff</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H1</span>. <span class="id" title="tactic">right</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">join_in1</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">Γwf'</span>. <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">H4</span> <span class="id" title="tactic">in</span> *. <span class="id" title="tactic">apply</span> <span class="id" title="var">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">F.add_in_iff</span>. <span class="id" title="tactic">right</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">join_MapsTo</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H1</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">join_in1</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">Γwf'</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">Union_intror</span>. <span class="id" title="tactic">exists</span> <span class="id" title="var">k</span>, <span class="id" title="var">x0</span>, <span class="id" title="var">x1</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">join_in2</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">Δwf</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">Union_intror</span>. <span class="id" title="tactic">exists</span> <span class="id" title="var">k</span>, <span class="id" title="var">x0</span>, <span class="id" title="var">x1</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">q</span> <span class="id" title="var">q_in</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">Union_introl</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">q</span> <span class="id" title="var">q_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">q_in</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">F.add_in_iff</span>. <span class="id" title="tactic">right</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">join_in2</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">Δwf</span>. <span class="id" title="tactic">left</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">F.add_in_iff</span>. <span class="id" title="tactic">right</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">join_in2</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">Δwf</span>. <span class="id" title="tactic">right</span>. <span class="id" title="tactic">left</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H1</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">F.add_in_iff</span>. <span class="id" title="tactic">right</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">join_in2</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">Δwf</span>. <span class="id" title="tactic">right</span>. <span class="id" title="tactic">right</span>. <span class="id" title="tactic">left</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H1</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H2</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">F.add_in_iff</span>. <span class="id" title="tactic">right</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">join_in2</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">Δwf</span>. <span class="id" title="tactic">right</span>. <span class="id" title="tactic">right</span>. <span class="id" title="tactic">right</span>. <span class="id" title="tactic">left</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H2</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H3</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H4</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H5</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">F.add_in_iff</span>. <span class="id" title="tactic">left</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">F.add_in_iff</span>. <span class="id" title="tactic">right</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">join_in2</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">Δwf</span>. <span class="id" title="tactic">right</span>. <span class="id" title="tactic">right</span>. <span class="id" title="tactic">right</span>. <span class="id" title="tactic">right</span>. <span class="id" title="tactic">left</span>. <span class="id" title="tactic">exists</span> <span class="id" title="var">x</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H3</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H4</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">F.add_in_iff</span>. <span class="id" title="tactic">right</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">join_in2</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">Δwf</span>. <span class="id" title="tactic">right</span>. <span class="id" title="tactic">right</span>. <span class="id" title="tactic">right</span>. <span class="id" title="tactic">right</span>. <span class="id" title="tactic">right</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">joinable_comm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">Join_add_prop'</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">p_fresh</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> (<span class="id" title="var">fresh_for_heap_join</span> <span class="id" title="var">Γ_Δ</span> <span class="id" title="var">H</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">Joinable_join_intro_l</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">Joinable_refl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">ifz_conf_prop</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">n</span> <span class="id" title="var">Γ</span> <span class="id" title="var">Γ'</span> <span class="id" title="var">Δ</span> <span class="id" title="var">α</span> <span class="id" title="var">i</span> <span class="id" title="var">i'</span> <span class="id" title="var">p</span> <span class="id" title="var">η</span> <span class="id" title="var">s</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">fresh_for_heap</span> <span class="id" title="var">p</span> (<span class="id" title="var">Γ</span> ∪ <span class="id" title="var">Δ</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">r_wf</span> (<span class="id" title="var">Γ</span>, (<span class="id" title="var">i</span>, <span class="id" title="var">η</span>)) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">t_wf</span> (<span class="id" title="var">Δ</span>, <span class="id" title="var">s</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Γ</span> ⋈ <span class="id" title="var">Δ</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Γ'</span> ⋈ <span class="id" title="var">Map.add</span> <span class="id" title="var">p</span> (<span class="id" title="var">α</span>, <span class="id" title="var">η</span>) (<span class="id" title="var">Γ</span> ∪ <span class="id" title="var">Δ</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">SetIn</span> (<span class="id" title="var">Ω</span> <span class="id" title="var">n</span>) (<span class="id" title="var">Γ</span> ∪ <span class="id" title="var">Δ</span>, (<span class="id" title="var">i'</span>, <span class="id" title="var">η</span>), <span class="id" title="var">s</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">SetIn</span> (<span class="id" title="var">Ω</span> <span class="id" title="var">n</span>) (<span class="id" title="var">Γ'</span> ∪ <span class="id" title="var">Map.add</span> <span class="id" title="var">p</span> (<span class="id" title="var">α</span>, <span class="id" title="var">η</span>) (<span class="id" title="var">Γ</span> ∪ <span class="id" title="var">Δ</span>), (<span class="id" title="var">i'</span>, <span class="id" title="var">η</span>), <span class="id" title="var">s</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">n</span> <span class="id" title="var">Γ</span> <span class="id" title="var">Γ'</span> <span class="id" title="var">Δ</span> <span class="id" title="var">α</span> <span class="id" title="var">i</span> <span class="id" title="var">i'</span> <span class="id" title="var">p</span> <span class="id" title="var">η</span> <span class="id" title="var">s</span> <span class="id" title="var">p_fresh</span> <span class="id" title="var">Γwf</span> <span class="id" title="var">Δwf</span> <span class="id" title="var">Γ_Δ</span> <span class="id" title="var">Γ'_pΓΔ</span> <span class="id" title="var">w_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">have</span> <span class="id" title="var">hp</span> := <span class="id" title="var">heaps_prop_ifz</span> <span class="id" title="var">p_fresh</span> <span class="id" title="var">Γ_Δ</span> <span class="id" title="var">Γ'_pΓΔ</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">heap_rewrite_conf</span> <span class="id" title="var">hp</span>. <span class="id" title="tactic">clear</span> <span class="id" title="var">hp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">extend_heap</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">Joinable_join_intro_r</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">joinable_comm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">Join_fresh_add_prop</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">p_fresh</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">Γ'_pΓΔ</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">Joinable_join_intro_l</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">joinable_comm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">Join_add_prop'</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">fresh_for_heap_join</span> <span class="id" title="tactic">in</span> <span class="id" title="var">p_fresh</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">p_fresh</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">auto</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">joinable_comm</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">Join_add_prop'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">fresh_for_heap_join</span> <span class="id" title="tactic">in</span> <span class="id" title="var">p_fresh</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">p_fresh</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">Joinable_refl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">split</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">wf_union</span>. <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">Γwf</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">Δwf</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">split</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">q</span> <span class="id" title="var">q_in</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">join_in1</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">Γwf</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">q</span> <span class="id" title="var">q_in</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">join_in2</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">Δwf</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">tests_ifz</span>:<br/>
&nbsp;&nbsp;∀ (<span class="id" title="var">n</span> : <span class="id" title="var">nat</span>) (<span class="id" title="var">c</span> : <span class="id" title="var">ctx</span>) (<span class="id" title="var">θ</span> : <span class="id" title="keyword">type</span>) (<span class="id" title="var">ig</span> <span class="id" title="var">i</span> <span class="id" title="var">i'</span> : <span class="id" title="var">Code</span>) (<span class="id" title="var">dg</span> : <span class="id" title="var">cpoCatType</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">ctx_denot</span> <span class="id" title="var">c</span>) <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">ty_denot</span> <span class="id" title="var">tint</span>)) <br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">d</span> <span class="id" title="var">d'</span> : <span class="id" title="var">cpoCatType</span> (<span class="id" title="var">ctx_denot</span> <span class="id" title="var">c</span>) (<span class="id" title="var">ty_denot</span> <span class="id" title="var">θ</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">Γ</span> : <span class="id" title="var">Heap</span>) (<span class="id" title="var">η</span> : <span class="id" title="var">MEnv</span>) (ρ : <span class="id" title="var">ctx_denot</span> <span class="id" title="var">c</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">Δ</span> : <span class="id" title="var">Heap</span>) (<span class="id" title="var">s</span> : <span class="id" title="var">stack</span>) (<span class="id" title="var">p</span> : <span class="id" title="var">Pointer</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">fresh_for_heap</span> <span class="id" title="var">p</span> (<span class="id" title="var">Γ</span> ∪ <span class="id" title="var">Δ</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">r_wf</span> (<span class="id" title="var">Γ</span>, (<span class="id" title="var">iifz</span> <span class="id" title="var">ig</span> <span class="id" title="var">i</span> <span class="id" title="var">i'</span>, <span class="id" title="var">η</span>)) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">t_wf</span> (<span class="id" title="var">Δ</span>, <span class="id" title="var">s</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Γ</span> ⋈ <span class="id" title="var">Δ</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;((<span class="id" title="var">Γ</span>, <span class="id" title="var">η</span>) ⊴ <span class="id" title="var">n</span> | ρ) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">c</span> ⊢ <span class="id" title="var">i</span> ◀| <span class="id" title="var">d</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">c</span> ⊢ <span class="id" title="var">i'</span> ◀| <span class="id" title="var">d'</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">n</span>, (<span class="id" title="var">Δ</span>, <span class="id" title="var">s</span>)) ∈ <span class="id" title="var">LiftRel</span> ((((<span class="id" title="var">IfZIntTy</span> <span class="id" title="var">dg</span>) <span class="id" title="var">d</span>) <span class="id" title="var">d'</span>) ρ) (<span class="id" title="var">Primitives</span> <span class="id" title="var">θ</span>) ⊥ -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">SetIn</span>  (<span class="id" title="var">Tests</span> <span class="id" title="var">tint</span> (<span class="id" title="var">dg</span> ρ))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">n</span>, (<span class="id" title="var">Map.add</span> <span class="id" title="var">p</span>  (<span class="id" title="var">K</span> (<span class="id" title="var">IfZ</span> <span class="id" title="var">i</span> <span class="id" title="var">i'</span>), <span class="id" title="var">η</span>)(<span class="id" title="var">Γ</span> ∪ <span class="id" title="var">Δ</span>), ? <span class="id" title="var">p</span> :: <span class="id" title="var">s</span>)).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">n</span> <span class="id" title="var">c</span> <span class="id" title="var">θ</span> <span class="id" title="var">ig</span> <span class="id" title="var">i</span> <span class="id" title="var">i'</span> <span class="id" title="var">dg</span> <span class="id" title="var">d</span> <span class="id" title="var">d'</span> <span class="id" title="var">Γ</span> <span class="id" title="var">η</span> ρ <span class="id" title="var">Δ</span> <span class="id" title="var">s</span> <span class="id" title="var">p</span> <span class="id" title="var">p_fresh</span> <span class="id" title="var">Γwf</span> <span class="id" title="var">Δwf</span> <span class="id" title="var">Γ_Δ</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ρ<span class="id" title="var">_approx_n</span> <span class="id" title="var">IH</span> <span class="id" title="var">IH'</span> <span class="id" title="var">t_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">bbot_weakened</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">Case</span> "Down Closed".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> (<span class="id" title="var">Γ'</span>,<span class="id" title="var">α'</span>) <span class="id" title="var">m'</span> <span class="id" title="var">m''</span> <span class="id" title="var">H</span> <span class="id" title="var">m'_le_m''</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">H</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">f'</span> [? ?]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exists</span> <span class="id" title="var">f'</span>. <span class="id" title="tactic">split</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">primitive_gen_StepI</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">i</span>:=<span class="id" title="var">m'</span>). <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">Case</span> "Proof".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> (<span class="id" title="var">m</span>, (<span class="id" title="var">Γ'</span>, (<span class="id" title="var">im</span>, <span class="id" title="var">η'</span>))) <span class="id" title="var">r_m</span> <span class="id" title="var">m_leq_n</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">m</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">isatif_eq_Fullset</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rename</span> <span class="id" title="var">m_leq_n</span> <span class="id" title="var">into</span> <span class="id" title="var">Sm_leq_n</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">Γ'wf</span> <span class="id" title="var">ΓΔpwf</span> <span class="id" title="var">Γ'_ΓΔp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">r_m</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">dm</span> [? ?]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">im</span> ; <span class="id" title="tactic">try</span> <span class="id" title="var">contradiction</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">v</span> ; <span class="id" title="tactic">try</span> <span class="id" title="var">contradiction</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">rewrite</span> -&gt; <span class="id" title="var">H1</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">clear</span> <span class="id" title="var">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">have</span> <span class="id" title="var">m_leq_n</span> := <span class="id" title="var">Nat.le_trans</span> <span class="id" title="var">m</span> (<span class="id" title="var">m</span>.+1) <span class="id" title="var">n</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">Nat.lt_le_incl</span> <span class="id" title="var">m</span> (<span class="id" title="var">m</span>.+1)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">Nat.lt_succ_diag_r</span> <span class="id" title="var">m</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Sm_leq_n</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">have</span> ρ<span class="id" title="var">_approx_m</span> := <span class="id" title="var">env_realizer_gen_StepI</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">m_leq_n</span> ρ<span class="id" title="var">_approx_n</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">z</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id" title="var">SCase</span> "z = 0".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">antiex</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">tifz_0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">heap_find_join_prop'</span>. <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">right</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">F.add_eq_o</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">ifz_conf_prop</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">p_fresh</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">Γwf</span>. <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">Γwf</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">Tests_Equal'</span> <span class="id" title="tactic">in</span> <span class="id" title="var">t_in</span>. 2 : {<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">setoid_rewrite</span> -&gt; <span class="id" title="var">H</span>. <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">id</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">setoid_rewrite</span> -&gt; <span class="id" title="var">Smash_ValVal</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> -&gt; <span class="id" title="var">kleisliVal</span>. <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">setoid_rewrite</span> -&gt; <span class="id" title="var">Smash_ValVal</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> -&gt; <span class="id" title="var">kleisliVal</span>. <span class="id" title="tactic">by</span> <span class="id" title="tactic">simpl</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">test_gen_StepI</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">j</span>:=<span class="id" title="var">m</span>) <span class="id" title="tactic">in</span> <span class="id" title="var">t_in</span>. 2 : { <span class="id" title="tactic">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">IH</span> <span class="id" title="var">m</span> <span class="id" title="var">Γ</span> <span class="id" title="var">η</span> ρ <span class="id" title="var">H1</span> ρ<span class="id" title="var">_approx_m</span> <span class="id" title="var">_</span> <span class="id" title="var">t_in</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> "⊧", <span class="id" title="var">satif</span>, <span class="id" title="var">mrel</span>, <span class="id" title="var">isatif</span> <span class="id" title="tactic">in</span> <span class="id" title="var">IH</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> -&gt; <span class="id" title="var">Nat.min_id</span> <span class="id" title="tactic">in</span> <span class="id" title="var">IH</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">IH</span>. <span class="id" title="tactic">split</span>. <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id" title="var">SCase</span> "z &gt; 0".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">antiex</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">tifz_n0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">heap_find_join_prop'</span>. <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">right</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">F.add_eq_o</span>. <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">intro</span> <span class="id" title="var">pos_eq_Z0</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">pos_eq_Z0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">ifz_conf_prop</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">p_fresh</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">Γwf</span>. <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">Γwf</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">Tests_Equal'</span> <span class="id" title="tactic">in</span> <span class="id" title="var">t_in</span>. 2 : {<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">setoid_rewrite</span> -&gt; <span class="id" title="var">H</span>. <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">id</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">setoid_rewrite</span> -&gt; <span class="id" title="var">Smash_ValVal</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> -&gt; <span class="id" title="var">kleisliVal</span>. <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">setoid_rewrite</span> -&gt; <span class="id" title="var">Smash_ValVal</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> -&gt; <span class="id" title="var">kleisliVal</span>. <span class="id" title="tactic">by</span> <span class="id" title="tactic">simpl</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">test_gen_StepI</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">j</span>:=<span class="id" title="var">m</span>) <span class="id" title="tactic">in</span> <span class="id" title="var">t_in</span>. 2 : { <span class="id" title="tactic">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">IH'</span> <span class="id" title="var">m</span> <span class="id" title="var">Γ</span> <span class="id" title="var">η</span> ρ <span class="id" title="var">H1</span> ρ<span class="id" title="var">_approx_m</span> <span class="id" title="var">_</span> <span class="id" title="var">t_in</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> "⊧", <span class="id" title="var">satif</span>, <span class="id" title="var">mrel</span>, <span class="id" title="var">isatif</span> <span class="id" title="tactic">in</span> <span class="id" title="var">IH'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> -&gt; <span class="id" title="var">Nat.min_id</span> <span class="id" title="tactic">in</span> <span class="id" title="var">IH'</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">IH'</span>. <span class="id" title="tactic">split</span>. <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id" title="var">SCase</span> "z &lt; 0".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">antiex</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">tifz_n0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">heap_find_join_prop'</span>. <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">right</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">F.add_eq_o</span>. <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">intro</span> <span class="id" title="var">pos_eq_Z0</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">pos_eq_Z0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">ifz_conf_prop</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">p_fresh</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">Γwf</span>. <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">Γwf</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">Tests_Equal'</span> <span class="id" title="tactic">in</span> <span class="id" title="var">t_in</span>. 2 : {<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">setoid_rewrite</span> -&gt; <span class="id" title="var">H</span>. <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">id</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">setoid_rewrite</span> -&gt; <span class="id" title="var">Smash_ValVal</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> -&gt; <span class="id" title="var">kleisliVal</span>. <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">setoid_rewrite</span> -&gt; <span class="id" title="var">Smash_ValVal</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> -&gt; <span class="id" title="var">kleisliVal</span>. <span class="id" title="tactic">by</span> <span class="id" title="tactic">simpl</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">test_gen_StepI</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">j</span>:=<span class="id" title="var">m</span>) <span class="id" title="tactic">in</span> <span class="id" title="var">t_in</span>. 2 : { <span class="id" title="tactic">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">IH'</span> <span class="id" title="var">m</span> <span class="id" title="var">Γ</span> <span class="id" title="var">η</span> ρ <span class="id" title="var">H1</span> ρ<span class="id" title="var">_approx_m</span> <span class="id" title="var">_</span> <span class="id" title="var">t_in</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> "⊧", <span class="id" title="var">satif</span>, <span class="id" title="var">mrel</span>, <span class="id" title="var">isatif</span> <span class="id" title="tactic">in</span> <span class="id" title="var">IH'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> -&gt; <span class="id" title="var">Nat.min_id</span> <span class="id" title="tactic">in</span> <span class="id" title="var">IH'</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">IH'</span>. <span class="id" title="tactic">split</span>. <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">compiler_correctness_ifz</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">exists_fresh_pointer</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;∀ (π : <span class="id" title="var">ctx</span>) (<span class="id" title="var">θ</span> : <span class="id" title="keyword">type</span>) (<span class="id" title="var">ig</span> <span class="id" title="var">i</span> <span class="id" title="var">i'</span> : <span class="id" title="var">Code</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">dg</span> : <span class="id" title="var">ctx_denot</span> π =-&gt; <span class="id" title="var">ty_denot</span> <span class="id" title="var">tint</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">d</span> <span class="id" title="var">d'</span> : <span class="id" title="var">ctx_denot</span> π =-&gt; <span class="id" title="var">ty_denot</span> <span class="id" title="var">θ</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(π ⊢ <span class="id" title="var">ig</span> ◀| <span class="id" title="var">dg</span>) →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(π ⊢ <span class="id" title="var">i</span> ◀| <span class="id" title="var">d</span>) →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(π ⊢ <span class="id" title="var">i'</span> ◀| <span class="id" title="var">d'</span>) →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(π ⊢ (<span class="id" title="var">iifz</span> <span class="id" title="var">ig</span> <span class="id" title="var">i</span> <span class="id" title="var">i'</span>) ◀| <span class="id" title="var">IfZIntTy</span> <span class="id" title="var">dg</span> <span class="id" title="var">d</span> <span class="id" title="var">d'</span>).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">EFP</span> <span class="id" title="var">c</span> <span class="id" title="var">θ</span> <span class="id" title="var">ig</span> <span class="id" title="var">i</span> <span class="id" title="var">i'</span> <span class="id" title="var">dg</span> <span class="id" title="var">d</span> <span class="id" title="var">d'</span> <span class="id" title="var">IHg</span> <span class="id" title="var">IH</span> <span class="id" title="var">IH'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">n</span> <span class="id" title="var">Γ</span> <span class="id" title="var">η</span> ρ <span class="id" title="var">Γwf</span> ρ<span class="id" title="var">_approx_n</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">btop_weakened</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">Case</span> "Down Closed".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">fs</span> <span class="id" title="var">m</span> <span class="id" title="var">m'</span> <span class="id" title="var">H</span> <span class="id" title="var">m_le_m'</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">bbot_down_closed</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">m_le_m'</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">Case</span> "Proof".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> (<span class="id" title="var">m</span>, (<span class="id" title="var">Δ</span>, <span class="id" title="var">s</span>)) <span class="id" title="var">t_in</span> <span class="id" title="var">m_leq_n</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">EFP</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">Γ</span>:=<span class="id" title="var">Γ</span> ∪ <span class="id" title="var">Δ</span>) (<span class="id" title="var">η</span>:=<span class="id" title="var">η</span>) (<span class="id" title="var">s</span>:=<span class="id" title="var">s</span>) <span class="id" title="keyword">as</span> [<span class="id" title="var">p</span> <span class="id" title="var">p_fresh</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">m</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">isatif_eq_Fullset</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rename</span> <span class="id" title="var">m_leq_n</span> <span class="id" title="var">into</span> <span class="id" title="var">Sm_leq_n</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">Γwf'</span> <span class="id" title="var">Δwf</span> <span class="id" title="var">Γ_Δ</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">antiex</span>. <span class="id" title="tactic">constructor</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">p_fresh</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">p_fresh_ΓΔηs</span>:=<span class="id" title="var">p_fresh</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">p_fresh</span>. <span class="id" title="tactic">apply</span> (<span class="id" title="var">fresh_for_heap_join</span> <span class="id" title="var">Γ_Δ</span>) <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">as0</span> : <span class="id" title="var">add</span> <span class="id" title="var">p</span> (<span class="id" title="var">K</span> (<span class="id" title="var">IfZ</span> <span class="id" title="var">i</span> <span class="id" title="var">i'</span>), <span class="id" title="var">η</span>) (<span class="id" title="var">Γ</span> ∪ <span class="id" title="var">Δ</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;≃<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Γ</span> ∪ <span class="id" title="var">add</span> <span class="id" title="var">p</span> (<span class="id" title="var">K</span> (<span class="id" title="var">IfZ</span> <span class="id" title="var">i</span> <span class="id" title="var">i'</span>), <span class="id" title="var">η</span>) (<span class="id" title="var">Γ</span> ∪ <span class="id" title="var">Δ</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">symmetry</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">Join_comm_1</span>. <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">heap_add_prop_idemp'''</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">joinable_comm</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">Join_add_prop'</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">joinable_comm</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">joinable_join1</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">have</span> <span class="id" title="var">m_leq_n</span> := <span class="id" title="var">Nat.le_trans</span> <span class="id" title="var">m</span> (<span class="id" title="var">m</span>.+1) <span class="id" title="var">n</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">Nat.lt_le_incl</span> <span class="id" title="var">m</span> (<span class="id" title="var">m</span>.+1)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">Nat.lt_succ_diag_r</span> <span class="id" title="var">m</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Sm_leq_n</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">have</span> ρ<span class="id" title="var">_approx_m</span> := <span class="id" title="var">env_realizer_gen_StepI</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">m_leq_n</span> ρ<span class="id" title="var">_approx_n</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id" title="tactic">assert</span> (<span class="id" title="var">as1</span> : <span class="id" title="var">SetIn</span> (<span class="id" title="var">Tests</span> <span class="id" title="var">tint</span> (<span class="id" title="var">dg</span> ρ))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">m</span>, (<span class="id" title="var">Map.add</span> <span class="id" title="var">p</span> (<span class="id" title="var">K</span> (<span class="id" title="var">IfZ</span> <span class="id" title="var">i</span> <span class="id" title="var">i'</span>), <span class="id" title="var">η</span>) (<span class="id" title="var">Γ</span> ∪ <span class="id" title="var">Δ</span>), ? <span class="id" title="var">p</span> :: <span class="id" title="var">s</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">tests_ifz</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">ig</span>:=<span class="id" title="var">ig</span>) (<span class="id" title="var">θ</span>:=<span class="id" title="var">θ</span>) (<span class="id" title="var">d</span>:=<span class="id" title="var">d</span>) (<span class="id" title="var">d'</span>:=<span class="id" title="var">d'</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">fresh_for_heap_join_1</span>. <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">auto</span>. <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">test_StepI</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">heap_rewrite_conf</span> <span class="id" title="var">as0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">IHg</span> <span class="id" title="var">m</span> <span class="id" title="var">Γ</span> <span class="id" title="var">η</span> ρ <span class="id" title="var">Γwf</span> ρ<span class="id" title="var">_approx_m</span> <span class="id" title="var">_</span> <span class="id" title="var">as1</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> "⊧", <span class="id" title="var">satif</span>, <span class="id" title="var">mrel</span>, <span class="id" title="var">isatif</span> <span class="id" title="tactic">in</span> <span class="id" title="var">IHg</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> -&gt; <span class="id" title="var">Nat.min_id</span> <span class="id" title="tactic">in</span> <span class="id" title="var">IHg</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">IHg</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">split</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">wf_add</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">wf_union</span>. <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">Γwf</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">Δwf</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">q</span> <span class="id" title="var">q_in</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">join_in1</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">Γwf'</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">stack_ptr_cons_included_if</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">q</span> <span class="id" title="var">q_in</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">F.add_in_iff</span>. <span class="id" title="tactic">right</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">join_in2</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">Δwf</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">F.add_in_iff</span>. <span class="id" title="tactic">left</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">joinable_comm</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">Join_add_prop'</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">joinable_comm</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">joinable_join1</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">compiler_correctness_pair</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">exists_fresh_pointer</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;∀ (π : <span class="id" title="var">ctx</span>) (<span class="id" title="var">θ1</span> <span class="id" title="var">θ2</span> : <span class="id" title="keyword">type</span>) (<span class="id" title="var">i</span> <span class="id" title="var">i'</span> : <span class="id" title="var">Code</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">d</span>  : <span class="id" title="var">ctx_denot</span> π =-&gt; <span class="id" title="var">ty_denot</span> <span class="id" title="var">θ1</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">d'</span> : <span class="id" title="var">ctx_denot</span> π =-&gt; <span class="id" title="var">ty_denot</span> <span class="id" title="var">θ2</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(π ⊢ <span class="id" title="var">i</span> ◀| <span class="id" title="var">d</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(π ⊢ <span class="id" title="var">i'</span> ◀| <span class="id" title="var">d'</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(@<span class="id" title="var">GRealizers</span> π (<span class="id" title="var">θ1</span> ⨱ <span class="id" title="var">θ2</span>) (<span class="id" title="var">eta</span> &lt;&lt; &lt;| <span class="id" title="var">d</span> , <span class="id" title="var">d'</span> |&gt;) (<span class="id" title="var">ival</span> (<span class="id" title="var">ipair</span> <span class="id" title="var">i</span> <span class="id" title="var">i'</span>))).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">EFP</span> <span class="id" title="var">c</span> <span class="id" title="var">θ1</span> <span class="id" title="var">θ2</span> <span class="id" title="var">i</span> <span class="id" title="var">i'</span> <span class="id" title="var">d</span> <span class="id" title="var">d'</span> <span class="id" title="var">IH</span> <span class="id" title="var">IH'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">n</span> <span class="id" title="var">Γ</span> <span class="id" title="var">η</span> ρ <span class="id" title="var">Γwf</span> ρ<span class="id" title="var">_approx_n</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">primitive_realizer</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">env_realizer_ptr</span>. <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">apply</span> ρ<span class="id" title="var">_approx_n</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">m</span> <span class="id" title="var">m_le_n</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">IH</span>. <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">env_realizer_gen_StepI</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">i</span>:=<span class="id" title="var">n</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">Nat.lt_le_incl</span>. <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">IH'</span>. <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">env_realizer_gen_StepI</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">i</span>:=<span class="id" title="var">n</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">Nat.lt_le_incl</span>. <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">tests_pairs_1</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">n</span> <span class="id" title="var">Γ</span> <span class="id" title="var">Δ</span> <span class="id" title="var">s</span> <span class="id" title="var">θ1</span> <span class="id" title="var">θ2</span> (<span class="id" title="var">d1d2</span> : <span class="id" title="var">ty_denot</span> (<span class="id" title="var">θ1</span> ⨱ <span class="id" title="var">θ2</span>)),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">t_wf</span> (<span class="id" title="var">Δ</span>, <span class="id" title="var">s</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Γ</span> ⋈ <span class="id" title="var">Δ</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">SetIn</span> (<span class="id" title="var">Tests</span> <span class="id" title="var">θ1</span> (<span class="id" title="var">kleisli</span> (<span class="id" title="var">FST</span> (<span class="id" title="var">ty_denot</span> <span class="id" title="var">θ1</span>) (<span class="id" title="var">ty_denot</span> <span class="id" title="var">θ2</span>)) <span class="id" title="var">d1d2</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">n</span>, (<span class="id" title="var">Δ</span>, <span class="id" title="var">s</span>)) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">SetIn</span> (<span class="id" title="var">Tests</span> (<span class="id" title="var">θ1</span> ⨱ <span class="id" title="var">θ2</span>) <span class="id" title="var">d1d2</span>) (<span class="id" title="var">n</span>, (<span class="id" title="var">Γ</span> ∪ <span class="id" title="var">Δ</span>, <span class="id" title="var">mapplypi1</span> :: <span class="id" title="var">s</span>)).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">n</span> <span class="id" title="var">Γ</span> <span class="id" title="var">Δ</span> <span class="id" title="var">s</span> <span class="id" title="var">θ1</span> <span class="id" title="var">θ2</span> <span class="id" title="var">d1d2</span> <span class="id" title="var">Δwf</span> <span class="id" title="var">Γ_Δ</span> <span class="id" title="var">t_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">bbot_weakened</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">Case</span> "Down Closed".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> (<span class="id" title="var">Γ'</span>,<span class="id" title="var">α'</span>) <span class="id" title="var">m'</span> <span class="id" title="var">m''</span> <span class="id" title="var">H</span> <span class="id" title="var">m'_le_m''</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">H</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">f'</span> [? ?]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exists</span> <span class="id" title="var">f'</span>. <span class="id" title="tactic">split</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">primitive_gen_StepI</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">i</span>:=<span class="id" title="var">m'</span>). <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">Case</span> "Proof".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> (<span class="id" title="var">m</span>, (<span class="id" title="var">Γ'</span>, (<span class="id" title="var">im</span>, <span class="id" title="var">η'</span>))) <span class="id" title="var">r_m</span> <span class="id" title="var">m_leq_n</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">m</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">isatif_eq_Fullset</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rename</span> <span class="id" title="var">m_leq_n</span> <span class="id" title="var">into</span> <span class="id" title="var">Sm_leq_n</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">Γ'wf</span> <span class="id" title="var">ΓΔpwf</span> <span class="id" title="var">Γ'_ΓΔp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">r_m</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">dm</span> [? ?]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">im</span> ; <span class="id" title="tactic">try</span> <span class="id" title="var">contradiction</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">v</span> ; <span class="id" title="tactic">try</span> <span class="id" title="var">contradiction</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">antiex</span>. <span class="id" title="tactic">constructor</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">dm</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">d1</span> <span class="id" title="var">d2</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">Tests_Equal'</span> <span class="id" title="tactic">in</span> <span class="id" title="var">t_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2 : { <span class="id" title="tactic">rewrite</span> -&gt; <span class="id" title="var">H</span>. <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">rewrite</span> -&gt; <span class="id" title="var">kleisliVal</span>. <span class="id" title="tactic">by</span> <span class="id" title="tactic">simpl</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">assert</span> ((<span class="id" title="var">m</span> &lt; <span class="id" title="var">m</span>.+1)%<span class="id" title="var">coq_nat</span>) <span class="id" title="tactic">by</span> <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">H1</span> <span class="id" title="var">_</span> <span class="id" title="var">H2</span>) <span class="id" title="keyword">as</span> [? ?]. <span class="id" title="tactic">clear</span> <span class="id" title="var">H2</span>. <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">test_gen_StepI</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">j</span>:=<span class="id" title="var">m</span>) <span class="id" title="tactic">in</span> <span class="id" title="var">t_in</span>. 2 : {<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> (<span class="id" title="var">Nat.le_trans</span> <span class="id" title="var">m</span> (<span class="id" title="var">m</span>.+1) <span class="id" title="var">n</span> (<span class="id" title="var">Nat.lt_le_incl</span> <span class="id" title="var">m</span> (<span class="id" title="var">m</span>.+1)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">Nat.lt_succ_diag_r</span> <span class="id" title="var">m</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Sm_leq_n</span>). }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">H1</span> <span class="id" title="var">_</span> <span class="id" title="var">t_in</span>). <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> *. <span class="id" title="tactic">destruct</span> <span class="id" title="var">Γ'wf</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">joinable_comm</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Γ'_ΓΔp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">have</span> <span class="id" title="var">ble</span> := <span class="id" title="var">Joinable_join_elim_2</span> <span class="id" title="var">Γ_Δ</span> <span class="id" title="var">Γ'_ΓΔp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">have</span> <span class="id" title="var">bla</span> := <span class="id" title="var">Joinable_join_elim_1</span> <span class="id" title="var">Γ_Δ</span> <span class="id" title="var">Γ'_ΓΔp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">Δwf</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">Γ'</span> ∪ (<span class="id" title="var">Γ</span> ∪ <span class="id" title="var">Δ</span>) ≃ (<span class="id" title="var">Γ'</span> ∪ <span class="id" title="var">Δ</span>) ∪ <span class="id" title="var">Γ</span>) <span class="id" title="keyword">as</span> <span class="id" title="var">E</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> -&gt; <span class="id" title="var">Join_assoc_1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">Equal_join_mor</span>. <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">auto</span>. <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">heap_rewrite_conf</span> <span class="id" title="var">E</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">extend_heap</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">wf_union</span>. <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">Join_key_set</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">a</span> <span class="id" title="var">b</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">Union_introl</span>. <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">Join_key_set</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">a</span> <span class="id" title="var">b</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">Union_intror</span>. <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> -&gt; <span class="id" title="var">Nat.min_id</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">H1</span>. <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">tests_pairs_2</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">n</span> <span class="id" title="var">Γ</span> <span class="id" title="var">Δ</span> <span class="id" title="var">s</span> <span class="id" title="var">θ1</span> <span class="id" title="var">θ2</span> (<span class="id" title="var">d1d2</span> : <span class="id" title="var">ty_denot</span> (<span class="id" title="var">θ1</span> ⨱ <span class="id" title="var">θ2</span>)),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">t_wf</span> (<span class="id" title="var">Δ</span>, <span class="id" title="var">s</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Γ</span> ⋈ <span class="id" title="var">Δ</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">SetIn</span> (<span class="id" title="var">Tests</span> <span class="id" title="var">θ2</span> (<span class="id" title="var">kleisli</span> (<span class="id" title="var">SND</span> (<span class="id" title="var">ty_denot</span> <span class="id" title="var">θ1</span>) (<span class="id" title="var">ty_denot</span> <span class="id" title="var">θ2</span>)) <span class="id" title="var">d1d2</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">n</span>, (<span class="id" title="var">Δ</span>, <span class="id" title="var">s</span>)) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">SetIn</span> (<span class="id" title="var">Tests</span> (<span class="id" title="var">θ1</span> ⨱ <span class="id" title="var">θ2</span>) <span class="id" title="var">d1d2</span>) (<span class="id" title="var">n</span>, (<span class="id" title="var">Γ</span> ∪ <span class="id" title="var">Δ</span>, <span class="id" title="var">mapplypi2</span> :: <span class="id" title="var">s</span>)).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">n</span> <span class="id" title="var">Γ</span> <span class="id" title="var">Δ</span> <span class="id" title="var">s</span> <span class="id" title="var">θ1</span> <span class="id" title="var">θ2</span> <span class="id" title="var">d1d2</span> <span class="id" title="var">Δwf</span> <span class="id" title="var">Γ_Δ</span> <span class="id" title="var">t_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">bbot_weakened</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">Case</span> "Down Closed".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> (<span class="id" title="var">Γ'</span>,<span class="id" title="var">α'</span>) <span class="id" title="var">m'</span> <span class="id" title="var">m''</span> <span class="id" title="var">H</span> <span class="id" title="var">m'_le_m''</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">H</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">f'</span> [? ?]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exists</span> <span class="id" title="var">f'</span>. <span class="id" title="tactic">split</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">primitive_gen_StepI</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">i</span>:=<span class="id" title="var">m'</span>). <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">Case</span> "Proof".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> (<span class="id" title="var">m</span>, (<span class="id" title="var">Γ'</span>, (<span class="id" title="var">im</span>, <span class="id" title="var">η'</span>))) <span class="id" title="var">r_m</span> <span class="id" title="var">m_leq_n</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">m</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">isatif_eq_Fullset</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rename</span> <span class="id" title="var">m_leq_n</span> <span class="id" title="var">into</span> <span class="id" title="var">Sm_leq_n</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">Γ'wf</span> <span class="id" title="var">ΓΔpwf</span> <span class="id" title="var">Γ'_ΓΔp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">r_m</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">dm</span> [? ?]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">im</span> ; <span class="id" title="tactic">try</span> <span class="id" title="var">contradiction</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">v</span> ; <span class="id" title="tactic">try</span> <span class="id" title="var">contradiction</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">antiex</span>. <span class="id" title="tactic">constructor</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">dm</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">d1</span> <span class="id" title="var">d2</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">Tests_Equal'</span> <span class="id" title="tactic">in</span> <span class="id" title="var">t_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2 : { <span class="id" title="tactic">rewrite</span> -&gt; <span class="id" title="var">H</span>. <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">rewrite</span> -&gt; <span class="id" title="var">kleisliVal</span>. <span class="id" title="tactic">by</span> <span class="id" title="tactic">simpl</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H0</span>. <span class="id" title="tactic">assert</span> ((<span class="id" title="var">m</span> &lt; <span class="id" title="var">m</span>.+1)%<span class="id" title="var">coq_nat</span>) <span class="id" title="tactic">by</span> <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">H1</span> <span class="id" title="var">_</span> <span class="id" title="var">H2</span>) <span class="id" title="keyword">as</span> [? ?]. <span class="id" title="tactic">clear</span> <span class="id" title="var">H2</span>. <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">test_gen_StepI</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">j</span>:=<span class="id" title="var">m</span>) <span class="id" title="tactic">in</span> <span class="id" title="var">t_in</span>. 2 : {<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> (<span class="id" title="var">Nat.le_trans</span> <span class="id" title="var">m</span> (<span class="id" title="var">m</span>.+1) <span class="id" title="var">n</span> (<span class="id" title="var">Nat.lt_le_incl</span> <span class="id" title="var">m</span> (<span class="id" title="var">m</span>.+1)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">Nat.lt_succ_diag_r</span> <span class="id" title="var">m</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Sm_leq_n</span>). }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">H3</span> <span class="id" title="var">_</span> <span class="id" title="var">t_in</span>). <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> *. <span class="id" title="tactic">destruct</span> <span class="id" title="var">Γ'wf</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">joinable_comm</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Γ'_ΓΔp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">have</span> <span class="id" title="var">ble</span> := <span class="id" title="var">Joinable_join_elim_2</span> <span class="id" title="var">Γ_Δ</span> <span class="id" title="var">Γ'_ΓΔp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">have</span> <span class="id" title="var">bla</span> := <span class="id" title="var">Joinable_join_elim_1</span> <span class="id" title="var">Γ_Δ</span> <span class="id" title="var">Γ'_ΓΔp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">Δwf</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">Γ'</span> ∪ (<span class="id" title="var">Γ</span> ∪ <span class="id" title="var">Δ</span>) ≃ (<span class="id" title="var">Γ'</span> ∪ <span class="id" title="var">Δ</span>) ∪ <span class="id" title="var">Γ</span>) <span class="id" title="keyword">as</span> <span class="id" title="var">E</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> -&gt; <span class="id" title="var">Join_assoc_1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">Equal_join_mor</span>. <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">auto</span>. <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">heap_rewrite_conf</span> <span class="id" title="var">E</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">extend_heap</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">wf_union</span>. <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">Join_key_set</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">a</span> <span class="id" title="var">b</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">Union_introl</span>. <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">Join_key_set</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">a</span> <span class="id" title="var">b</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">Union_intror</span>. <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> -&gt; <span class="id" title="var">Nat.min_id</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">H3</span>. <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">compiler_correctness_fst</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;∀ (<span class="id" title="var">θ1</span> <span class="id" title="var">θ2</span> : <span class="id" title="keyword">type</span>) (<span class="id" title="var">c</span> : <span class="id" title="var">ctx</span>) (<span class="id" title="var">v</span> : <span class="id" title="var">var</span> <span class="id" title="var">c</span> (<span class="id" title="var">θ1</span> ⨱ <span class="id" title="var">θ2</span>)),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@<span class="id" title="var">GRealizers</span> <span class="id" title="var">c</span> <span class="id" title="var">θ1</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">kleisli</span> (<span class="id" title="var">FST</span> (<span class="id" title="var">ty_denot</span> <span class="id" title="var">θ1</span>) (<span class="id" title="var">ty_denot</span> <span class="id" title="var">θ2</span>)) &lt;&lt; <span class="id" title="var">lookup</span> <span class="id" title="var">v</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">ifst</span> (<span class="id" title="var">var_to_nat</span> <span class="id" title="var">v</span>)).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">θ1</span> <span class="id" title="var">θ2</span> <span class="id" title="var">c</span> <span class="id" title="var">v</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">n</span> <span class="id" title="var">Γ</span> <span class="id" title="var">η</span> ρ <span class="id" title="var">Γwf</span> ρ<span class="id" title="var">_approx_n</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">btop_weakened</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">Case</span> "Down Closed".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">fs</span> <span class="id" title="var">m</span> <span class="id" title="var">m'</span> <span class="id" title="var">H</span> <span class="id" title="var">m_le_m'</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">bbot_down_closed</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">m_le_m'</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">Case</span> "Proof".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> (<span class="id" title="var">m</span>, (<span class="id" title="var">Δ</span>, <span class="id" title="var">s</span>)) <span class="id" title="var">t_in</span> <span class="id" title="var">m_leq_n</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">m</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">isatif_eq_Fullset</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rename</span> <span class="id" title="var">m_leq_n</span> <span class="id" title="var">into</span> <span class="id" title="var">Sm_leq_n</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">Γwf'</span> <span class="id" title="var">Δwf</span> <span class="id" title="var">Γ_Δ</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">set</span> (<span class="id" title="var">Q</span> := <span class="id" title="var">nth_var_to_nat</span> <span class="id" title="var">v</span>); <span class="id" title="var">clearbody</span> <span class="id" title="var">Q</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">set</span> (<span class="id" title="var">H</span> := <span class="id" title="var">env_realizer_lookup</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">Q</span> ρ<span class="id" title="var">_approx_n</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">clearbody</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H</span>  <span class="id" title="keyword">as</span> [<span class="id" title="var">p</span> [<span class="id" title="var">EQ</span> <span class="id" title="var">EX</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">EX</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">α</span> [<span class="id" title="var">β</span> [<span class="id" title="var">F1</span> [<span class="id" title="var">β_to_α</span> <span class="id" title="var">Hr2</span>]]]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">antiex</span>. <span class="id" title="tactic">econstructor</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">EQ</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">find_submap</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">join_sub1</span>. <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">F1</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">β_to_α</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">add_marker_pi1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">find_submap</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">join_sub1</span>. <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">F1</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">β_to_α</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">var_to_nat_lookup</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Hr2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">p_in_Γ</span> : <span class="id" title="var">p</span> ∈ <span class="id" title="var">heap_ptr</span> <span class="id" title="var">Γ</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> "∈", <span class="id" title="var">heap_ptr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">Union_introl</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">key_set_find_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">F1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">test_StepI</span> <span class="id" title="tactic">in</span> <span class="id" title="var">t_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">realizer_gen_StepI</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">j</span>:=<span class="id" title="var">m</span>) <span class="id" title="tactic">in</span> <span class="id" title="var">Hr2</span>. 2 : {<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> (<span class="id" title="var">Nat.le_trans</span> <span class="id" title="var">m</span> (<span class="id" title="var">m</span>.+1) <span class="id" title="var">n</span> (<span class="id" title="var">Nat.lt_le_incl</span> <span class="id" title="var">m</span> (<span class="id" title="var">m</span>.+1)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">Nat.lt_succ_diag_r</span> <span class="id" title="var">m</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Sm_leq_n</span>). }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">have</span> <span class="id" title="var">TestsPair1</span> := @<span class="id" title="var">tests_pairs_1</span> <span class="id" title="var">m</span> <span class="id" title="var">Γ</span> <span class="id" title="var">Δ</span> <span class="id" title="var">s</span> <span class="id" title="var">θ1</span> <span class="id" title="var">θ2</span> (<span class="id" title="var">lookup</span> <span class="id" title="var">v</span> ρ) <span class="id" title="var">Δwf</span> <span class="id" title="var">Γ_Δ</span> <span class="id" title="var">t_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">Γ</span> ∪ <span class="id" title="var">Δ</span> ≃ <span class="id" title="var">Γ</span> ∪ (<span class="id" title="var">Γ</span> ∪ <span class="id" title="var">Δ</span>)) <span class="id" title="keyword">as</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">Join_assoc_1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">symmetry</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">Equal_join_mor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">Join_idem</span> ; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">Join_idem</span> ; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">Joinable_refl</span> ; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">auto</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">tests_realizers</span> <span class="id" title="tactic">in</span> <span class="id" title="var">TestsPair1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">TestsPair1</span> (<span class="id" title="var">m</span>,(<span class="id" title="var">Γ</span>,<span class="id" title="var">α</span>))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">heap_rewrite_conf</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> "⊧", <span class="id" title="var">satif</span>, <span class="id" title="var">mrel</span>, <span class="id" title="var">isatif</span> <span class="id" title="tactic">in</span> <span class="id" title="var">TestsPair1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> -&gt; <span class="id" title="var">Nat.min_id</span> <span class="id" title="tactic">in</span> <span class="id" title="var">TestsPair1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">TestsPair1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">Hr2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">r_wf_find</span>. <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">F1</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">β_to_α</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">wf_union</span>. <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> (<span class="id" title="var">t_wf_heap</span> <span class="id" title="var">Δwf</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">stack_ptr_eq_1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">Δwf</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> (<span class="id" title="var">Join_key_set</span> <span class="id" title="var">Γ_Δ</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">right</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H1</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">joinable_join1</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Lemma</span> <span class="id" title="var">compiler_correctness_snd</span>:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;∀ (<span class="id" title="var">θ1</span> <span class="id" title="var">θ2</span> : <span class="id" title="keyword">type</span>) (<span class="id" title="var">c</span> : <span class="id" title="var">ctx</span>) (<span class="id" title="var">v</span> : <span class="id" title="var">var</span> <span class="id" title="var">c</span> (<span class="id" title="var">θ1</span> ⨱ <span class="id" title="var">θ2</span>)),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@<span class="id" title="var">GRealizers</span> <span class="id" title="var">c</span> <span class="id" title="var">θ2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">kleisli</span> (<span class="id" title="var">SND</span> (<span class="id" title="var">ty_denot</span> <span class="id" title="var">θ1</span>) (<span class="id" title="var">ty_denot</span> <span class="id" title="var">θ2</span>)) &lt;&lt; <span class="id" title="var">lookup</span> <span class="id" title="var">v</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">isnd</span> (<span class="id" title="var">var_to_nat</span> <span class="id" title="var">v</span>)).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">θ1</span> <span class="id" title="var">θ2</span> <span class="id" title="var">c</span> <span class="id" title="var">v</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">n</span> <span class="id" title="var">Γ</span> <span class="id" title="var">η</span> ρ <span class="id" title="var">Γwf</span> ρ<span class="id" title="var">_approx_n</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">btop_weakened</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">Case</span> "Down Closed".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">fs</span> <span class="id" title="var">m</span> <span class="id" title="var">m'</span> <span class="id" title="var">H</span> <span class="id" title="var">m_le_m'</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">bbot_down_closed</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">m_le_m'</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">Case</span> "Proof".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> (<span class="id" title="var">m</span>, (<span class="id" title="var">Δ</span>, <span class="id" title="var">s</span>)) <span class="id" title="var">t_in</span> <span class="id" title="var">m_leq_n</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">m</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">isatif_eq_Fullset</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rename</span> <span class="id" title="var">m_leq_n</span> <span class="id" title="var">into</span> <span class="id" title="var">Sm_leq_n</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">Γwf'</span> <span class="id" title="var">Δwf</span> <span class="id" title="var">Γ_Δ</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">set</span> (<span class="id" title="var">Q</span> := <span class="id" title="var">nth_var_to_nat</span> <span class="id" title="var">v</span>); <span class="id" title="var">clearbody</span> <span class="id" title="var">Q</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">set</span> (<span class="id" title="var">H</span> := <span class="id" title="var">env_realizer_lookup</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">Q</span> ρ<span class="id" title="var">_approx_n</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">clearbody</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H</span>  <span class="id" title="keyword">as</span> [<span class="id" title="var">p</span> [<span class="id" title="var">EQ</span> <span class="id" title="var">EX</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">EX</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">α</span> [<span class="id" title="var">β</span> [<span class="id" title="var">F1</span> [<span class="id" title="var">β_to_α</span> <span class="id" title="var">Hr2</span>]]]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">antiex</span>. <span class="id" title="tactic">econstructor</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">EQ</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">find_submap</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">join_sub1</span>. <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">F1</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">β_to_α</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">add_marker_pi2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">find_submap</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">join_sub1</span>. <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">F1</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">β_to_α</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">var_to_nat_lookup</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Hr2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">p_in_Γ</span> : <span class="id" title="var">p</span> ∈ <span class="id" title="var">heap_ptr</span> <span class="id" title="var">Γ</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> "∈", <span class="id" title="var">heap_ptr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">Union_introl</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">key_set_find_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">F1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">test_StepI</span> <span class="id" title="tactic">in</span> <span class="id" title="var">t_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">realizer_gen_StepI</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">j</span>:=<span class="id" title="var">m</span>) <span class="id" title="tactic">in</span> <span class="id" title="var">Hr2</span>. 2 : {<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> (<span class="id" title="var">Nat.le_trans</span> <span class="id" title="var">m</span> (<span class="id" title="var">m</span>.+1) <span class="id" title="var">n</span> (<span class="id" title="var">Nat.lt_le_incl</span> <span class="id" title="var">m</span> (<span class="id" title="var">m</span>.+1)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">Nat.lt_succ_diag_r</span> <span class="id" title="var">m</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Sm_leq_n</span>). }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">have</span> <span class="id" title="var">TestsPair2</span> := @<span class="id" title="var">tests_pairs_2</span> <span class="id" title="var">m</span> <span class="id" title="var">Γ</span> <span class="id" title="var">Δ</span> <span class="id" title="var">s</span> <span class="id" title="var">θ1</span> <span class="id" title="var">θ2</span> (<span class="id" title="var">lookup</span> <span class="id" title="var">v</span> ρ) <span class="id" title="var">Δwf</span> <span class="id" title="var">Γ_Δ</span> <span class="id" title="var">t_in</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">Γ</span> ∪ <span class="id" title="var">Δ</span> ≃ <span class="id" title="var">Γ</span> ∪ (<span class="id" title="var">Γ</span> ∪ <span class="id" title="var">Δ</span>)) <span class="id" title="keyword">as</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">Join_assoc_1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">symmetry</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">Equal_join_mor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">Join_idem</span> ; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">Join_idem</span> ; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">Joinable_refl</span> ; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">auto</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">tests_realizers</span> <span class="id" title="tactic">in</span> <span class="id" title="var">TestsPair2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">TestsPair2</span> (<span class="id" title="var">m</span>,(<span class="id" title="var">Γ</span>,<span class="id" title="var">α</span>))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">heap_rewrite_conf</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> "⊧", <span class="id" title="var">satif</span>, <span class="id" title="var">mrel</span>, <span class="id" title="var">isatif</span> <span class="id" title="tactic">in</span> <span class="id" title="var">TestsPair2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> -&gt; <span class="id" title="var">Nat.min_id</span> <span class="id" title="tactic">in</span> <span class="id" title="var">TestsPair2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">TestsPair2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">Hr2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">r_wf_find</span>. <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">F1</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">β_to_α</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">wf_union</span>. <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> (<span class="id" title="var">t_wf_heap</span> <span class="id" title="var">Δwf</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">stack_ptr_eq_2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">Δwf</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> (<span class="id" title="var">Join_key_set</span> <span class="id" title="var">Γ_Δ</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">right</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H1</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">joinable_join1</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Theorem</span> <span class="id" title="var">compiler_correctness</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">exists_fresh_pointer</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">forall</span> (π : <span class="id" title="var">ctx</span>) (<span class="id" title="var">θ</span> : <span class="id" title="keyword">type</span>) (<span class="id" title="var">t</span> : <span class="id" title="var">term</span> π <span class="id" title="var">θ</span>), (π ⊢ (⦇ <span class="id" title="var">t</span> ⦈) ◀| (⟦ <span class="id" title="var">t</span> ⟧)).<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intro</span> <span class="id" title="var">EFP</span>. <span class="id" title="tactic">induction</span> <span class="id" title="var">t0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">Case</span> "term_unit".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">compiler_correctness_unit</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">Case</span> "term_int".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">compiler_correctness_int</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">Case</span> "term_var".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">compiler_correctness_var</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">Case</span> "term_abs".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">compiler_correctness_abs</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">Case</span> "term_app".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">compiler_correctness_app</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">Case</span> "term_let".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">compiler_correctness_let</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">Case</span> "term_bop".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">compiler_correctness_bop</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">Case</span> "term_ifz".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">compiler_correctness_ifz</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">Case</span> "term_pair".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">compiler_correctness_pair</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">Case</span> "term_fst".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">compiler_correctness_fst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">Case</span> "term_snd".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">compiler_correctness_snd</span>.<br/>
&nbsp;&nbsp;<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">End</span> <span class="id" title="var">OperApprox</span>.<br/>
</div>
</div>

<div id="footer">
<hr/><a href="index.html">Index</a><hr/>This page has been generated by <a href="http://coq.inria.fr/">coqdoc</a>
</div>

</div>

</body>
</html>